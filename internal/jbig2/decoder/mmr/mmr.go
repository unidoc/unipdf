//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package mmr ;import (_b "errors";_e "fmt";_be "github.com/unidoc/unipdf/v4/common";_d "github.com/unidoc/unipdf/v4/internal/bitwise";_c "github.com/unidoc/unipdf/v4/internal/jbig2/bitmap";_a "io";);func _beb (_bba *_d .Reader )(*runData ,error ){_aggd :=&runData {_dee :_bba ,_ccd :0,_fgf :1};
_cdbad :=_ed (_dcg (_fcg ,int (_bba .Length ())),_gdd );_aggd ._cdba =make ([]byte ,_cdbad );if _ada :=_aggd .fillBuffer (0);_ada !=nil {if _ada ==_a .EOF {_aggd ._cdba =make ([]byte ,10);_be .Log .Debug ("F\u0069\u006c\u006c\u0042uf\u0066e\u0072\u0020\u0066\u0061\u0069l\u0065\u0064\u003a\u0020\u0025\u0076",_ada );
}else {return nil ,_ada ;};};return _aggd ,nil ;};func (_ae *runData )fillBuffer (_cgad int )error {_ae ._gdb =_cgad ;_ ,_aag :=_ae ._dee .Seek (int64 (_cgad ),_a .SeekStart );if _aag !=nil {if _aag ==_a .EOF {_be .Log .Debug ("\u0053\u0065\u0061\u006b\u0020\u0045\u004f\u0046");
_ae ._gda =-1;}else {return _aag ;};};if _aag ==nil {_ae ._gda ,_aag =_ae ._dee .Read (_ae ._cdba );if _aag !=nil {if _aag ==_a .EOF {_be .Log .Trace ("\u0052\u0065\u0061\u0064\u0020\u0045\u004f\u0046");_ae ._gda =-1;}else {return _aag ;};};};if _ae ._gda > -1&&_ae ._gda < 3{for _ae ._gda < 3{_ece ,_adaf :=_ae ._dee .ReadByte ();
if _adaf !=nil {if _adaf ==_a .EOF {_ae ._cdba [_ae ._gda ]=0;}else {return _adaf ;};}else {_ae ._cdba [_ae ._gda ]=_ece &0xFF;};_ae ._gda ++;};};_ae ._gda -=3;if _ae ._gda < 0{_ae ._cdba =make ([]byte ,len (_ae ._cdba ));_ae ._gda =len (_ae ._cdba )-3;
};return nil ;};func (_bfa *runData )uncompressGetCodeLittleEndian (_ca []*code )(*code ,error ){_ffe ,_ccg :=_bfa .uncompressGetNextCodeLittleEndian ();if _ccg !=nil {_be .Log .Debug ("\u0055n\u0063\u006fm\u0070\u0072\u0065\u0073s\u0047\u0065\u0074N\u0065\u0078\u0074\u0043\u006f\u0064\u0065\u004c\u0069tt\u006c\u0065\u0045n\u0064\u0069a\u006e\u0020\u0066\u0061\u0069\u006ce\u0064\u003a \u0025\u0076",_ccg );
return nil ,_ccg ;};_ffe &=0xffffff;_agbg :=_ffe >>(_ecg -_bb );_eace :=_ca [_agbg ];if _eace !=nil &&_eace ._db {_agbg =(_ffe >>(_ecg -_bb -_afd ))&_bca ;_eace =_eace ._agg [_agbg ];};return _eace ,nil ;};type Decoder struct{_dcb ,_eef int ;_ef *runData ;
_bf []*code ;_cg []*code ;_ea []*code ;};func (_aa *Decoder )UncompressMMR ()(_gd *_c .Bitmap ,_ec error ){_gd =_c .New (_aa ._dcb ,_aa ._eef );_cgf :=make ([]int ,_gd .Width +5);_fdg :=make ([]int ,_gd .Width +5);_fdg [0]=_gd .Width ;_fad :=1;var _ge int ;
for _agb :=0;_agb < _gd .Height ;_agb ++{_ge ,_ec =_aa .uncompress2d (_aa ._ef ,_fdg ,_fad ,_cgf ,_gd .Width );if _ec !=nil {return nil ,_ec ;};if _ge ==EOF {break ;};if _ge > 0{_ec =_aa .fillBitmap (_gd ,_agb ,_cgf ,_ge );if _ec !=nil {return nil ,_ec ;
};};_fdg ,_cgf =_cgf ,_fdg ;_fad =_ge ;};if _ec =_aa .detectAndSkipEOL ();_ec !=nil {return nil ,_ec ;};_aa ._ef .align ();return _gd ,nil ;};func (_gfc *Decoder )detectAndSkipEOL ()error {for {_dddd ,_fae :=_gfc ._ef .uncompressGetCode (_gfc ._ea );if _fae !=nil {return _fae ;
};if _dddd !=nil &&_dddd ._bd ==EOL {_gfc ._ef ._ccd +=_dddd ._ag ;}else {return nil ;};};};func (_gfb *Decoder )uncompress1d (_cbf *runData ,_dcgd []int ,_cde int )(int ,error ){var (_ace =true ;_ce int ;_fef *code ;_gab int ;_eeb error ;);_cff :for _ce < _cde {_fc :for {if _ace {_fef ,_eeb =_cbf .uncompressGetCode (_gfb ._bf );
if _eeb !=nil {return 0,_eeb ;};}else {_fef ,_eeb =_cbf .uncompressGetCode (_gfb ._cg );if _eeb !=nil {return 0,_eeb ;};};_cbf ._ccd +=_fef ._ag ;if _fef ._bd < 0{break _cff ;};_ce +=_fef ._bd ;if _fef ._bd < 64{_ace =!_ace ;_dcgd [_gab ]=_ce ;_gab ++;
break _fc ;};};};if _dcgd [_gab ]!=_cde {_dcgd [_gab ]=_cde ;};_abe :=EOL ;if _fef !=nil &&_fef ._bd !=EOL {_abe =_gab ;};return _abe ,nil ;};func (_egbb *Decoder )createLittleEndianTable (_cd [][3]int )([]*code ,error ){_cga :=make ([]*code ,_cc +1);for _de :=0;
_de < len (_cd );_de ++{_dg :=_dc (_cd [_de ]);if _dg ._ag <=_bb {_ff :=_bb -_dg ._ag ;_cda :=_dg ._da <<uint (_ff );for _ba :=(1<<uint (_ff ))-1;_ba >=0;_ba --{_cf :=_cda |_ba ;_cga [_cf ]=_dg ;};}else {_bcb :=_dg ._da >>uint (_dg ._ag -_bb );if _cga [_bcb ]==nil {var _fdde =_dc ([3]int {});
_fdde ._agg =make ([]*code ,_bca +1);_cga [_bcb ]=_fdde ;};if _dg ._ag <=_bb +_afd {_ggg :=_bb +_afd -_dg ._ag ;_bge :=(_dg ._da <<uint (_ggg ))&_bca ;_cga [_bcb ]._db =true ;for _cdb :=(1<<uint (_ggg ))-1;_cdb >=0;_cdb --{_cga [_bcb ]._agg [_bge |_cdb ]=_dg ;
};}else {return nil ,_b .New ("\u0063\u006f\u0064\u0065\u0020\u0074a\u0062\u006c\u0065\u0020\u006f\u0076\u0065\u0072\u0066\u006c\u006f\u0077\u0020i\u006e\u0020\u004d\u004d\u0052\u0044\u0065c\u006f\u0064\u0065\u0072");};};};return _cga ,nil ;};const (_gdd int =1024<<7;
_fcg int =3;_ecg uint =24;);func _ed (_ga ,_gf int )int {if _ga > _gf {return _gf ;};return _ga ;};var (_eb =[][3]int {{4,0x1,int (_f )},{3,0x1,int (_eg )},{1,0x1,int (_bg )},{3,0x3,int (_bc )},{6,0x3,int (_gc )},{7,0x3,int (_egb )},{3,0x2,int (_gce )},{6,0x2,int (_cb )},{7,0x2,int (_gb )},{10,0xf,int (_fb )},{12,0xf,int (_fa )},{12,0x1,int (EOL )}};
_gg =[][3]int {{4,0x07,2},{4,0x08,3},{4,0x0B,4},{4,0x0C,5},{4,0x0E,6},{4,0x0F,7},{5,0x12,128},{5,0x13,8},{5,0x14,9},{5,0x1B,64},{5,0x07,10},{5,0x08,11},{6,0x17,192},{6,0x18,1664},{6,0x2A,16},{6,0x2B,17},{6,0x03,13},{6,0x34,14},{6,0x35,15},{6,0x07,1},{6,0x08,12},{7,0x13,26},{7,0x17,21},{7,0x18,28},{7,0x24,27},{7,0x27,18},{7,0x28,24},{7,0x2B,25},{7,0x03,22},{7,0x37,256},{7,0x04,23},{7,0x08,20},{7,0xC,19},{8,0x12,33},{8,0x13,34},{8,0x14,35},{8,0x15,36},{8,0x16,37},{8,0x17,38},{8,0x1A,31},{8,0x1B,32},{8,0x02,29},{8,0x24,53},{8,0x25,54},{8,0x28,39},{8,0x29,40},{8,0x2A,41},{8,0x2B,42},{8,0x2C,43},{8,0x2D,44},{8,0x03,30},{8,0x32,61},{8,0x33,62},{8,0x34,63},{8,0x35,0},{8,0x36,320},{8,0x37,384},{8,0x04,45},{8,0x4A,59},{8,0x4B,60},{8,0x5,46},{8,0x52,49},{8,0x53,50},{8,0x54,51},{8,0x55,52},{8,0x58,55},{8,0x59,56},{8,0x5A,57},{8,0x5B,58},{8,0x64,448},{8,0x65,512},{8,0x67,640},{8,0x68,576},{8,0x0A,47},{8,0x0B,48},{9,0x01,_af },{9,0x98,1472},{9,0x99,1536},{9,0x9A,1600},{9,0x9B,1728},{9,0xCC,704},{9,0xCD,768},{9,0xD2,832},{9,0xD3,896},{9,0xD4,960},{9,0xD5,1024},{9,0xD6,1088},{9,0xD7,1152},{9,0xD8,1216},{9,0xD9,1280},{9,0xDA,1344},{9,0xDB,1408},{10,0x01,_af },{11,0x01,_af },{11,0x08,1792},{11,0x0C,1856},{11,0x0D,1920},{12,0x00,EOF },{12,0x01,EOL },{12,0x12,1984},{12,0x13,2048},{12,0x14,2112},{12,0x15,2176},{12,0x16,2240},{12,0x17,2304},{12,0x1C,2368},{12,0x1D,2432},{12,0x1E,2496},{12,0x1F,2560}};
_cba =[][3]int {{2,0x02,3},{2,0x03,2},{3,0x02,1},{3,0x03,4},{4,0x02,6},{4,0x03,5},{5,0x03,7},{6,0x04,9},{6,0x05,8},{7,0x04,10},{7,0x05,11},{7,0x07,12},{8,0x04,13},{8,0x07,14},{9,0x01,_af },{9,0x18,15},{10,0x01,_af },{10,0x17,16},{10,0x18,17},{10,0x37,0},{10,0x08,18},{10,0x0F,64},{11,0x01,_af },{11,0x17,24},{11,0x18,25},{11,0x28,23},{11,0x37,22},{11,0x67,19},{11,0x68,20},{11,0x6C,21},{11,0x08,1792},{11,0x0C,1856},{11,0x0D,1920},{12,0x00,EOF },{12,0x01,EOL },{12,0x12,1984},{12,0x13,2048},{12,0x14,2112},{12,0x15,2176},{12,0x16,2240},{12,0x17,2304},{12,0x1C,2368},{12,0x1D,2432},{12,0x1E,2496},{12,0x1F,2560},{12,0x24,52},{12,0x27,55},{12,0x28,56},{12,0x2B,59},{12,0x2C,60},{12,0x33,320},{12,0x34,384},{12,0x35,448},{12,0x37,53},{12,0x38,54},{12,0x52,50},{12,0x53,51},{12,0x54,44},{12,0x55,45},{12,0x56,46},{12,0x57,47},{12,0x58,57},{12,0x59,58},{12,0x5A,61},{12,0x5B,256},{12,0x64,48},{12,0x65,49},{12,0x66,62},{12,0x67,63},{12,0x68,30},{12,0x69,31},{12,0x6A,32},{12,0x6B,33},{12,0x6C,40},{12,0x6D,41},{12,0xC8,128},{12,0xC9,192},{12,0xCA,26},{12,0xCB,27},{12,0xCC,28},{12,0xCD,29},{12,0xD2,34},{12,0xD3,35},{12,0xD4,36},{12,0xD5,37},{12,0xD6,38},{12,0xD7,39},{12,0xDA,42},{12,0xDB,43},{13,0x4A,640},{13,0x4B,704},{13,0x4C,768},{13,0x4D,832},{13,0x52,1280},{13,0x53,1344},{13,0x54,1408},{13,0x55,1472},{13,0x5A,1536},{13,0x5B,1600},{13,0x64,1664},{13,0x65,1728},{13,0x6C,512},{13,0x6D,576},{13,0x72,896},{13,0x73,960},{13,0x74,1024},{13,0x75,1088},{13,0x76,1152},{13,0x77,1216}};
);func New (r *_d .Reader ,width ,height int ,dataOffset ,dataLength int64 )(*Decoder ,error ){_df :=&Decoder {_dcb :width ,_eef :height };_fd ,_ega :=r .NewPartialReader (int (dataOffset ),int (dataLength ),false );if _ega !=nil {return nil ,_ega ;};_fdd ,_ega :=_beb (_fd );
if _ega !=nil {return nil ,_ega ;};_ ,_ega =r .Seek (_fd .RelativePosition (),_a .SeekCurrent );if _ega !=nil {return nil ,_ega ;};_df ._ef =_fdd ;if _edb :=_df .initTables ();_edb !=nil {return nil ,_edb ;};return _df ,nil ;};func (_ggbc *Decoder )initTables ()(_agc error ){if _ggbc ._bf ==nil {_ggbc ._bf ,_agc =_ggbc .createLittleEndianTable (_gg );
if _agc !=nil {return ;};_ggbc ._cg ,_agc =_ggbc .createLittleEndianTable (_cba );if _agc !=nil {return ;};_ggbc ._ea ,_agc =_ggbc .createLittleEndianTable (_eb );if _agc !=nil {return ;};};return nil ;};func (_gfa *runData )uncompressGetNextCodeLittleEndian ()(int ,error ){_fade :=_gfa ._ccd -_gfa ._fgf ;
if _fade < 0||_fade > 24{_dcc :=(_gfa ._ccd >>3)-_gfa ._gdb ;if _dcc >=_gfa ._gda {_dcc +=_gfa ._gdb ;if _bfe :=_gfa .fillBuffer (_dcc );_bfe !=nil {return 0,_bfe ;};_dcc -=_gfa ._gdb ;};_feg :=(uint32 (_gfa ._cdba [_dcc ]&0xFF)<<16)|(uint32 (_gfa ._cdba [_dcc +1]&0xFF)<<8)|(uint32 (_gfa ._cdba [_dcc +2]&0xFF));
_cdbf :=uint32 (_gfa ._ccd &7);_feg <<=_cdbf ;_gfa ._ecc =int (_feg );}else {_bdf :=_gfa ._fgf &7;_ecge :=7-_bdf ;if _fade <=_ecge {_gfa ._ecc <<=uint (_fade );}else {_egab :=(_gfa ._fgf >>3)+3-_gfa ._gdb ;if _egab >=_gfa ._gda {_egab +=_gfa ._gdb ;if _gdc :=_gfa .fillBuffer (_egab );
_gdc !=nil {return 0,_gdc ;};_egab -=_gfa ._gdb ;};_bdf =8-_bdf ;for {_gfa ._ecc <<=uint (_bdf );_gfa ._ecc |=int (uint (_gfa ._cdba [_egab ])&0xFF);_fade -=_bdf ;_egab ++;_bdf =8;if !(_fade >=8){break ;};};_gfa ._ecc <<=uint (_fade );};};_gfa ._fgf =_gfa ._ccd ;
return _gfa ._ecc ,nil ;};func _dc (_dd [3]int )*code {return &code {_ag :_dd [0],_da :_dd [1],_bd :_dd [2]}};const (EOF =-3;_af =-2;EOL =-1;_bb =8;_cc =(1<<_bb )-1;_afd =5;_bca =(1<<_afd )-1;);type runData struct{_dee *_d .Reader ;_ccd int ;_fgf int ;
_ecc int ;_cdba []byte ;_gdb int ;_gda int ;};const (_f mmrCode =iota ;_eg ;_bg ;_bc ;_gc ;_egb ;_gce ;_cb ;_gb ;_fb ;_fa ;);func _dcg (_ab ,_ee int )int {if _ab < _ee {return _ee ;};return _ab ;};func (_efg *Decoder )fillBitmap (_bea *_c .Bitmap ,_ac int ,_cce []int ,_eac int )error {var _ad byte ;
_eaa :=0;_efd :=_bea .GetByteIndex (_eaa ,_ac );for _fe :=0;_fe < _eac ;_fe ++{_fg :=byte (1);_ggb :=_cce [_fe ];if (_fe &1)==0{_fg =0;};for _eaa < _ggb {_ad =(_ad <<1)|_fg ;_eaa ++;if (_eaa &7)==0{if _ade :=_bea .SetByte (_efd ,_ad );_ade !=nil {return _ade ;
};_efd ++;_ad =0;};};};if (_eaa &7)!=0{_ad <<=uint (8-(_eaa &7));if _beaa :=_bea .SetByte (_efd ,_ad );_beaa !=nil {return _beaa ;};};return nil ;};func (_acd *runData )uncompressGetCode (_aba []*code )(*code ,error ){return _acd .uncompressGetCodeLittleEndian (_aba );
};func (_ddd *code )String ()string {return _e .Sprintf ("\u0025\u0064\u002f\u0025\u0064\u002f\u0025\u0064",_ddd ._ag ,_ddd ._da ,_ddd ._bd );};func (_dec *runData )align (){_dec ._ccd =((_dec ._ccd +7)>>3)<<3};type code struct{_ag int ;_da int ;_bd int ;
_agg []*code ;_db bool ;};func (_fgd *Decoder )uncompress2d (_ggga *runData ,_ccee []int ,_fbc int ,_baa []int ,_adb int )(int ,error ){var (_dcbg int ;_dae int ;_abd int ;_eeg =true ;_deb error ;_bfb *code ;);_ccee [_fbc ]=_adb ;_ccee [_fbc +1]=_adb ;
_ccee [_fbc +2]=_adb +1;_ccee [_fbc +3]=_adb +1;_eaag :for _abd < _adb {_bfb ,_deb =_ggga .uncompressGetCode (_fgd ._ea );if _deb !=nil {return EOL ,nil ;};if _bfb ==nil {_ggga ._ccd ++;break _eaag ;};_ggga ._ccd +=_bfb ._ag ;switch mmrCode (_bfb ._bd ){case _bg :_abd =_ccee [_dcbg ];
case _bc :_abd =_ccee [_dcbg ]+1;case _gce :_abd =_ccee [_dcbg ]-1;case _eg :for {var _fge []*code ;if _eeg {_fge =_fgd ._bf ;}else {_fge =_fgd ._cg ;};_bfb ,_deb =_ggga .uncompressGetCode (_fge );if _deb !=nil {return 0,_deb ;};if _bfb ==nil {break _eaag ;
};_ggga ._ccd +=_bfb ._ag ;if _bfb ._bd < 64{if _bfb ._bd < 0{_baa [_dae ]=_abd ;_dae ++;_bfb =nil ;break _eaag ;};_abd +=_bfb ._bd ;_baa [_dae ]=_abd ;_dae ++;break ;};_abd +=_bfb ._bd ;};_bgd :=_abd ;_fadf :for {var _gaf []*code ;if !_eeg {_gaf =_fgd ._bf ;
}else {_gaf =_fgd ._cg ;};_bfb ,_deb =_ggga .uncompressGetCode (_gaf );if _deb !=nil {return 0,_deb ;};if _bfb ==nil {break _eaag ;};_ggga ._ccd +=_bfb ._ag ;if _bfb ._bd < 64{if _bfb ._bd < 0{_baa [_dae ]=_abd ;_dae ++;break _eaag ;};_abd +=_bfb ._bd ;
if _abd < _adb ||_abd !=_bgd {_baa [_dae ]=_abd ;_dae ++;};break _fadf ;};_abd +=_bfb ._bd ;};for _abd < _adb &&_ccee [_dcbg ]<=_abd {_dcbg +=2;};continue _eaag ;case _f :_dcbg ++;_abd =_ccee [_dcbg ];_dcbg ++;continue _eaag ;case _gc :_abd =_ccee [_dcbg ]+2;
case _cb :_abd =_ccee [_dcbg ]-2;case _egb :_abd =_ccee [_dcbg ]+3;case _gb :_abd =_ccee [_dcbg ]-3;default:if _ggga ._ccd ==12&&_bfb ._bd ==EOL {_ggga ._ccd =0;if _ ,_deb =_fgd .uncompress1d (_ggga ,_ccee ,_adb );_deb !=nil {return 0,_deb ;};_ggga ._ccd ++;
if _ ,_deb =_fgd .uncompress1d (_ggga ,_baa ,_adb );_deb !=nil {return 0,_deb ;};_eega ,_acc :=_fgd .uncompress1d (_ggga ,_ccee ,_adb );if _acc !=nil {return EOF ,_acc ;};_ggga ._ccd ++;return _eega ,nil ;};_abd =_adb ;continue _eaag ;};if _abd <=_adb {_eeg =!_eeg ;
_baa [_dae ]=_abd ;_dae ++;if _dcbg > 0{_dcbg --;}else {_dcbg ++;};for _abd < _adb &&_ccee [_dcbg ]<=_abd {_dcbg +=2;};};};if _baa [_dae ]!=_adb {_baa [_dae ]=_adb ;};if _bfb ==nil {return EOL ,nil ;};return _dae ,nil ;};type mmrCode int ;