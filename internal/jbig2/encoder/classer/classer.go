//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package classer ;import (_ec "github.com/unidoc/unipdf/v4/common";_c "github.com/unidoc/unipdf/v4/internal/jbig2/basic";_d "github.com/unidoc/unipdf/v4/internal/jbig2/bitmap";_f "github.com/unidoc/unipdf/v4/internal/jbig2/errors";_e "image";_g "math";);
func (_ae *Classer )verifyMethod (_de Method )error {if _de !=RankHaus &&_de !=Correlation {return _f .Error ("\u0076\u0065\u0072i\u0066\u0079\u004d\u0065\u0074\u0068\u006f\u0064","\u0069\u006e\u0076\u0061li\u0064\u0020\u0063\u006c\u0061\u0073\u0073\u0065\u0072\u0020\u006d\u0065\u0074\u0068o\u0064");
};return nil ;};type Method int ;func (_cbg Settings )Validate ()error {const _aca ="\u0053\u0065\u0074\u0074\u0069\u006e\u0067\u0073\u002e\u0056\u0061\u006ci\u0064\u0061\u0074\u0065";if _cbg .Thresh < 0.4||_cbg .Thresh > 0.98{return _f .Error (_aca ,"\u006a\u0062i\u0067\u0032\u0020\u0065\u006e\u0063\u006f\u0064\u0065\u0072\u0020\u0074\u0068\u0072\u0065\u0073\u0068\u0020\u006e\u006f\u0074\u0020\u0069\u006e\u0020\u0072\u0061\u006e\u0067\u0065\u0020\u005b\u0030\u002e\u0034\u0020\u002d\u0020\u0030\u002e\u0039\u0038\u005d");
};if _cbg .WeightFactor < 0.0||_cbg .WeightFactor > 1.0{return _f .Error (_aca ,"\u006a\u0062i\u0067\u0032\u0020\u0065\u006ec\u006f\u0064\u0065\u0072\u0020w\u0065\u0069\u0067\u0068\u0074\u0020\u0066\u0061\u0063\u0074\u006f\u0072\u0020\u006e\u006f\u0074\u0020\u0069\u006e\u0020\u0072\u0061\u006e\u0067\u0065\u0020\u005b\u0030\u002e\u0030\u0020\u002d\u0020\u0031\u002e\u0030\u005d");
};if _cbg .RankHaus < 0.5||_cbg .RankHaus > 1.0{return _f .Error (_aca ,"\u006a\u0062\u0069\u0067\u0032\u0020\u0065\u006e\u0063\u006f\u0064\u0065\u0072\u0020\u0072a\u006e\u006b\u0020\u0068\u0061\u0075\u0073\u0020\u0076\u0061\u006c\u0075\u0065 \u006e\u006f\u0074\u0020\u0069\u006e\u0020\u0072\u0061\u006e\u0067\u0065 [\u0030\u002e\u0035\u0020\u002d\u0020\u0031\u002e\u0030\u005d");
};if _cbg .SizeHaus < 1||_cbg .SizeHaus > 10{return _f .Error (_aca ,"\u006a\u0062\u0069\u0067\u0032 \u0065\u006e\u0063\u006f\u0064\u0065\u0072\u0020\u0073\u0069\u007a\u0065\u0020h\u0061\u0075\u0073\u0020\u0076\u0061\u006c\u0075\u0065\u0020\u006e\u006f\u0074\u0020\u0069\u006e\u0020\u0072\u0061\u006e\u0067\u0065\u0020\u005b\u0031\u0020\u002d\u0020\u0031\u0030]");
};switch _cbg .Components {case _d .ComponentConn ,_d .ComponentCharacters ,_d .ComponentWords :default:return _f .Error (_aca ,"\u0069n\u0076\u0061\u006c\u0069d\u0020\u0063\u006c\u0061\u0073s\u0065r\u0020c\u006f\u006d\u0070\u006f\u006e\u0065\u006et");
};return nil ;};var TwoByTwoWalk =[]int {0,0,0,1,-1,0,0,-1,1,0,-1,1,1,1,-1,-1,1,-1,0,-2,2,0,0,2,-2,0,-1,-2,1,-2,2,-1,2,1,1,2,-1,2,-2,1,-2,-1,-2,-2,2,-2,2,2,-2,2};func (_gaf *similarTemplatesFinder )Next ()int {var (_cgg ,_dbe ,_eae ,_ebba int ;_cfae bool ;
_edeg *_d .Bitmap ;_bgd error ;);for {if _gaf .Index >=25{return -1;};_dbe =_gaf .Width +TwoByTwoWalk [2*_gaf .Index ];_cgg =_gaf .Height +TwoByTwoWalk [2*_gaf .Index +1];if _cgg < 1||_dbe < 1{_gaf .Index ++;continue ;};if len (_gaf .CurrentNumbers )==0{_gaf .CurrentNumbers ,_cfae =_gaf .Classer .TemplatesSize .GetSlice (uint64 (_dbe )*uint64 (_cgg ));
if !_cfae {_gaf .Index ++;continue ;};_gaf .N =0;};_eae =len (_gaf .CurrentNumbers );for ;_gaf .N < _eae ;_gaf .N ++{_ebba =_gaf .CurrentNumbers [_gaf .N ];_edeg ,_bgd =_gaf .Classer .DilatedTemplates .GetBitmap (_ebba );if _bgd !=nil {_ec .Log .Debug ("\u0046\u0069\u006e\u0064\u004e\u0065\u0078\u0074\u0054\u0065\u006d\u0070\u006c\u0061\u0074\u0065\u003a\u0020\u0074\u0065\u006d\u0070\u006c\u0061t\u0065\u0020\u006e\u006f\u0074 \u0066\u006fu\u006e\u0064\u003a\u0020");
return 0;};if _edeg .Width -2*JbAddedPixels ==_dbe &&_edeg .Height -2*JbAddedPixels ==_cgg {return _ebba ;};};_gaf .Index ++;_gaf .CurrentNumbers =nil ;};};const JbAddedPixels =6;const (RankHaus Method =iota ;Correlation ;);func DefaultSettings ()Settings {_fec :=&Settings {};
_fec .SetDefault ();return *_fec };func (_ebdd *Classer )classifyCorrelation (_ecc *_d .Boxes ,_fba *_d .Bitmaps ,_fdd int )error {const _gaa ="\u0063\u006c\u0061\u0073si\u0066\u0079\u0043\u006f\u0072\u0072\u0065\u006c\u0061\u0074\u0069\u006f\u006e";if _ecc ==nil {return _f .Error (_gaa ,"\u006e\u0065\u0077\u0043\u006f\u006d\u0070\u006f\u006e\u0065\u006e\u0074\u0073\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062o\u0078\u0065\u0073\u0020\u006eo\u0074\u0020f\u006f\u0075\u006e\u0064");
};if _fba ==nil {return _f .Error (_gaa ,"\u006e\u0065wC\u006f\u006d\u0070o\u006e\u0065\u006e\u0074s b\u0069tm\u0061\u0070\u0020\u0061\u0072\u0072\u0061y \u006e\u006f\u0074\u0020\u0066\u006f\u0075n\u0064");};_cf :=len (_fba .Values );if _cf ==0{_ec .Log .Debug ("\u0063l\u0061\u0073s\u0069\u0066\u0079C\u006f\u0072\u0072\u0065\u006c\u0061\u0074i\u006f\u006e\u0020\u002d\u0020\u0070r\u006f\u0076\u0069\u0064\u0065\u0064\u0020\u0070\u0069\u0078\u0061s\u0020\u0069\u0073\u0020\u0065\u006d\u0070\u0074\u0079");
return nil ;};var (_acg ,_bcc *_d .Bitmap ;_cdf error ;);_aea :=&_d .Bitmaps {Values :make ([]*_d .Bitmap ,_cf )};for _edcc ,_dab :=range _fba .Values {_bcc ,_cdf =_dab .AddBorderGeneral (JbAddedPixels ,JbAddedPixels ,JbAddedPixels ,JbAddedPixels ,0);if _cdf !=nil {return _f .Wrap (_cdf ,_gaa ,"");
};_aea .Values [_edcc ]=_bcc ;};_ebb :=_ebdd .FgTemplates ;_ade :=_d .MakePixelSumTab8 ();_agc :=_d .MakePixelCentroidTab8 ();_bgf :=make ([]int ,_cf );_cfg :=make ([][]int ,_cf );_eag :=_d .Points (make ([]_d .Point ,_cf ));_cbe :=&_eag ;var (_cbee ,_aeg int ;
_dcc ,_gde ,_dag int ;_aef ,_eaba int ;_gaad byte ;);for _cce ,_daf :=range _aea .Values {_cfg [_cce ]=make ([]int ,_daf .Height );_cbee =0;_aeg =0;_gde =(_daf .Height -1)*_daf .RowStride ;_dcc =0;for _eaba =_daf .Height -1;_eaba >=0;_eaba ,_gde =_eaba -1,_gde -_daf .RowStride {_cfg [_cce ][_eaba ]=_dcc ;
_dag =0;for _aef =0;_aef < _daf .RowStride ;_aef ++{_gaad =_daf .Data [_gde +_aef ];_dag +=_ade [_gaad ];_cbee +=_agc [_gaad ]+_aef *8*_ade [_gaad ];};_dcc +=_dag ;_aeg +=_dag *_eaba ;};_bgf [_cce ]=_dcc ;if _dcc > 0{(*_cbe )[_cce ]=_d .Point {X :float32 (_cbee )/float32 (_dcc ),Y :float32 (_aeg )/float32 (_dcc )};
}else {(*_cbe )[_cce ]=_d .Point {X :float32 (_daf .Width )/float32 (2),Y :float32 (_daf .Height )/float32 (2)};};};if _cdf =_ebdd .CentroidPoints .Add (_cbe );_cdf !=nil {return _f .Wrap (_cdf ,_gaa ,"\u0063\u0065\u006et\u0072\u006f\u0069\u0064\u0020\u0061\u0064\u0064");
};var (_dfg ,_bfe ,_bcf int ;_bccb float64 ;_ggd ,_ce ,_fdf ,_be float32 ;_ecb ,_cea _d .Point ;_ecgd bool ;_bfg *similarTemplatesFinder ;_geg int ;_fga *_d .Bitmap ;_gef *_e .Rectangle ;_ccfa *_d .Bitmaps ;);for _geg ,_bcc =range _aea .Values {_bfe =_bgf [_geg ];
if _ggd ,_ce ,_cdf =_cbe .GetGeometry (_geg );_cdf !=nil {return _f .Wrap (_cdf ,_gaa ,"\u0070t\u0061\u0020\u002d\u0020\u0069");};_ecgd =false ;_gdb :=len (_ebdd .UndilatedTemplates .Values );_bfg =_fgcgd (_ebdd ,_bcc );for _eg :=_bfg .Next ();_eg > -1;
{if _fga ,_cdf =_ebdd .UndilatedTemplates .GetBitmap (_eg );_cdf !=nil {return _f .Wrap (_cdf ,_gaa ,"\u0075\u006e\u0069dl\u0061\u0074\u0065\u0064\u005b\u0069\u0063\u006c\u0061\u0073\u0073\u005d\u0020\u003d\u0020\u0062\u006d\u0032");};if _bcf ,_cdf =_ebb .GetInt (_eg );
_cdf !=nil {_ec .Log .Trace ("\u0046\u0047\u0020T\u0065\u006d\u0070\u006ca\u0074\u0065\u0020\u005b\u0069\u0063\u006ca\u0073\u0073\u005d\u0020\u0066\u0061\u0069\u006c\u0065\u0064\u003a\u0020\u0025\u0076",_cdf );};if _fdf ,_be ,_cdf =_ebdd .CentroidPointsTemplates .GetGeometry (_eg );
_cdf !=nil {return _f .Wrap (_cdf ,_gaa ,"\u0043\u0065\u006e\u0074\u0072\u006f\u0069\u0064\u0050\u006f\u0069\u006e\u0074T\u0065\u006d\u0070\u006c\u0061\u0074e\u0073\u005b\u0069\u0063\u006c\u0061\u0073\u0073\u005d\u0020\u003d\u0020\u00782\u002c\u0079\u0032\u0020");
};if _ebdd .Settings .WeightFactor > 0.0{if _dfg ,_cdf =_ebdd .TemplateAreas .Get (_eg );_cdf !=nil {_ec .Log .Trace ("\u0054\u0065\u006dp\u006c\u0061\u0074\u0065A\u0072\u0065\u0061\u0073\u005b\u0069\u0063l\u0061\u0073\u0073\u005d\u0020\u003d\u0020\u0061\u0072\u0065\u0061\u0020\u0025\u0076",_cdf );
};_bccb =_ebdd .Settings .Thresh +(1.0-_ebdd .Settings .Thresh )*_ebdd .Settings .WeightFactor *float64 (_bcf )/float64 (_dfg );}else {_bccb =_ebdd .Settings .Thresh ;};_gfg ,_dea :=_d .CorrelationScoreThresholded (_bcc ,_fga ,_bfe ,_bcf ,_ecb .X -_cea .X ,_ecb .Y -_cea .Y ,MaxDiffWidth ,MaxDiffHeight ,_ade ,_cfg [_geg ],float32 (_bccb ));
if _dea !=nil {return _f .Wrap (_dea ,_gaa ,"");};if _ff {var (_fbc ,_fcf float64 ;_fde ,_ebc int ;);_fbc ,_dea =_d .CorrelationScore (_bcc ,_fga ,_bfe ,_bcf ,_ggd -_fdf ,_ce -_be ,MaxDiffWidth ,MaxDiffHeight ,_ade );if _dea !=nil {return _f .Wrap (_dea ,_gaa ,"d\u0065\u0062\u0075\u0067Co\u0072r\u0065\u006c\u0061\u0074\u0069o\u006e\u0053\u0063\u006f\u0072\u0065");
};_fcf ,_dea =_d .CorrelationScoreSimple (_bcc ,_fga ,_bfe ,_bcf ,_ggd -_fdf ,_ce -_be ,MaxDiffWidth ,MaxDiffHeight ,_ade );if _dea !=nil {return _f .Wrap (_dea ,_gaa ,"d\u0065\u0062\u0075\u0067Co\u0072r\u0065\u006c\u0061\u0074\u0069o\u006e\u0053\u0063\u006f\u0072\u0065");
};_fde =int (_g .Sqrt (_fbc *float64 (_bfe )*float64 (_bcf )));_ebc =int (_g .Sqrt (_fcf *float64 (_bfe )*float64 (_bcf )));if (_fbc >=_bccb )!=(_fcf >=_bccb ){return _f .Errorf (_gaa ,"\u0064\u0065\u0062\u0075\u0067\u0020\u0043\u006f\u0072r\u0065\u006c\u0061\u0074\u0069\u006f\u006e\u0020\u0073\u0063\u006f\u0072\u0065\u0020\u006d\u0069\u0073\u006d\u0061\u0074\u0063\u0068\u0020-\u0020\u0025d\u0028\u00250\u002e\u0034\u0066\u002c\u0020\u0025\u0076\u0029\u0020\u0076\u0073\u0020\u0025d(\u0025\u0030\u002e\u0034\u0066\u002c\u0020\u0025\u0076)\u0020\u0025\u0030\u002e\u0034\u0066",_fde ,_fbc ,_fbc >=_bccb ,_ebc ,_fcf ,_fcf >=_bccb ,_fbc -_fcf );
};if _fbc >=_bccb !=_gfg {return _f .Errorf (_gaa ,"\u0064\u0065\u0062\u0075\u0067\u0020\u0043o\u0072\u0072\u0065\u006c\u0061\u0074\u0069\u006f\u006e \u0073\u0063\u006f\u0072\u0065 \u004d\u0069\u0073\u006d\u0061t\u0063\u0068 \u0062\u0065\u0074w\u0065\u0065\u006e\u0020\u0063\u006frr\u0065\u006c\u0061\u0074\u0069\u006f\u006e\u0020/\u0020\u0074\u0068\u0072\u0065s\u0068\u006f\u006c\u0064\u002e\u0020\u0043\u006f\u006dpa\u0072\u0069\u0073\u006f\u006e:\u0020\u0025\u0030\u002e\u0034\u0066\u0028\u0025\u0030\u002e\u0034\u0066\u002c\u0020\u0025\u0064\u0029\u0020\u003e\u003d\u0020\u00250\u002e\u0034\u0066\u0028\u0025\u0030\u002e\u0034\u0066\u0029\u0020\u0076\u0073\u0020\u0025\u0076",_fbc ,_fbc *float64 (_bfe )*float64 (_bcf ),_fde ,_bccb ,float32 (_bccb )*float32 (_bfe )*float32 (_bcf ),_gfg );
};};if _gfg {_ecgd =true ;if _dea =_ebdd .ClassIDs .Add (_eg );_dea !=nil {return _f .Wrap (_dea ,_gaa ,"\u006f\u0076\u0065\u0072\u0054\u0068\u0072\u0065\u0073\u0068\u006f\u006c\u0064");};if _dea =_ebdd .ComponentPageNumbers .Add (_fdd );_dea !=nil {return _f .Wrap (_dea ,_gaa ,"\u006f\u0076\u0065\u0072\u0054\u0068\u0072\u0065\u0073\u0068\u006f\u006c\u0064");
};if _ebdd .Settings .KeepClassInstances {if _acg ,_dea =_fba .GetBitmap (_geg );_dea !=nil {return _f .Wrap (_dea ,_gaa ,"\u004b\u0065\u0065\u0070Cl\u0061\u0073\u0073\u0049\u006e\u0073\u0074\u0061\u006e\u0063\u0065\u0073\u0020\u002d \u0069");};if _ccfa ,_dea =_ebdd .ClassInstances .GetBitmaps (_eg );
_dea !=nil {return _f .Wrap (_dea ,_gaa ,"K\u0065\u0065\u0070\u0043\u006c\u0061s\u0073\u0049\u006e\u0073\u0074\u0061\u006e\u0063\u0065s\u0020\u002d\u0020i\u0043l\u0061\u0073\u0073");};_ccfa .AddBitmap (_acg );if _gef ,_dea =_ecc .Get (_geg );_dea !=nil {return _f .Wrap (_dea ,_gaa ,"\u004be\u0065p\u0043\u006c\u0061\u0073\u0073I\u006e\u0073t\u0061\u006e\u0063\u0065\u0073");
};_ccfa .AddBox (_gef );};break ;};};if !_ecgd {if _cdf =_ebdd .ClassIDs .Add (_gdb );_cdf !=nil {return _f .Wrap (_cdf ,_gaa ,"\u0021\u0066\u006f\u0075\u006e\u0064");};if _cdf =_ebdd .ComponentPageNumbers .Add (_fdd );_cdf !=nil {return _f .Wrap (_cdf ,_gaa ,"\u0021\u0066\u006f\u0075\u006e\u0064");
};_ccfa =&_d .Bitmaps {};if _acg ,_cdf =_fba .GetBitmap (_geg );_cdf !=nil {return _f .Wrap (_cdf ,_gaa ,"\u0021\u0066\u006f\u0075\u006e\u0064");};_ccfa .AddBitmap (_acg );_abd ,_cga :=_acg .Width ,_acg .Height ;_ccad :=uint64 (_cga )*uint64 (_abd );_ebdd .TemplatesSize .Add (_ccad ,_gdb );
if _gef ,_cdf =_ecc .Get (_geg );_cdf !=nil {return _f .Wrap (_cdf ,_gaa ,"\u0021\u0066\u006f\u0075\u006e\u0064");};_ccfa .AddBox (_gef );_ebdd .ClassInstances .AddBitmaps (_ccfa );_ebdd .CentroidPointsTemplates .AddPoint (_ggd ,_ce );_ebdd .FgTemplates .AddInt (_bfe );
_ebdd .UndilatedTemplates .AddBitmap (_acg );_dfg =(_bcc .Width -2*JbAddedPixels )*(_bcc .Height -2*JbAddedPixels );if _cdf =_ebdd .TemplateAreas .Add (_dfg );_cdf !=nil {return _f .Wrap (_cdf ,_gaa ,"\u0021\u0066\u006f\u0075\u006e\u0064");};};};_ebdd .NumberOfClasses =len (_ebdd .UndilatedTemplates .Values );
return nil ;};func (_ccf *Classer )addPageComponents (_df *_d .Bitmap ,_ac *_d .Boxes ,_bf *_d .Bitmaps ,_bfc int ,_fc Method )error {const _afc ="\u0043l\u0061\u0073\u0073\u0065r\u002e\u0041\u0064\u0064\u0050a\u0067e\u0043o\u006d\u0070\u006f\u006e\u0065\u006e\u0074s";
if _df ==nil {return _f .Error (_afc ,"\u006e\u0069\u006c\u0020\u0069\u006e\u0070\u0075\u0074 \u0070\u0061\u0067\u0065");};if _ac ==nil ||_bf ==nil ||len (*_ac )==0{_ec .Log .Trace ("\u0041\u0064\u0064P\u0061\u0067\u0065\u0043\u006f\u006d\u0070\u006f\u006e\u0065\u006e\u0074\u0073\u003a\u0020\u0025\u0073\u002e\u0020\u004e\u006f\u0020\u0063\u006f\u006d\u0070\u006f\u006e\u0065n\u0074\u0073\u0020\u0066\u006f\u0075\u006e\u0064",_df );
return nil ;};var _ca error ;switch _fc {case RankHaus :_ca =_ccf .classifyRankHaus (_ac ,_bf ,_bfc );case Correlation :_ca =_ccf .classifyCorrelation (_ac ,_bf ,_bfc );default:_ec .Log .Debug ("\u0055\u006ek\u006e\u006f\u0077\u006e\u0020\u0063\u006c\u0061\u0073\u0073\u0069\u0066\u0079\u0020\u006d\u0065\u0074\u0068\u006f\u0064\u003a\u0020'%\u0076\u0027",_fc );
return _f .Error (_afc ,"\u0075\u006e\u006bno\u0077\u006e\u0020\u0063\u006c\u0061\u0073\u0073\u0069\u0066\u0079\u0020\u006d\u0065\u0074\u0068\u006f\u0064");};if _ca !=nil {return _f .Wrap (_ca ,_afc ,"");};if _ca =_ccf .getULCorners (_df ,_ac );_ca !=nil {return _f .Wrap (_ca ,_afc ,"");
};_cae :=len (*_ac );_ccf .BaseIndex +=_cae ;if _ca =_ccf .ComponentsNumber .Add (_cae );_ca !=nil {return _f .Wrap (_ca ,_afc ,"");};return nil ;};func (_bfb *Settings )SetDefault (){if _bfb .MaxCompWidth ==0{switch _bfb .Components {case _d .ComponentConn :_bfb .MaxCompWidth =MaxConnCompWidth ;
case _d .ComponentCharacters :_bfb .MaxCompWidth =MaxCharCompWidth ;case _d .ComponentWords :_bfb .MaxCompWidth =MaxWordCompWidth ;};};if _bfb .MaxCompHeight ==0{_bfb .MaxCompHeight =MaxCompHeight ;};if _bfb .Thresh ==0.0{_bfb .Thresh =0.9;};if _bfb .WeightFactor ==0.0{_bfb .WeightFactor =0.75;
};if _bfb .RankHaus ==0.0{_bfb .RankHaus =0.97;};if _bfb .SizeHaus ==0{_bfb .SizeHaus =2;};};type Classer struct{BaseIndex int ;Settings Settings ;ComponentsNumber *_c .IntSlice ;TemplateAreas *_c .IntSlice ;Widths map[int ]int ;Heights map[int ]int ;NumberOfClasses int ;
ClassInstances *_d .BitmapsArray ;UndilatedTemplates *_d .Bitmaps ;DilatedTemplates *_d .Bitmaps ;TemplatesSize _c .IntsMap ;FgTemplates *_c .NumSlice ;CentroidPoints *_d .Points ;CentroidPointsTemplates *_d .Points ;ClassIDs *_c .IntSlice ;ComponentPageNumbers *_c .IntSlice ;
PtaUL *_d .Points ;PtaLL *_d .Points ;};func Init (settings Settings )(*Classer ,error ){const _gd ="\u0063\u006c\u0061s\u0073\u0065\u0072\u002e\u0049\u006e\u0069\u0074";_cb :=&Classer {Settings :settings ,Widths :map[int ]int {},Heights :map[int ]int {},TemplatesSize :_c .IntsMap {},TemplateAreas :&_c .IntSlice {},ComponentPageNumbers :&_c .IntSlice {},ClassIDs :&_c .IntSlice {},ComponentsNumber :&_c .IntSlice {},CentroidPoints :&_d .Points {},CentroidPointsTemplates :&_d .Points {},UndilatedTemplates :&_d .Bitmaps {},DilatedTemplates :&_d .Bitmaps {},ClassInstances :&_d .BitmapsArray {},FgTemplates :&_c .NumSlice {}};
if _fb :=_cb .Settings .Validate ();_fb !=nil {return nil ,_f .Wrap (_fb ,_gd ,"");};return _cb ,nil ;};func _ad (_fcb *_d .Bitmap ,_caed ,_aae ,_deg ,_adg int ,_gf *_d .Bitmap )(_feb _e .Point ,_ab error ){const _ebd ="\u0066i\u006e\u0061\u006c\u0041l\u0069\u0067\u006e\u006d\u0065n\u0074P\u006fs\u0069\u0074\u0069\u006f\u006e\u0069\u006eg";
if _fcb ==nil {return _feb ,_f .Error (_ebd ,"\u0073\u006f\u0075\u0072ce\u0020\u006e\u006f\u0074\u0020\u0070\u0072\u006f\u0076\u0069\u0064\u0065\u0064");};if _gf ==nil {return _feb ,_f .Error (_ebd ,"t\u0065\u006d\u0070\u006cat\u0065 \u006e\u006f\u0074\u0020\u0070r\u006f\u0076\u0069\u0064\u0065\u0064");
};_gc ,_ded :=_gf .Width ,_gf .Height ;_ge ,_ccd :=_caed -_deg -JbAddedPixels ,_aae -_adg -JbAddedPixels ;_ec .Log .Trace ("\u0078\u003a\u0020\u0027\u0025\u0064\u0027\u002c\u0020\u0079\u003a\u0020\u0027\u0025\u0064'\u002c\u0020\u0077\u003a\u0020\u0027\u0025\u0064\u0027\u002c\u0020\u0068\u003a \u0027\u0025\u0064\u0027\u002c\u0020\u0062\u0078\u003a\u0020\u0027\u0025d'\u002c\u0020\u0062\u0079\u003a\u0020\u0027\u0025\u0064\u0027",_caed ,_aae ,_gc ,_ded ,_ge ,_ccd );
_eab ,_ab :=_d .Rect (_ge ,_ccd ,_gc ,_ded );if _ab !=nil {return _feb ,_f .Wrap (_ab ,_ebd ,"");};_dce ,_ ,_ab :=_fcb .ClipRectangle (_eab );if _ab !=nil {_ec .Log .Error ("\u0043a\u006e\u0027\u0074\u0020\u0063\u006c\u0069\u0070\u0020\u0072\u0065c\u0074\u0061\u006e\u0067\u006c\u0065\u003a\u0020\u0025\u0076",_eab );
return _feb ,_f .Wrap (_ab ,_ebd ,"");};_ga :=_d .New (_dce .Width ,_dce .Height );_dgg :=_g .MaxInt32 ;var _da ,_gab ,_ee ,_adgc ,_agb int ;for _da =-1;_da <=1;_da ++{for _gab =-1;_gab <=1;_gab ++{if _ ,_ab =_d .Copy (_ga ,_dce );_ab !=nil {return _feb ,_f .Wrap (_ab ,_ebd ,"");
};if _ab =_ga .RasterOperation (_gab ,_da ,_gc ,_ded ,_d .PixSrcXorDst ,_gf ,0,0);_ab !=nil {return _feb ,_f .Wrap (_ab ,_ebd ,"");};_ee =_ga .CountPixels ();if _ee < _dgg {_adgc =_gab ;_agb =_da ;_dgg =_ee ;};};};_feb .X =_adgc ;_feb .Y =_agb ;return _feb ,nil ;
};func _fgcgd (_ggbc *Classer ,_bad *_d .Bitmap )*similarTemplatesFinder {return &similarTemplatesFinder {Width :_bad .Width ,Height :_bad .Height ,Classer :_ggbc };};type Settings struct{MaxCompWidth int ;MaxCompHeight int ;SizeHaus int ;RankHaus float64 ;
Thresh float64 ;WeightFactor float64 ;KeepClassInstances bool ;Components _d .Component ;Method Method ;};func (_cgb *Classer )classifyRankHouseOne (_bcgc *_d .Boxes ,_fgd ,_gfa ,_bd *_d .Bitmaps ,_ccc *_d .Points ,_dgb int )(_fgc error ){const _ebbe ="\u0043\u006c\u0061\u0073s\u0065\u0072\u002e\u0063\u006c\u0061\u0073\u0073\u0069\u0066y\u0052a\u006e\u006b\u0048\u006f\u0075\u0073\u0065O\u006e\u0065";
var (_agd ,_gea ,_gdf ,_eec float32 ;_gfb int ;_cff ,_bccc ,_dge ,_faa ,_fdbg *_d .Bitmap ;_egf ,_caga bool ;);for _fgf :=0;_fgf < len (_fgd .Values );_fgf ++{_bccc =_gfa .Values [_fgf ];_dge =_bd .Values [_fgf ];_agd ,_gea ,_fgc =_ccc .GetGeometry (_fgf );
if _fgc !=nil {return _f .Wrapf (_fgc ,_ebbe ,"\u0066\u0069\u0072\u0073\u0074\u0020\u0067\u0065\u006fm\u0065\u0074\u0072\u0079");};_gbd :=len (_cgb .UndilatedTemplates .Values );_egf =false ;_gfgb :=_fgcgd (_cgb ,_bccc );for _gfb =_gfgb .Next ();_gfb > -1;
{_faa ,_fgc =_cgb .UndilatedTemplates .GetBitmap (_gfb );if _fgc !=nil {return _f .Wrap (_fgc ,_ebbe ,"\u0062\u006d\u0033");};_fdbg ,_fgc =_cgb .DilatedTemplates .GetBitmap (_gfb );if _fgc !=nil {return _f .Wrap (_fgc ,_ebbe ,"\u0062\u006d\u0034");};_gdf ,_eec ,_fgc =_cgb .CentroidPointsTemplates .GetGeometry (_gfb );
if _fgc !=nil {return _f .Wrap (_fgc ,_ebbe ,"\u0043\u0065\u006e\u0074\u0072\u006f\u0069\u0064\u0054\u0065\u006d\u0070l\u0061\u0074\u0065\u0073");};_caga ,_fgc =_d .HausTest (_bccc ,_dge ,_faa ,_fdbg ,_agd -_gdf ,_gea -_eec ,MaxDiffWidth ,MaxDiffHeight );
if _fgc !=nil {return _f .Wrap (_fgc ,_ebbe ,"");};if _caga {_egf =true ;if _fgc =_cgb .ClassIDs .Add (_gfb );_fgc !=nil {return _f .Wrap (_fgc ,_ebbe ,"");};if _fgc =_cgb .ComponentPageNumbers .Add (_dgb );_fgc !=nil {return _f .Wrap (_fgc ,_ebbe ,"");
};if _cgb .Settings .KeepClassInstances {_dcbb ,_cee :=_cgb .ClassInstances .GetBitmaps (_gfb );if _cee !=nil {return _f .Wrap (_cee ,_ebbe ,"\u004be\u0065\u0070\u0050\u0069\u0078\u0061a");};_cff ,_cee =_fgd .GetBitmap (_fgf );if _cee !=nil {return _f .Wrap (_cee ,_ebbe ,"\u004be\u0065\u0070\u0050\u0069\u0078\u0061a");
};_dcbb .AddBitmap (_cff );_ada ,_cee :=_bcgc .Get (_fgf );if _cee !=nil {return _f .Wrap (_cee ,_ebbe ,"\u004be\u0065\u0070\u0050\u0069\u0078\u0061a");};_dcbb .AddBox (_ada );};break ;};};if !_egf {if _fgc =_cgb .ClassIDs .Add (_gbd );_fgc !=nil {return _f .Wrap (_fgc ,_ebbe ,"");
};if _fgc =_cgb .ComponentPageNumbers .Add (_dgb );_fgc !=nil {return _f .Wrap (_fgc ,_ebbe ,"");};_gag :=&_d .Bitmaps {};_cff ,_fgc =_fgd .GetBitmap (_fgf );if _fgc !=nil {return _f .Wrap (_fgc ,_ebbe ,"\u0021\u0066\u006f\u0075\u006e\u0064");};_gag .Values =append (_gag .Values ,_cff );
_gba ,_aeac :=_cff .Width ,_cff .Height ;_cgb .TemplatesSize .Add (uint64 (_aeac )*uint64 (_gba ),_gbd );_fgcg ,_bcb :=_bcgc .Get (_fgf );if _bcb !=nil {return _f .Wrap (_bcb ,_ebbe ,"\u0021\u0066\u006f\u0075\u006e\u0064");};_gag .AddBox (_fgcg );_cgb .ClassInstances .AddBitmaps (_gag );
_cgb .CentroidPointsTemplates .AddPoint (_agd ,_gea );_cgb .UndilatedTemplates .AddBitmap (_bccc );_cgb .DilatedTemplates .AddBitmap (_dge );};};return nil ;};const (MaxConnCompWidth =350;MaxCharCompWidth =350;MaxWordCompWidth =1000;MaxCompHeight =120;
);func (_dd *Classer )ComputeLLCorners ()(_cc error ){const _fg ="\u0043l\u0061\u0073\u0073\u0065\u0072\u002e\u0043\u006f\u006d\u0070\u0075t\u0065\u004c\u004c\u0043\u006f\u0072\u006e\u0065\u0072\u0073";if _dd .PtaUL ==nil {return _f .Error (_fg ,"\u0055\u004c\u0020\u0043or\u006e\u0065\u0072\u0073\u0020\u006e\u006f\u0074\u0020\u0064\u0065\u0066\u0069\u006ee\u0064");
};_ede :=len (*_dd .PtaUL );_dd .PtaLL =&_d .Points {};var (_bg ,_ea float32 ;_db ,_fe int ;_af *_d .Bitmap ;);for _ag :=0;_ag < _ede ;_ag ++{_bg ,_ea ,_cc =_dd .PtaUL .GetGeometry (_ag );if _cc !=nil {_ec .Log .Debug ("\u0047e\u0074\u0074\u0069\u006e\u0067\u0020\u0050\u0074\u0061\u0055\u004c \u0066\u0061\u0069\u006c\u0065\u0064\u003a\u0020\u0025\u0076",_cc );
return _f .Wrap (_cc ,_fg ,"\u0050\u0074\u0061\u0055\u004c\u0020\u0047\u0065\u006fm\u0065\u0074\u0072\u0079");};_db ,_cc =_dd .ClassIDs .Get (_ag );if _cc !=nil {_ec .Log .Debug ("\u0047\u0065\u0074\u0074\u0069\u006e\u0067\u0020\u0043\u006c\u0061s\u0073\u0049\u0044\u0020\u0066\u0061\u0069\u006c\u0065\u0064:\u0020\u0025\u0076",_cc );
return _f .Wrap (_cc ,_fg ,"\u0043l\u0061\u0073\u0073\u0049\u0044");};_af ,_cc =_dd .UndilatedTemplates .GetBitmap (_db );if _cc !=nil {_ec .Log .Debug ("\u0047\u0065t\u0074\u0069\u006e\u0067 \u0055\u006ed\u0069\u006c\u0061\u0074\u0065\u0064\u0054\u0065m\u0070\u006c\u0061\u0074\u0065\u0073\u0020\u0066\u0061\u0069\u006c\u0065d\u003a\u0020\u0025\u0076",_cc );
return _f .Wrap (_cc ,_fg ,"\u0055\u006e\u0064\u0069la\u0074\u0065\u0064\u0020\u0054\u0065\u006d\u0070\u006c\u0061\u0074\u0065\u0073");};_fe =_af .Height ;_dd .PtaLL .AddPoint (_bg ,_ea +float32 (_fe ));};return nil ;};type similarTemplatesFinder struct{Classer *Classer ;
Width int ;Height int ;Index int ;CurrentNumbers []int ;N int ;};const (MaxDiffWidth =2;MaxDiffHeight =2;);func (_bc *Classer )AddPage (inputPage *_d .Bitmap ,pageNumber int ,method Method )(_ecg error ){const _eb ="\u0043l\u0061s\u0073\u0065\u0072\u002e\u0041\u0064\u0064\u0050\u0061\u0067\u0065";
_bc .Widths [pageNumber ]=inputPage .Width ;_bc .Heights [pageNumber ]=inputPage .Height ;if _ecg =_bc .verifyMethod (method );_ecg !=nil {return _f .Wrap (_ecg ,_eb ,"");};_a ,_ed ,_ecg :=inputPage .GetComponents (_bc .Settings .Components ,_bc .Settings .MaxCompWidth ,_bc .Settings .MaxCompHeight );
if _ecg !=nil {return _f .Wrap (_ecg ,_eb ,"");};_ec .Log .Debug ("\u0043\u006f\u006d\u0070\u006f\u006e\u0065\u006e\u0074s\u003a\u0020\u0025\u0076",_a );if _ecg =_bc .addPageComponents (inputPage ,_ed ,_a ,pageNumber ,method );_ecg !=nil {return _f .Wrap (_ecg ,_eb ,"");
};return nil ;};func (_dgd *Classer )classifyRankHaus (_cfa *_d .Boxes ,_ef *_d .Bitmaps ,_fdb int )error {const _fag ="\u0063\u006ca\u0073\u0073\u0069f\u0079\u0052\u0061\u006e\u006b\u0048\u0061\u0075\u0073";if _cfa ==nil {return _f .Error (_fag ,"\u0062\u006fx\u0061\u0020\u006eo\u0074\u0020\u0064\u0065\u0066\u0069\u006e\u0065\u0064");
};if _ef ==nil {return _f .Error (_fag ,"\u0070\u0069x\u0061\u0020\u006eo\u0074\u0020\u0064\u0065\u0066\u0069\u006e\u0065\u0064");};_dggb :=len (_ef .Values );if _dggb ==0{return _f .Error (_fag ,"e\u006dp\u0074\u0079\u0020\u006e\u0065\u0077\u0020\u0063o\u006d\u0070\u006f\u006een\u0074\u0073");
};_feg :=_ef .CountPixels ();_bec :=_dgd .Settings .SizeHaus ;_aaf :=_d .SelCreateBrick (_bec ,_bec ,_bec /2,_bec /2,_d .SelHit );_bab :=&_d .Bitmaps {Values :make ([]*_d .Bitmap ,_dggb )};_ffd :=&_d .Bitmaps {Values :make ([]*_d .Bitmap ,_dggb )};var (_efd ,_cab ,_aad *_d .Bitmap ;
_ggb error ;);for _dgdd :=0;_dgdd < _dggb ;_dgdd ++{_efd ,_ggb =_ef .GetBitmap (_dgdd );if _ggb !=nil {return _f .Wrap (_ggb ,_fag ,"");};_cab ,_ggb =_efd .AddBorderGeneral (JbAddedPixels ,JbAddedPixels ,JbAddedPixels ,JbAddedPixels ,0);if _ggb !=nil {return _f .Wrap (_ggb ,_fag ,"");
};_aad ,_ggb =_d .Dilate (nil ,_cab ,_aaf );if _ggb !=nil {return _f .Wrap (_ggb ,_fag ,"");};_bab .Values [_dggb ]=_cab ;_ffd .Values [_dggb ]=_aad ;};_cag ,_ggb :=_d .Centroids (_bab .Values );if _ggb !=nil {return _f .Wrap (_ggb ,_fag ,"");};if _ggb =_cag .Add (_dgd .CentroidPoints );
_ggb !=nil {_ec .Log .Trace ("\u004e\u006f\u0020\u0063en\u0074\u0072\u006f\u0069\u0064\u0073\u0020\u0074\u006f\u0020\u0061\u0064\u0064");};if _dgd .Settings .RankHaus ==1.0{_ggb =_dgd .classifyRankHouseOne (_cfa ,_ef ,_bab ,_ffd ,_cag ,_fdb );}else {_ggb =_dgd .classifyRankHouseNonOne (_cfa ,_ef ,_bab ,_ffd ,_cag ,_feg ,_fdb );
};if _ggb !=nil {return _f .Wrap (_ggb ,_fag ,"");};return nil ;};var _ff bool ;func (_ba *Classer )getULCorners (_bb *_d .Bitmap ,_dc *_d .Boxes )error {const _aa ="\u0067\u0065\u0074U\u004c\u0043\u006f\u0072\u006e\u0065\u0072\u0073";if _bb ==nil {return _f .Error (_aa ,"\u006e\u0069l\u0020\u0069\u006da\u0067\u0065\u0020\u0062\u0069\u0074\u006d\u0061\u0070");
};if _dc ==nil {return _f .Error (_aa ,"\u006e\u0069\u006c\u0020\u0062\u006f\u0075\u006e\u0064\u0073");};if _ba .PtaUL ==nil {_ba .PtaUL =&_d .Points {};};_fd :=len (*_dc );var (_bgc ,_fa ,_dg ,_dbg int ;_cd ,_fbe ,_dbd ,_fac float32 ;_cca error ;_bag *_e .Rectangle ;
_edc *_d .Bitmap ;_ccb _e .Point ;);for _gg :=0;_gg < _fd ;_gg ++{_bgc =_ba .BaseIndex +_gg ;if _cd ,_fbe ,_cca =_ba .CentroidPoints .GetGeometry (_bgc );_cca !=nil {return _f .Wrap (_cca ,_aa ,"\u0043\u0065\u006e\u0074\u0072\u006f\u0069\u0064\u0050o\u0069\u006e\u0074\u0073");
};if _fa ,_cca =_ba .ClassIDs .Get (_bgc );_cca !=nil {return _f .Wrap (_cca ,_aa ,"\u0043\u006c\u0061s\u0073\u0049\u0044\u0073\u002e\u0047\u0065\u0074");};if _dbd ,_fac ,_cca =_ba .CentroidPointsTemplates .GetGeometry (_fa );_cca !=nil {return _f .Wrap (_cca ,_aa ,"\u0043\u0065\u006etr\u006f\u0069\u0064\u0050\u006f\u0069\u006e\u0074\u0073\u0054\u0065\u006d\u0070\u006c\u0061\u0074\u0065\u0073");
};_cg :=_dbd -_cd ;_gb :=_fac -_fbe ;if _cg >=0{_dg =int (_cg +0.5);}else {_dg =int (_cg -0.5);};if _gb >=0{_dbg =int (_gb +0.5);}else {_dbg =int (_gb -0.5);};if _bag ,_cca =_dc .Get (_gg );_cca !=nil {return _f .Wrap (_cca ,_aa ,"");};_bcg ,_dcb :=_bag .Min .X ,_bag .Min .Y ;
_edc ,_cca =_ba .UndilatedTemplates .GetBitmap (_fa );if _cca !=nil {return _f .Wrap (_cca ,_aa ,"\u0055\u006e\u0064\u0069\u006c\u0061\u0074\u0065\u0064\u0054e\u006d\u0070\u006c\u0061\u0074\u0065\u0073.\u0047\u0065\u0074\u0028\u0069\u0043\u006c\u0061\u0073\u0073\u0029");
};_ccb ,_cca =_ad (_bb ,_bcg ,_dcb ,_dg ,_dbg ,_edc );if _cca !=nil {return _f .Wrap (_cca ,_aa ,"");};_ba .PtaUL .AddPoint (float32 (_bcg -_dg +_ccb .X ),float32 (_dcb -_dbg +_ccb .Y ));};return nil ;};func (_gae *Classer )classifyRankHouseNonOne (_ddc *_d .Boxes ,_faaa ,_geab ,_ggdc *_d .Bitmaps ,_caf *_d .Points ,_fcfb *_c .NumSlice ,_egb int )(_agbd error ){const _bbb ="\u0043\u006c\u0061\u0073s\u0065\u0072\u002e\u0063\u006c\u0061\u0073\u0073\u0069\u0066y\u0052a\u006e\u006b\u0048\u006f\u0075\u0073\u0065O\u006e\u0065";
var (_faca ,_agca ,_dgeg ,_eecd float32 ;_bfeg ,_gabe ,_cfe int ;_aba ,_aga ,_fce ,_aege ,_abe *_d .Bitmap ;_bge ,_cafb bool ;);_fcc :=_d .MakePixelSumTab8 ();for _agba :=0;_agba < len (_faaa .Values );_agba ++{if _aga ,_agbd =_geab .GetBitmap (_agba );
_agbd !=nil {return _f .Wrap (_agbd ,_bbb ,"b\u006d\u0073\u0031\u002e\u0047\u0065\u0074\u0028\u0069\u0029");};if _bfeg ,_agbd =_fcfb .GetInt (_agba );_agbd !=nil {_ec .Log .Trace ("\u0047\u0065t\u0074\u0069\u006e\u0067 \u0046\u0047T\u0065\u006d\u0070\u006c\u0061\u0074\u0065\u0073 \u0061\u0074\u003a\u0020\u0025\u0064\u0020\u0066\u0061\u0069\u006c\u0065d\u003a\u0020\u0025\u0076",_agba ,_agbd );
};if _fce ,_agbd =_ggdc .GetBitmap (_agba );_agbd !=nil {return _f .Wrap (_agbd ,_bbb ,"b\u006d\u0073\u0032\u002e\u0047\u0065\u0074\u0028\u0069\u0029");};if _faca ,_agca ,_agbd =_caf .GetGeometry (_agba );_agbd !=nil {return _f .Wrapf (_agbd ,_bbb ,"\u0070t\u0061[\u0069\u005d\u002e\u0047\u0065\u006f\u006d\u0065\u0074\u0072\u0079");
};_dbb :=len (_gae .UndilatedTemplates .Values );_bge =false ;_adga :=_fgcgd (_gae ,_aga );for _cfe =_adga .Next ();_cfe > -1;{if _aege ,_agbd =_gae .UndilatedTemplates .GetBitmap (_cfe );_agbd !=nil {return _f .Wrap (_agbd ,_bbb ,"\u0070\u0069\u0078\u0061\u0074\u002e\u005b\u0069\u0043l\u0061\u0073\u0073\u005d");
};if _gabe ,_agbd =_gae .FgTemplates .GetInt (_cfe );_agbd !=nil {_ec .Log .Trace ("\u0047\u0065\u0074\u0074\u0069\u006eg\u0020\u0046\u0047\u0054\u0065\u006d\u0070\u006c\u0061\u0074\u0065\u005b\u0025d\u005d\u0020\u0066\u0061\u0069\u006c\u0065d\u003a\u0020\u0025\u0076",_cfe ,_agbd );
};if _abe ,_agbd =_gae .DilatedTemplates .GetBitmap (_cfe );_agbd !=nil {return _f .Wrap (_agbd ,_bbb ,"\u0070\u0069\u0078\u0061\u0074\u0064\u005b\u0069\u0043l\u0061\u0073\u0073\u005d");};if _dgeg ,_eecd ,_agbd =_gae .CentroidPointsTemplates .GetGeometry (_cfe );
_agbd !=nil {return _f .Wrap (_agbd ,_bbb ,"\u0043\u0065\u006et\u0072\u006f\u0069\u0064P\u006f\u0069\u006e\u0074\u0073\u0054\u0065m\u0070\u006c\u0061\u0074\u0065\u0073\u005b\u0069\u0043\u006c\u0061\u0073\u0073\u005d");};_cafb ,_agbd =_d .RankHausTest (_aga ,_fce ,_aege ,_abe ,_faca -_dgeg ,_agca -_eecd ,MaxDiffWidth ,MaxDiffHeight ,_bfeg ,_gabe ,float32 (_gae .Settings .RankHaus ),_fcc );
if _agbd !=nil {return _f .Wrap (_agbd ,_bbb ,"");};if _cafb {_bge =true ;if _agbd =_gae .ClassIDs .Add (_cfe );_agbd !=nil {return _f .Wrap (_agbd ,_bbb ,"");};if _agbd =_gae .ComponentPageNumbers .Add (_egb );_agbd !=nil {return _f .Wrap (_agbd ,_bbb ,"");
};if _gae .Settings .KeepClassInstances {_bde ,_dca :=_gae .ClassInstances .GetBitmaps (_cfe );if _dca !=nil {return _f .Wrap (_dca ,_bbb ,"\u0063\u002e\u0050\u0069\u0078\u0061\u0061\u002e\u0047\u0065\u0074B\u0069\u0074\u006d\u0061\u0070\u0073\u0028\u0069\u0043\u006ca\u0073\u0073\u0029");
};if _aba ,_dca =_faaa .GetBitmap (_agba );_dca !=nil {return _f .Wrap (_dca ,_bbb ,"\u0070i\u0078\u0061\u005b\u0069\u005d");};_bde .Values =append (_bde .Values ,_aba );_egc ,_dca :=_ddc .Get (_agba );if _dca !=nil {return _f .Wrap (_dca ,_bbb ,"b\u006f\u0078\u0061\u002e\u0047\u0065\u0074\u0028\u0069\u0029");
};_bde .Boxes =append (_bde .Boxes ,_egc );};break ;};};if !_bge {if _agbd =_gae .ClassIDs .Add (_dbb );_agbd !=nil {return _f .Wrap (_agbd ,_bbb ,"\u0021\u0066\u006f\u0075\u006e\u0064");};if _agbd =_gae .ComponentPageNumbers .Add (_egb );_agbd !=nil {return _f .Wrap (_agbd ,_bbb ,"\u0021\u0066\u006f\u0075\u006e\u0064");
};_eba :=&_d .Bitmaps {};_aba =_faaa .Values [_agba ];_eba .AddBitmap (_aba );_bdec ,_afe :=_aba .Width ,_aba .Height ;_gae .TemplatesSize .Add (uint64 (_bdec )*uint64 (_afe ),_dbb );_ccfb ,_fbed :=_ddc .Get (_agba );if _fbed !=nil {return _f .Wrap (_fbed ,_bbb ,"\u0021\u0066\u006f\u0075\u006e\u0064");
};_eba .AddBox (_ccfb );_gae .ClassInstances .AddBitmaps (_eba );_gae .CentroidPointsTemplates .AddPoint (_faca ,_agca );_gae .UndilatedTemplates .AddBitmap (_aga );_gae .DilatedTemplates .AddBitmap (_fce );_gae .FgTemplates .AddInt (_bfeg );};};_gae .NumberOfClasses =len (_gae .UndilatedTemplates .Values );
return nil ;};