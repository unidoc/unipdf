//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package testutils ;import (_bg "crypto/md5";_d "encoding/hex";_eac "errors";_bgd "fmt";_c "github.com/unidoc/unipdf/v4/common";_dd "github.com/unidoc/unipdf/v4/core";_eb "image";_ea "image/png";_e "io";_ae "os";_be "os/exec";_a "path/filepath";_fg "strings";
_f "testing";);func RenderPDFToPNGs (pdfPath string ,dpi int ,outpathTpl string )error {if dpi <=0{dpi =100;};if _ ,_ba :=_be .LookPath ("\u0067\u0073");_ba !=nil {return ErrRenderNotSupported ;};return _be .Command ("\u0067\u0073","\u002d\u0073\u0044\u0045\u0056\u0049\u0043\u0045\u003d\u0070\u006e\u0067a\u006c\u0070\u0068\u0061","\u002d\u006f",outpathTpl ,_bgd .Sprintf ("\u002d\u0072\u0025\u0064",dpi ),pdfPath ).Run ();
};func CompareDictionariesDeep (d1 ,d2 *_dd .PdfObjectDictionary )bool {if len (d1 .Keys ())!=len (d2 .Keys ()){_c .Log .Debug ("\u0044\u0069\u0063\u0074\u0020\u0065\u006e\u0074\u0072\u0069\u0065\u0073\u0020\u006d\u0069s\u006da\u0074\u0063\u0068\u0020\u0028\u0025\u0064\u0020\u0021\u003d\u0020\u0025\u0064\u0029",len (d1 .Keys ()),len (d2 .Keys ()));
_c .Log .Debug ("\u0057\u0061s\u0020\u0027\u0025s\u0027\u0020\u0076\u0073\u0020\u0027\u0025\u0073\u0027",d1 .Write (),d2 .Write ());return false ;};for _ ,_dfa :=range d1 .Keys (){if _dfa =="\u0050\u0061\u0072\u0065\u006e\u0074"{continue ;};_dc :=_dd .TraceToDirectObject (d1 .Get (_dfa ));
_cae :=_dd .TraceToDirectObject (d2 .Get (_dfa ));if _dc ==nil {_c .Log .Debug ("\u00761\u0020\u0069\u0073\u0020\u006e\u0069l");return false ;};if _cae ==nil {_c .Log .Debug ("\u00762\u0020\u0069\u0073\u0020\u006e\u0069l");return false ;};switch _ebb :=_dc .(type ){case *_dd .PdfObjectDictionary :_gb ,_bac :=_cae .(*_dd .PdfObjectDictionary );
if !_bac {_c .Log .Debug ("\u0054\u0079\u0070\u0065 m\u0069\u0073\u006d\u0061\u0074\u0063\u0068\u0020\u0025\u0054\u0020\u0076\u0073\u0020%\u0054",_dc ,_cae );return false ;};if !CompareDictionariesDeep (_ebb ,_gb ){return false ;};continue ;case *_dd .PdfObjectArray :_fga ,_ag :=_cae .(*_dd .PdfObjectArray );
if !_ag {_c .Log .Debug ("\u00762\u0020n\u006f\u0074\u0020\u0061\u006e\u0020\u0061\u0072\u0072\u0061\u0079");return false ;};if _ebb .Len ()!=_fga .Len (){_c .Log .Debug ("\u0061\u0072\u0072\u0061\u0079\u0020\u006c\u0065\u006e\u0067\u0074\u0068\u0020\u006d\u0069s\u006da\u0074\u0063\u0068\u0020\u0028\u0025\u0064\u0020\u0021\u003d\u0020\u0025\u0064\u0029",_ebb .Len (),_fga .Len ());
return false ;};for _bae :=0;_bae < _ebb .Len ();_bae ++{_cdd :=_dd .TraceToDirectObject (_ebb .Get (_bae ));_gbf :=_dd .TraceToDirectObject (_fga .Get (_bae ));if _gcb ,_edca :=_cdd .(*_dd .PdfObjectDictionary );_edca {_gee ,_ced :=_gbf .(*_dd .PdfObjectDictionary );
if !_ced {return false ;};if !CompareDictionariesDeep (_gcb ,_gee ){return false ;};}else {_dda :=_cdd .Write ();_fde :=_gbf .Write ();if string (_dda )!=string (_fde ){_c .Log .Debug ("M\u0069\u0073\u006d\u0061tc\u0068 \u0027\u0025\u0073\u0027\u0020!\u003d\u0020\u0027\u0025\u0073\u0027",_dda ,_fde );
return false ;};};};continue ;};if _dc .String ()!=_cae .String (){_c .Log .Debug ("\u006b\u0065y\u003d\u0025\u0073\u0020\u004d\u0069\u0073\u006d\u0061\u0074\u0063\u0068\u0021\u0020\u0027\u0025\u0073\u0027\u0020\u0021\u003d\u0020'%\u0073\u0027",_dfa ,_dc .String (),_cae .String ());
_c .Log .Debug ("\u0046o\u0072 \u0027\u0025\u0054\u0027\u0020\u002d\u0020\u0027\u0025\u0054\u0027",_dc ,_cae );_c .Log .Debug ("\u0046\u006f\u0072\u0020\u0027\u0025\u002b\u0076\u0027\u0020\u002d\u0020'\u0025\u002b\u0076\u0027",_dc ,_cae );return false ;
};};return true ;};func CopyFile (src ,dst string )error {_g ,_ddd :=_ae .Open (src );if _ddd !=nil {return _ddd ;};defer _g .Close ();_da ,_ddd :=_ae .Create (dst );if _ddd !=nil {return _ddd ;};defer _da .Close ();_ ,_ddd =_e .Copy (_da ,_g );return _ddd ;
};func ParseIndirectObjects (rawpdf string )(map[int64 ]_dd .PdfObject ,error ){_gfd :=_dd .NewParserFromString (rawpdf );_cea :=map[int64 ]_dd .PdfObject {};for {_bd ,_daf :=_gfd .ParseIndirectObject ();if _daf !=nil {if _daf ==_e .EOF {break ;};return nil ,_daf ;
};switch _eec :=_bd .(type ){case *_dd .PdfIndirectObject :_cea [_eec .ObjectNumber ]=_bd ;case *_dd .PdfObjectStream :_cea [_eec .ObjectNumber ]=_bd ;};};for _ ,_beb :=range _cea {_ge (_beb ,_cea );};return _cea ,nil ;};func _ge (_cead _dd .PdfObject ,_bc map[int64 ]_dd .PdfObject )error {switch _eag :=_cead .(type ){case *_dd .PdfIndirectObject :_fef :=_eag ;
_ge (_fef .PdfObject ,_bc );case *_dd .PdfObjectDictionary :_ccd :=_eag ;for _ ,_edg :=range _ccd .Keys (){_db :=_ccd .Get (_edg );if _dac ,_gc :=_db .(*_dd .PdfObjectReference );_gc {_ecf ,_ecd :=_bc [_dac .ObjectNumber ];if !_ecd {return _eac .New ("r\u0065\u0066\u0065\u0072\u0065\u006ec\u0065\u0020\u0074\u006f\u0020\u006f\u0075\u0074\u0073i\u0064\u0065\u0020o\u0062j\u0065\u0063\u0074");
};_ccd .Set (_edg ,_ecf );}else {_ge (_db ,_bc );};};case *_dd .PdfObjectArray :_dgd :=_eag ;for _cb ,_ede :=range _dgd .Elements (){if _cbf ,_bgg :=_ede .(*_dd .PdfObjectReference );_bgg {_fd ,_dfg :=_bc [_cbf .ObjectNumber ];if !_dfg {return _eac .New ("r\u0065\u0066\u0065\u0072\u0065\u006ec\u0065\u0020\u0074\u006f\u0020\u006f\u0075\u0074\u0073i\u0064\u0065\u0020o\u0062j\u0065\u0063\u0074");
};_dgd .Set (_cb ,_fd );}else {_ge (_ede ,_bc );};};};return nil ;};func CompareImages (img1 ,img2 _eb .Image )(bool ,error ){_fb :=img1 .Bounds ();_afg :=0;for _cf :=0;_cf < _fb .Size ().X ;_cf ++{for _fa :=0;_fa < _fb .Size ().Y ;_fa ++{_dg ,_dga ,_ed ,_ :=img1 .At (_cf ,_fa ).RGBA ();
_cc ,_dad ,_ab ,_ :=img2 .At (_cf ,_fa ).RGBA ();if _dg !=_cc ||_dga !=_dad ||_ed !=_ab {_afg ++;};};};_ebd :=float64 (_afg )/float64 (_fb .Dx ()*_fb .Dy ());if _ebd > 0.0001{_bgd .Printf ("\u0064\u0069\u0066f \u0066\u0072\u0061\u0063\u0074\u0069\u006f\u006e\u003a\u0020\u0025\u0076\u0020\u0028\u0025\u0064\u0029\u000a",_ebd ,_afg );
return false ,nil ;};return true ,nil ;};func ComparePNGFiles (file1 ,file2 string )(bool ,error ){_edc ,_eg :=HashFile (file1 );if _eg !=nil {return false ,_eg ;};_ffc ,_eg :=HashFile (file2 );if _eg !=nil {return false ,_eg ;};if _edc ==_ffc {return true ,nil ;
};_dae ,_eg :=ReadPNG (file1 );if _eg !=nil {return false ,_eg ;};_cd ,_eg :=ReadPNG (file2 );if _eg !=nil {return false ,_eg ;};if _dae .Bounds ()!=_cd .Bounds (){return false ,nil ;};return CompareImages (_dae ,_cd );};var (ErrRenderNotSupported =_eac .New ("\u0072\u0065\u006e\u0064\u0065r\u0069\u006e\u0067\u0020\u0050\u0044\u0046\u0020\u0066\u0069\u006c\u0065\u0073 \u0069\u0073\u0020\u006e\u006f\u0074\u0020\u0073\u0075\u0070\u0070\u006f\u0072\u0074\u0065\u0064\u0020\u006f\u006e\u0020\u0074\u0068\u0069\u0073\u0020\u0073\u0079\u0073\u0074\u0065m");
);func HashFile (file string )(string ,error ){_ef ,_fe :=_ae .Open (file );if _fe !=nil {return "",_fe ;};defer _ef .Close ();_efb :=_bg .New ();if _ ,_fe =_e .Copy (_efb ,_ef );_fe !=nil {return "",_fe ;};return _d .EncodeToString (_efb .Sum (nil )),nil ;
};func RunRenderTest (t *_f .T ,pdfPath ,outputDir ,baselineRenderPath string ,saveBaseline bool ){_ee :=_fg .TrimSuffix (_a .Base (pdfPath ),_a .Ext (pdfPath ));t .Run ("\u0072\u0065\u006e\u0064\u0065\u0072",func (_bb *_f .T ){_ec :=_a .Join (outputDir ,_ee );
_fea :=_ec +"\u002d%\u0064\u002e\u0070\u006e\u0067";if _ceb :=RenderPDFToPNGs (pdfPath ,0,_fea );_ceb !=nil {_bb .Skip (_ceb );};for _ca :=1;true ;_ca ++{_abf :=_bgd .Sprintf ("\u0025s\u002d\u0025\u0064\u002e\u0070\u006eg",_ec ,_ca );_dde :=_a .Join (baselineRenderPath ,_bgd .Sprintf ("\u0025\u0073\u002d\u0025\u0064\u005f\u0065\u0078\u0070\u002e\u0070\u006e\u0067",_ee ,_ca ));
if _ ,_fgg :=_ae .Stat (_abf );_fgg !=nil {break ;};_bb .Logf ("\u0025\u0073",_dde );if saveBaseline {_bb .Logf ("\u0043\u006fp\u0079\u0069\u006eg\u0020\u0025\u0073\u0020\u002d\u003e\u0020\u0025\u0073",_abf ,_dde );_gg :=CopyFile (_abf ,_dde );if _gg !=nil {_bb .Fatalf ("\u0045\u0052\u0052OR\u0020\u0063\u006f\u0070\u0079\u0069\u006e\u0067\u0020\u0074\u006f\u0020\u0025\u0073\u003a\u0020\u0025\u0076",_dde ,_gg );
};continue ;};_bb .Run (_bgd .Sprintf ("\u0070\u0061\u0067\u0065\u0025\u0064",_ca ),func (_egd *_f .T ){_egd .Logf ("\u0043o\u006dp\u0061\u0072\u0069\u006e\u0067 \u0025\u0073 \u0076\u0073\u0020\u0025\u0073",_abf ,_dde );_edb ,_bbc :=ComparePNGFiles (_abf ,_dde );
if _ae .IsNotExist (_bbc ){_egd .Fatal ("\u0069m\u0061g\u0065\u0020\u0066\u0069\u006ce\u0020\u006di\u0073\u0073\u0069\u006e\u0067");}else if !_edb {_egd .Fatal ("\u0077\u0072\u006f\u006eg \u0070\u0061\u0067\u0065\u0020\u0072\u0065\u006e\u0064\u0065\u0072\u0065\u0064");
};});};});};func ReadPNG (file string )(_eb .Image ,error ){_af ,_ff :=_ae .Open (file );if _ff !=nil {return nil ,_ff ;};defer _af .Close ();return _ea .Decode (_af );};