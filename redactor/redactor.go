//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package redactor ;import (_e "errors";_a "fmt";_g "github.com/unidoc/unipdf/v4/common";_ef "github.com/unidoc/unipdf/v4/contentstream";_ge "github.com/unidoc/unipdf/v4/core";_db "github.com/unidoc/unipdf/v4/creator";_ad "github.com/unidoc/unipdf/v4/extractor";
_bd "github.com/unidoc/unipdf/v4/model";_aa "io";_af "regexp";_bc "slices";_f "sort";_d "strings";);func _becc (_eaef ,_cbc targetMap )(bool ,[]int ){_dgcf :=_d .Contains (_eaef ._dfac ,_cbc ._dfac );var _fcc []int ;for _ ,_cge :=range _eaef ._ecbb {for _cfgg ,_aafg :=range _cbc ._ecbb {if _aafg [0]>=_cge [0]&&_aafg [1]<=_cge [1]{_fcc =append (_fcc ,_cfgg );
};};};return _dgcf ,_fcc ;};type replacement struct{_gee string ;_ea float64 ;_ae int ;};func _eed (_fbf []*matchedIndex )[]*targetMap {_beddf :=make (map[string ][][]int );_aed :=[]*targetMap {};for _ ,_dbac :=range _fbf {_edg :=_dbac ._bbdf ;_fff :=[]int {_dbac ._bbea ,_dbac ._dede };
if _cabg ,_aac :=_beddf [_edg ];_aac {_beddf [_edg ]=append (_cabg ,_fff );}else {_beddf [_edg ]=[][]int {_fff };};};for _ccf ,_dda :=range _beddf {_cfb :=&targetMap {_dfac :_ccf ,_ecbb :_dda };_aed =append (_aed ,_cfb );};return _aed ;};func _cad (_fg *_ad .TextMarkArray )int {_gg :=0;
_afg :=_fg .Elements ();if _afg [0].Text =="\u0020"{_gg ++;};if _afg [_fg .Len ()-1].Text =="\u0020"{_gg ++;};return _gg ;};

// RectangleProps defines properties of the redaction rectangle to be drawn.
type RectangleProps struct{FillColor _db .Color ;BorderWidth float64 ;FillOpacity float64 ;};const (RegexSSN ="\u0028?\u0069\u0029\u005c\u0062\\\u0064\u007b\u0033\u007d\u002d\\\u0064{\u0032}\u002d\u005c\u0064\u007b\u0034\u007d\u005cb";RegexCreditCard ="\u005c\u0062\u0028?:\u005c\u0064\u005b\u0020\u002d\u005d\u002a\u003f\u0029\u007b\u0031\u0033\u002c\u0031\u0036\u007d\u005c\u0062";
RegexEmail ="\u005c\u0062\u005b\u0041\u002d\u005a\u0061\u002d\u007a\u0030\u002d\u0039\u002e\u005f\u0025\u002b\u002d\u005d+\u0040\u005b\u0041\u002d\u005a\u0061\u002dz\u0030\u002d\u0039\u002e\u002d\u005d\u002b\u005c\u002e\u005b\u0041-\u005a\u0061\u002d\u007a\u005d\u007b\u0032\u002c\u007d\u005c\u0062";
RegexPhone ="\u0028\u003f\u003a\u005c\u002b\u0031\u005b\u002d\u002e\u005c\u0073\u005d\u003f\u0029\u003f\u005c\u0028\u003f\\\u0064\u007b\u0033\u007d\u005c\u0029\u003f[\u002d\u002e\u005c\u0073\u005d\u003f\u005c\u0064\u007b\u0033\u007d[\u002d\u002e\u005c\u0073\u005d\u003f\u005c\u0064\u007b\u0034\u007d";
RegexIPv4 ="\u005c\u0062\u0028\u003f\u003a\u0028\u003f\u003a\u0032\u0035\u005b\u0030\u002d5\u005d\u007c\u0032\u005b\u0030\u002d\u0034\u005d\u005cd\u007c\u0031\u005c\u0064\u007b\u0032\u007d\u007c\u005b\u0031\u002d\u0039\u005d\u003f\\\u0064\u0029\u005c\u002e\u0029\u007b\u0033\u007d\u0028\u003f\u003a\u0032\u0035\u005b\u0030\u002d\u0035\u005d\u007c\u0032\u005b\u0030\u002d\u0034\u005d\u005c\u0064\u007c\u0031\u005cd\u007b\u0032\u007d\u007c\u005b\u0031\u002d\u0039\u005d?\u005c\u0064)\u005c\u0062";
RegexIPv6 ="\u005c\u0062\u0028[\u0030\u002d\u0039\u0061\u002d\u0066\u0041\u002d\u0046\u005d\u007b\u0031\u002c\u0034\u007d\u003a\u0029\u007b\u0037\u007d\u005b\u0030\u002d\u0039\u0061\u002d\u0066\u0041\u002dF\u005d\u007b\u0031\u002c\u0034\u007d\u005c\u0062";
RegexPassport ="\u005c\u0062\u005b\u0041\u002d\u005a\u0030\u002d\u0039\u005d\u007b\u0036,\u0039\u007d\u005c\u0062";RegexDriversLicense ="\u005cb\u005bA\u002d\u005a\u0030\u002d\u0039]\u007b\u0035,\u0031\u0035\u007d\u005c\u0062";RegexDate ="\u005cb\u0028\u003f\u003a\u005c\u0064\u007b\u0031,2\u007d\u005b\u002f\u002e\u002d\u005d\u005c\u0064\u007b\u0031\u002c\u0032\u007d\u005b/\u002e\u002d]\u005c\u0064\u007b2\u002c\u0034\u007d\u007c\u005c\u0064\u007b\u0034\u007d\u005b\u002d\u002f\u005d\u005c\u0064\u007b2\u007d\u005b-/\u005d\u005c\u0064{\u0032\u007d\u0029\u005c\u0062";
RegexPostalCode ="\\\u0062\\\u0064\u007b\u0035\u007d\u0028\u003f\u003a\u002d\\\u0064\u007b\u0034\u007d)?\u005c\u0062";RegexMAC ="\u005c\u0062\u0028\u003f\u003a\u005b\u0030-\u0039\u0041\u002dF\u0061\u002d\u0066\u005d{\u0032\u007d\u005b\u003a\u002d\u005d\u0029\u007b\u0035\u007d\u005b\u0030\u002d\u0039\u0041\u002d\u0046\u0061\u002d\u0066\u005d\u007b\u0032\u007d\u005c\u0062";
RegexBankRouting ="\u005cb\u005c\u0064\u007b\u0039\u007d\u005cb";RegexIBAN ="\u005c\u0062\u005b\u0041\u002d\u005a\u005d\u007b\u0032\u007d\u005c\u0064\u007b\u0032\u007d[\u0041-\u005a\u0030\u002d\u0039\u005d\u007b\u0031\u0031\u002c\u0033\u0030\u007d\u005c\u0062";
RegexAWSAccessKeyID ="\\\u0062A\u004b\u0049\u0041\u005b\u0030\u002d\u0039\u0041-\u005a\u005d\u007b\u00316}\u005c\u0062";RegexAWSSecretAccessKey ="\\\u0062\u005b\u0030\u002d9a\u002dz\u0041\u002d\u005a\u002f\u002b]\u007b\u0034\u0030\u007d\u005c\u0062";RegexGoogleAPIKey ="\u005c\u0062\u0041\u0049\u007a\u0061\u005b\u0030\u002d\u0039\u0041-\u005a\u0061\u002d\u007a\u005c\u002d\u005f\u005d\u007b\u00335\u007d\u005c\u0062";
RegexJWT ="\\b\u0065\u0079J\u005b\u0041\u002d\u005a\u0061\u002d\u007a\u0030\u002d9\u005f\u005c\u002d\u005d\u002b\u005c\u002e\u0065\u0079\u004a\u005b\u0041\u002d\u005a\u0061\u002d\u007a\u0030\u002d\u0039\u005f\u005c\u002d\u005d\u002b\u005c\u002e\u003f[\u0041-\u005a\u0061\u002d\u007a\u0030\u002d\u0039\u005f\\\u002d]\u002a\u005cb";
RegexCardExpirationDate ="\\\u0062\u0028\u0030\u005b\u0031\u002d9\u005d\u007c\u0031\u005b\u0030\u002d2\u005d\u0029\u002f\u0028\u003f\u003a\u005cd\u007b\u0032\u007d\u007c\u005c\u0064\u007b\u0034\u007d\u0029\\\u0062";RegexSWIFTCode ="\u005cb\u005b\u0041-\u005a\u005d\u007b4\u007d\u005b\u0041\u002d\u005a\u005d\u007b2\u007d\u005b\u0041\u002d\u005a\u0030-\u0039\u005d\u007b\u0032\u007d\u0028\u005b\u0041\u002d\u005a\u0030-\u0039\u005d\u007b\u0033\u007d\u0029\u003f\u005c\u0062";
RegexStripeAPIKey ="\u0073\u006b\u005fli\u0076\u0065\u005f\u005b\u0030\u002d\u0039\u0061\u002d\u007a\u0041\u002d\u005a\u005d\u007b\u0032\u0034\u007d";);func _eg (_bba *_ef .ContentStreamOperation ,_ff _ge .PdfObject ,_gf []localSpanMarks )error {var _acd *_ge .PdfObjectArray ;
_dabe ,_cbe :=_bed (_gf );if len (_cbe )==1{_bef :=_cbe [0];_fce :=_dabe [_bef ];if len (_fce )==1{_egc :=_fce [0];_ffg :=_egc ._bfc ;_fcbg :=_dba (_ffg );_caf ,_bdef :=_gfdf (_ff ,_fcbg );if _bdef !=nil {return _bdef ;};_ace ,_bdef :=_dcc (_egc ,_ffg ,_fcbg ,_caf ,_bef );
if _bdef !=nil {return _bdef ;};_acd =_ge .MakeArray (_ace ...);}else {_fcf :=_fce [0]._bfc ;_ege :=_dba (_fcf );_gbg ,_fae :=_gfdf (_ff ,_ege );if _fae !=nil {return _fae ;};_ecag ,_fae :=_edbg (_gbg ,_fce );if _fae !=nil {return _fae ;};_abd :=_ddf (_ecag );
_ged :=_facg (_gbg ,_abd ,_ege );_acd =_ge .MakeArray (_ged ...);};}else if len (_cbe )> 1{_gdeb :=_gf [0];_ggca :=_gdeb ._bfc ;_ ,_ebf :=_ab (_ggca );_fgg :=_ggca .Elements ()[_ebf ];_gae :=_fgg .Font ;_gaeb ,_fgd :=_gfdf (_ff ,_gae );if _fgd !=nil {return _fgd ;
};_ceaa ,_fgd :=_edbg (_gaeb ,_gf );if _fgd !=nil {return _fgd ;};_fe :=_ddf (_ceaa );_bdf :=_facg (_gaeb ,_fe ,_gae );_acd =_ge .MakeArray (_bdf ...);};_bba .Params [0]=_acd ;_bba .Operand ="\u0054\u004a";return nil ;};type matchedIndex struct{_bbea int ;
_dede int ;_bbdf string ;};func _ddf (_efa []placeHolders )[]replacement {_bae :=[]replacement {};for _ ,_bcc :=range _efa {_bge :=_bcc ._gd ;_ggg :=_bcc ._ee ;_fba :=_bcc ._da ;for _ ,_cfe :=range _bge {_bfb :=replacement {_gee :_ggg ,_ea :_fba ,_ae :_cfe };
_bae =append (_bae ,_bfb );};};_f .Slice (_bae ,func (_cca ,_bage int )bool {return _bae [_cca ]._ae < _bae [_bage ]._ae });return _bae ;};func _fbac (_agc *_ad .TextMarkArray )string {_caee :="";for _ ,_ccb :=range _agc .Elements (){_caee +=_ccb .Text ;
};return _caee ;};func _bdc (_efb *_ef .ContentStreamOperations ,_ba string ,_dfe int )error {_fc :=_ef .ContentStreamOperations {};var _de _ef .ContentStreamOperation ;for _c ,_bdg :=range *_efb {if _c ==_dfe {if _ba =="\u0027"{_bb :=_ef .ContentStreamOperation {Operand :"\u0054\u002a"};
_fc =append (_fc ,&_bb );_de .Params =_bdg .Params ;_de .Operand ="\u0054\u006a";_fc =append (_fc ,&_de );}else if _ba =="\u0022"{_afa :=_bdg .Params [:2];Tc ,Tw :=_afa [0],_afa [1];_ca :=_ef .ContentStreamOperation {Params :[]_ge .PdfObject {Tc },Operand :"\u0054\u0063"};
_fc =append (_fc ,&_ca );_ca =_ef .ContentStreamOperation {Params :[]_ge .PdfObject {Tw },Operand :"\u0054\u0077"};_fc =append (_fc ,&_ca );_de .Params =[]_ge .PdfObject {_bdg .Params [2]};_de .Operand ="\u0054\u006a";_fc =append (_fc ,&_de );};};_fc =append (_fc ,_bdg );
};*_efb =_fc ;return nil ;};

// WriteToFile writes the redacted document to file specified by `outputPath`.
func (_fgdgc *Redactor )WriteToFile (outputPath string )error {if _gabdc :=_fgdgc ._bcf .WriteToFile (outputPath );_gabdc !=nil {return _a .Errorf ("\u0066\u0061\u0069l\u0065\u0064\u0020\u0074o\u0020\u0077\u0072\u0069\u0074\u0065\u0020t\u0068\u0065\u0020\u006f\u0075\u0074\u0070\u0075\u0074\u0020\u0066\u0069\u006c\u0065");
};return nil ;};type matchedBBox struct{_ccab _bd .PdfRectangle ;_gbc string ;};func _edbg (_gca string ,_ecgg []localSpanMarks )([]placeHolders ,error ){_bca :="";_afe :=[]placeHolders {};for _aab ,_gba :=range _ecgg {_fac :=_gba ._bfc ;_dcb :=_gba ._bbbb ;
_fec :=_fbac (_fac );_fgf ,_geda :=_gdg (_fac );if _geda !=nil {return nil ,_geda ;};if _fec !=_bca {var _bfaf []int ;if _aab ==0&&_dcb !=_fec {_cee :=_d .Index (_gca ,_fec );_bfaf =[]int {_cee };}else if _aab ==len (_ecgg )-1{_bgdd :=_d .LastIndex (_gca ,_fec );
_bfaf =[]int {_bgdd };}else {_bfaf =_dfg (_gca ,_fec );};_dabg :=placeHolders {_gd :_bfaf ,_ee :_fec ,_da :_fgf };_afe =append (_afe ,_dabg );};_bca =_fec ;};return _afe ,nil ;};func _bfe (_dffa *targetMap ,_dbdf []int ){var _badf [][]int ;for _fcd ,_aef :=range _dffa ._ecbb {if _bc .Contains (_dbdf ,_fcd ){continue ;
};_badf =append (_badf ,_aef );};_dffa ._ecbb =_badf ;};func _dcc (_adb localSpanMarks ,_bfa *_ad .TextMarkArray ,_cg *_bd .PdfFont ,_dccf ,_feb string )([]_ge .PdfObject ,error ){_ecg :=_fbac (_bfa );Tj ,_dbe :=_gdg (_bfa );if _dbe !=nil {return nil ,_dbe ;
};_ag :=len (_dccf );_bfd :=len (_ecg );_aba :=-1;_fcac :=_ge .MakeFloat (Tj );if _ecg !=_feb {_aeb :=_adb ._gdf ;if _aeb ==0{_aba =_d .LastIndex (_dccf ,_ecg );}else {_aba =_d .Index (_dccf ,_ecg );};}else {_aba =_d .Index (_dccf ,_ecg );};_beb :=_aba +_bfd ;
_ded :=[]_ge .PdfObject {};if _aba ==0&&_beb ==_ag {_ded =append (_ded ,_fcac );}else if _aba ==0&&_beb < _ag {_dee :=_fcb (_dccf [_beb :],_cg );_fagc :=_ge .MakeStringFromBytes (_dee );_ded =append (_ded ,_fcac ,_fagc );}else if _aba > 0&&_beb >=_ag {_gfd :=_fcb (_dccf [:_aba ],_cg );
_efc :=_ge .MakeStringFromBytes (_gfd );_ded =append (_ded ,_efc ,_fcac );}else if _aba > 0&&_beb < _ag {_dfd :=_fcb (_dccf [:_aba ],_cg );_bag :=_fcb (_dccf [_beb :],_cg );_fed :=_ge .MakeStringFromBytes (_dfd );_ebgc :=_ge .MakeString (string (_bag ));
_ded =append (_ded ,_fed ,_fcac ,_ebgc );};return _ded ,nil ;};var StandardRegexPatterns =[]string {RegexSSN ,RegexCreditCard ,RegexEmail ,RegexPhone ,RegexIPv4 ,RegexIPv6 ,RegexPassport ,RegexDriversLicense ,RegexDate ,RegexPostalCode ,RegexMAC ,RegexBankRouting ,RegexIBAN ,RegexAWSAccessKeyID ,RegexAWSSecretAccessKey ,RegexGoogleAPIKey ,RegexJWT ,RegexCardExpirationDate ,RegexSWIFTCode ,RegexStripeAPIKey };
func _gfdf (_dgf _ge .PdfObject ,_ddg *_bd .PdfFont )(string ,error ){_fgcg ,_ced :=_ge .GetStringBytes (_dgf );if !_ced {return "",_ge .ErrTypeError ;};_dfb :=_ddg .BytesToCharcodes (_fgcg );_gfb ,_eabd ,_dbaf :=_ddg .CharcodesToStrings (_dfb ,"");if _dbaf > 0{_g .Log .Debug ("\u0072\u0065nd\u0065\u0072\u0054e\u0078\u0074\u003a\u0020num\u0043ha\u0072\u0073\u003d\u0025\u0064\u0020\u006eum\u004d\u0069\u0073\u0073\u0065\u0073\u003d%\u0064",_eabd ,_dbaf );
};_gab :=_d .Join (_gfb ,"");return _gab ,nil ;};func _dfg (_eaa ,_beg string )[]int {if len (_beg )==0{return nil ;};var _bfgc []int ;for _ggaf :=0;_ggaf < len (_eaa );{_gadg :=_d .Index (_eaa [_ggaf :],_beg );if _gadg < 0{return _bfgc ;};_bfgc =append (_bfgc ,_ggaf +_gadg );
_ggaf +=_gadg +len (_beg );};return _bfgc ;};func _gdg (_dfc *_ad .TextMarkArray )(float64 ,error ){_cab ,_fgce :=_dfc .BBox ();if !_fgce {return 0.0,_a .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_dfc );
};_dge :=_cad (_dfc );_egcg :=0.0;_ ,_gbd :=_ab (_dfc );_cbdf :=_dfc .Elements ()[_gbd ];_bad :=_cbdf .Font ;if _dge > 0{_egcg =_bcb (_bad ,_cbdf );};_gga :=(_cab .Urx -_cab .Llx );_gga =_gga +_egcg *float64 (_dge );Tj :=_dfcd (_gga ,_cbdf .FontSize ,_cbdf .Th );
return Tj ,nil ;};func _facg (_gaad string ,_gaaa []replacement ,_gge *_bd .PdfFont )[]_ge .PdfObject {_dea :=[]_ge .PdfObject {};_gfc :=0;_adc :=_gaad ;for _aea ,_cdc :=range _gaaa {_fgc :=_cdc ._ae ;_cdf :=_cdc ._ea ;_cff :=_cdc ._gee ;_dgc :=_ge .MakeFloat (_cdf );
if _gfc > _fgc ||_fgc ==-1{continue ;};_fbb :=_gaad [_gfc :_fgc ];_gefb :=_fcb (_fbb ,_gge );_daba :=_ge .MakeStringFromBytes (_gefb );_dea =append (_dea ,_daba );_dea =append (_dea ,_dgc );_cda :=_fgc +len (_cff );_adc =_gaad [_cda :];_gfc =_cda ;if _aea ==len (_gaaa )-1{_gefb =_fcb (_adc ,_gge );
_daba =_ge .MakeStringFromBytes (_gefb );_dea =append (_dea ,_daba );};};return _dea ;};

// New instantiates a Redactor object with given PdfReader and `regex` pattern.
func New (reader *_bd .PdfReader ,opts *RedactionOptions ,rectProps *RectangleProps )*Redactor {if rectProps ==nil {rectProps =RedactRectanglePropsNew ();};return &Redactor {_dbf :reader ,_bff :opts ,_bcf :_db .New (),_dbb :rectProps };};func _ab (_cb *_ad .TextMarkArray )(_ge .PdfObject ,int ){var _cae _ge .PdfObject ;
_fca :=-1;for _bbe ,_ggf :=range _cb .Elements (){_cae =_ggf .DirectObject ;_fca =_bbe ;if _cae !=nil {break ;};};return _cae ,_fca ;};func _adf (_ggfg *matchedIndex ,_eece [][]int )(bool ,[][]int ){_adbf :=[][]int {};for _ ,_eeee :=range _eece {if _ggfg ._bbea < _eeee [0]&&_ggfg ._dede > _eeee [1]{_adbf =append (_adbf ,_eeee );
};};return len (_adbf )> 0,_adbf ;};func (_fcg *regexMatcher )match (_febc string )([]*matchedIndex ,error ){_gaadg :=_fcg ._ade .Pattern ;if _gaadg ==nil {return nil ,_e .New ("\u006e\u006f\u0020\u0070at\u0074\u0065\u0072\u006e\u0020\u0063\u006f\u006d\u0070\u0069\u006c\u0065\u0064");
};var (_befd =_gaadg .FindAllStringIndex (_febc ,-1);_bda []*matchedIndex ;);for _ ,_agcc :=range _befd {_bda =append (_bda ,&matchedIndex {_bbea :_agcc [0],_dede :_agcc [1],_bbdf :_febc [_agcc [0]:_agcc [1]]});};return _bda ,nil ;};

// Redactor represents a Redactor object.
type Redactor struct{_dbf *_bd .PdfReader ;_bff *RedactionOptions ;_bcf *_db .Creator ;_dbb *RectangleProps ;_cabe []RedactionTerm ;};func _fege (_acde []*targetMap ){for _gedd ,_daa :=range _acde {for _aaa ,_dfgg :=range _acde {if _gedd !=_aaa {_cec ,_fdc :=_becc (*_daa ,*_dfgg );
if _cec {_bfe (_dfgg ,_fdc );};};};};};

// Redact executes the redact operation on a pdf file and updates the content streams of all pages of the file.
func (_bfda *Redactor )Redact ()error {_feg ,_abdb :=_bfda ._dbf .GetNumPages ();if _abdb !=nil {return _a .Errorf ("\u0066\u0061\u0069\u006c\u0065\u0064 \u0074\u006f\u0020\u0067\u0065\u0074\u0020\u0074\u0068\u0065\u0020\u006e\u0075m\u0062\u0065\u0072\u0020\u006f\u0066\u0020P\u0061\u0067\u0065\u0073");
};if _bfda ._bff .UseStandardPatterns {for _ ,_dfge :=range StandardRegexPatterns {_fab ,_ceb :=_af .Compile (_dfge );if _ceb !=nil {return _ceb ;};_bfda ._cabe =append (_bfda ._cabe ,RedactionTerm {Pattern :_fab });};};_cbf :=_bfda ._dbb .FillColor ;_acad :=_bfda ._dbb .BorderWidth ;
_agd :=_bfda ._dbb .FillOpacity ;for _dbde :=1;_dbde <=_feg ;_dbde ++{_gbde ,_eec :=_bfda ._dbf .GetPage (_dbde );if _eec !=nil {return _eec ;};_cgc ,_eec :=_ad .New (_gbde );if _eec !=nil {return _eec ;};_efcb ,_ ,_ ,_eec :=_cgc .ExtractPageText ();if _eec !=nil {return _eec ;
};_cafd :=_efcb .GetContentStreamOps ();_gcc ,_bdcd ,_eec :=_bfda .redactPage (_cafd ,_gbde .Resources );if _bdcd ==nil {_g .Log .Info ("N\u006f\u0020\u006d\u0061\u0074\u0063\u0068\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0066\u006f\u0072\u0020t\u0068\u0065\u0020\u0070\u0072\u006f\u0076\u0069\u0064\u0065d \u0070\u0061\u0074t\u0061r\u006e\u002e");
_bdcd =_cafd ;};_acea :=_ef .ContentStreamOperation {Operand :"\u006e"};*_bdcd =append (*_bdcd ,&_acea );_gbde .SetContentStreams ([]string {_bdcd .String ()},_ge .NewFlateEncoder ());if _eec !=nil {return _eec ;};_agf ,_eec :=_gbde .GetMediaBox ();if _eec !=nil {return _eec ;
};if _gbde .MediaBox ==nil {_gbde .MediaBox =_agf ;};if _bee :=_bfda ._bcf .AddPage (_gbde );_bee !=nil {return _bee ;};_f .Slice (_gcc ,func (_dgd ,_edbf int )bool {return _gcc [_dgd ]._gbc < _gcc [_edbf ]._gbc });_bccb :=_agf .Ury ;for _ ,_bgf :=range _gcc {_dec :=_bgf ._ccab ;
_dccc :=_bfda ._bcf .NewRectangle (_dec .Llx ,_bccb -_dec .Lly ,_dec .Urx -_dec .Llx ,-(_dec .Ury -_dec .Lly ));_dccc .SetFillColor (_cbf );_dccc .SetBorderWidth (_acad );_dccc .SetFillOpacity (_agd );if _cefa :=_bfda ._bcf .Draw (_dccc );_cefa !=nil {return nil ;
};};};_bfda ._bcf .SetOutlineTree (_bfda ._dbf .GetOutlineTree ());return nil ;};func (_bcg *Redactor )redactPage (_fcacc *_ef .ContentStreamOperations ,_bcac *_bd .PdfPageResources )([]matchedBBox ,*_ef .ContentStreamOperations ,error ){_gdce ,_aeg :=_ad .NewFromContents (_fcacc .String (),_bcac );
if _aeg !=nil {return nil ,nil ,_aeg ;};_aae ,_ ,_ ,_aeg :=_gdce .ExtractPageText ();if _aeg !=nil {return nil ,nil ,_aeg ;};_fcacc =_aae .GetContentStreamOps ();_fbd :=_aae .Marks ();_cba :=_aae .Text ();_cba ,_edf :=_ffe (_cba );_gabb :=[]matchedBBox {};
_ecd :=make (map[_ge .PdfObject ][]localSpanMarks );_aafb :=[]*targetMap {};_dce :=_bcg ._bff .Terms ;if _bcg ._bff .UseStandardPatterns {_dce =append (_dce ,_bcg ._cabe ...);};for _ ,_fga :=range _dce {_befe ,_gcgf :=_acbb (_fga );if _gcgf !=nil {return nil ,nil ,_gcgf ;
};_fggg ,_gcgf :=_befe .match (_cba );if _gcgf !=nil {return nil ,nil ,_gcgf ;};_fggg =_deabf (_fggg ,_edf );_eada :=_eed (_fggg );_aafb =append (_aafb ,_eada ...);};_fege (_aafb );for _ ,_bgfg :=range _aafb {_fbe :=_bgfg ._dfac ;_cfg :=_bgfg ._ecbb ;_eagc :=[]matchedBBox {};
for _ ,_bfgcf :=range _cfg {_deg ,_fggb ,_cdg :=_ecgf (_bfgcf ,_fbd ,_fbe );if _cdg !=nil {return nil ,nil ,_cdg ;};_eeg :=_cga (_deg );for _beca ,_efbg :=range _eeg {_cgb :=localSpanMarks {_bfc :_efbg ,_gdf :_beca ,_bbbb :_fbe };_eeec ,_ :=_ab (_efbg );
if _ffa ,_aegc :=_ecd [_eeec ];_aegc {_ecd [_eeec ]=append (_ffa ,_cgb );}else {_ecd [_eeec ]=[]localSpanMarks {_cgb };};};_eagc =append (_eagc ,_fggb );};_gabb =append (_gabb ,_eagc ...);};_aeg =_ead (_fcacc ,_ecd );if _aeg !=nil {return nil ,nil ,_aeg ;
};return _gabb ,_fcacc ,nil ;};func _ffe (_fbbc string )(string ,[][]int ){_gaba :=_af .MustCompile ("\u005c\u006e");_efee :=_gaba .FindAllStringIndex (_fbbc ,-1);_fagd :=_gaba .ReplaceAllString (_fbbc ,"\u0020");return _fagd ,_efee ;};type targetMap struct{_dfac string ;
_ecbb [][]int ;};

// RedactionTerm holds the regexp pattern and the replacement string for the redaction process.
type RedactionTerm struct{Pattern *_af .Regexp ;};func _acbb (_beda RedactionTerm )(*regexMatcher ,error ){return &regexMatcher {_ade :_beda },nil };func _dfcd (_beff ,_dgec ,_cac float64 )float64 {_cac =_cac /100;_egg :=(-1000*_beff )/(_dgec *_cac );return _egg ;
};type regexMatcher struct{_ade RedactionTerm };func _deabf (_cgea []*matchedIndex ,_ebbc [][]int )[]*matchedIndex {_fadcg :=[]*matchedIndex {};for _ ,_cggb :=range _cgea {_fggc ,_ddgb :=_adf (_cggb ,_ebbc );if _fggc {_gdb :=_fabf (_cggb ,_ddgb );_fadcg =append (_fadcg ,_gdb ...);
}else {_fadcg =append (_fadcg ,_cggb );};};return _fadcg ;};func _bcb (_ggc *_bd .PdfFont ,_ebb _ad .TextMark )float64 {_cbd :=0.001;_fb :=_ebb .Th /100;if _ggc .Subtype ()=="\u0054\u0079\u0070e\u0033"{_cbd =1;};_aaf ,_eae :=_ggc .GetRuneMetrics (' ');
if !_eae {_aaf ,_eae =_ggc .GetCharMetrics (32);};if !_eae {_aaf ,_ =_bd .DefaultFont ().GetRuneMetrics (' ');};_abb :=_cbd *((_aaf .Wx *_ebb .FontSize +_ebb .Tc +_ebb .Tw )/_fb );return _abb ;};func _fcb (_gb string ,_bbd *_bd .PdfFont )[]byte {_bec ,_fag :=_bbd .StringToCharcodeBytes (_gb );
if _fag !=0{_g .Log .Debug ("\u0057\u0041\u0052\u004e\u003a\u0020\u0073\u006fm\u0065\u0020\u0072un\u0065\u0073\u0020\u0063\u006f\u0075l\u0064\u0020\u006e\u006f\u0074\u0020\u0062\u0065\u0020\u0065\u006e\u0063\u006f\u0064\u0065d\u002e\u000a\u0009\u0025\u0073\u0020\u002d\u003e \u0025\u0076",_gb ,_bec );
};return _bec ;};func _bgg (_dc *_ef .ContentStreamOperation ,_eeb _ge .PdfObject ,_ce []localSpanMarks )error {_acg ,_bde :=_ge .GetArray (_dc .Params [0]);_dbd :=[]_ge .PdfObject {};if !_bde {_g .Log .Debug ("\u0045\u0052\u0052OR\u003a\u0020\u0054\u004a\u0020\u006f\u0070\u003d\u0025s\u0020G\u0065t\u0041r\u0072\u0061\u0079\u0056\u0061\u006c\u0020\u0066\u0061\u0069\u006c\u0065\u0064",_dc );
return _a .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_dc );
};_eca ,_dff :=_bed (_ce );if len (_dff )==1{_cag :=_dff [0];_ecb :=_eca [_cag ];if len (_ecb )==1{_aad :=_ecb [0];_eef :=_aad ._bfc ;_fa :=_dba (_eef );_ece ,_ga :=_gfdf (_eeb ,_fa );if _ga !=nil {return _ga ;};_dfa ,_ga :=_dcc (_aad ,_eef ,_fa ,_ece ,_cag );
if _ga !=nil {return _ga ;};for _ ,_ed :=range _acg .Elements (){if _ed ==_eeb {_dbd =append (_dbd ,_dfa ...);}else {_dbd =append (_dbd ,_ed );};};}else {_cea :=_ecb [0]._bfc ;_cd :=_dba (_cea );_acb ,_bf :=_gfdf (_eeb ,_cd );if _bf !=nil {return _bf ;
};_dbc ,_bf :=_edbg (_acb ,_ecb );if _bf !=nil {return _bf ;};_eee :=_ddf (_dbc );_eb :=_facg (_acb ,_eee ,_cd );for _ ,_dbge :=range _acg .Elements (){if _dbge ==_eeb {_dbd =append (_dbd ,_eb ...);}else {_dbd =append (_dbd ,_dbge );};};};_dc .Params [0]=_ge .MakeArray (_dbd ...);
}else if len (_dff )> 1{_eab :=_ce [0];_cf :=_eab ._bfc ;_ ,_dg :=_ab (_cf );_geg :=_cf .Elements ()[_dg ];_be :=_geg .Font ;_cef ,_aca :=_gfdf (_eeb ,_be );if _aca !=nil {return _aca ;};_gaa ,_aca :=_edbg (_cef ,_ce );if _aca !=nil {return _aca ;};_bga :=_ddf (_gaa );
_gde :=_facg (_cef ,_bga ,_be );for _ ,_dfae :=range _acg .Elements (){if _dfae ==_eeb {_dbd =append (_dbd ,_gde ...);}else {_dbd =append (_dbd ,_dfae );};};_dc .Params [0]=_ge .MakeArray (_dbd ...);};return nil ;};type placeHolders struct{_gd []int ;_ee string ;
_da float64 ;};func _ecgf (_bcca []int ,_gccb *_ad .TextMarkArray ,_efga string )(*_ad .TextMarkArray ,matchedBBox ,error ){_edbcf :=matchedBBox {};_ecec :=_bcca [0];_afed :=_bcca [1];_gff :=len (_efga )-len (_d .TrimLeft (_efga ,"\u0020"));_cgg :=len (_efga )-len (_d .TrimRight (_efga ,"\u0020\u000a"));
_ecec =_ecec +_gff ;_afed =_afed -_cgg ;_efga =_d .Trim (_efga ,"\u0020\u000a");_cfcg ,_fbee :=_gccb .RangeOffset (_ecec ,_afed );if _fbee !=nil {return nil ,_edbcf ,_fbee ;};_deab ,_gfe :=_cfcg .BBox ();if !_gfe {return nil ,_edbcf ,_a .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_cfcg );
};_edbcf =matchedBBox {_gbc :_efga ,_ccab :_deab };return _cfcg ,_edbcf ,nil ;};func _fdf (_ede *_ad .TextMarkArray ,_eegd int )int {_dbee :=_ede .Elements ();_degc :=_eegd -1;_bbc :=_eegd +1;_efd :=-1;if _degc >=0{_ggd :=_dbee [_degc ];_age :=_ggd .ObjString ;
_bfcg :=len (_age );_ebc :=_ggd .Index ;if _ebc +1< _bfcg {_efd =_degc ;return _efd ;};};if _bbc < len (_dbee ){_cagg :=_dbee [_bbc ];_gac :=_cagg .ObjString ;if _gac [0]!=_cagg .Text {_efd =_bbc ;return _efd ;};};return _efd ;};func _dba (_bgdg *_ad .TextMarkArray )*_bd .PdfFont {_ ,_daf :=_ab (_bgdg );
_baf :=_bgdg .Elements ()[_daf ];_dd :=_baf .Font ;return _dd ;};func _fabf (_cdfa *matchedIndex ,_ffac [][]int )[]*matchedIndex {_ggdc :=[]*matchedIndex {};_ffae :=_cdfa ._bbea ;_gfeb :=_ffae ;_daaf :=_cdfa ._bbdf ;_gaec :=0;for _ ,_abg :=range _ffac {_cgae :=_abg [0]-_ffae ;
if _gaec >=_cgae {continue ;};_fcee :=_daaf [_gaec :_cgae ];_aafgg :=&matchedIndex {_bbdf :_fcee ,_bbea :_gfeb ,_dede :_abg [0]};if len (_d .TrimSpace (_fcee ))!=0{_ggdc =append (_ggdc ,_aafgg );};_gaec =_abg [1]-_ffae ;_gfeb =_ffae +_gaec ;};_begf :=_daaf [_gaec :];
_gdbe :=&matchedIndex {_bbdf :_begf ,_bbea :_gfeb ,_dede :_cdfa ._dede };if len (_d .TrimSpace (_begf ))!=0{_ggdc =append (_ggdc ,_gdbe );};return _ggdc ;};func _ead (_bg *_ef .ContentStreamOperations ,_ac map[_ge .PdfObject ][]localSpanMarks )error {for _df ,_eag :=range _ac {if _df ==nil {continue ;
};_gc ,_ec ,_dbg :=_bfg (_bg ,_df );if !_dbg {_g .Log .Debug ("Pd\u0066\u004fb\u006a\u0065\u0063\u0074\u0020\u0025\u0073\u006e\u006ft\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0069\u006e\u0020\u0073\u0069\u0064\u0065\u0020\u0074\u0068\u0065\u0020\u0063\u006f\u006e\u0074\u0065\u006e\u0074\u0073\u0074r\u0065a\u006d\u0020\u006f\u0070\u0065\u0072\u0061\u0074i\u006fn\u0020\u0025s",_df ,_bg );
return nil ;};if _gc .Operand =="\u0054\u006a"{_afb :=_eg (_gc ,_df ,_eag );if _afb !=nil {return _afb ;};}else if _gc .Operand =="\u0054\u004a"{_bgd :=_bgg (_gc ,_df ,_eag );if _bgd !=nil {return _bgd ;};}else if _gc .Operand =="\u0027"||_gc .Operand =="\u0022"{_gcg :=_bdc (_bg ,_gc .Operand ,_ec );
if _gcg !=nil {return _gcg ;};_gcg =_eg (_gc ,_df ,_eag );if _gcg !=nil {return _gcg ;};};};return nil ;};

// Write writes the content of `re.creator` to writer of type io.Writer interface.
func (_fccg *Redactor )Write (writer _aa .Writer )error {return _fccg ._bcf .Write (writer )};func _cga (_cbg *_ad .TextMarkArray )[]*_ad .TextMarkArray {_gfdb :=_cbg .Elements ();_gfdbd :=len (_gfdb );var _eaaa _ge .PdfObject ;_agec :=[]*_ad .TextMarkArray {};
_efe :=&_ad .TextMarkArray {};_dgg :=-1;for _fcce ,_eecf :=range _gfdb {_deaf :=_eecf .DirectObject ;_dgg =_eecf .Index ;if _deaf ==nil {_gabd :=_fdf (_cbg ,_fcce );if _eaaa !=nil {if _gabd ==-1||_gabd > _fcce {_agec =append (_agec ,_efe );_efe =&_ad .TextMarkArray {};
};};}else if _eaaa ==nil {if _dgg ==0&&_fcce > 0{_agec =append (_agec ,_efe );_efe =&_ad .TextMarkArray {};};}else {if _deaf !=_eaaa {_agec =append (_agec ,_efe );_efe =&_ad .TextMarkArray {};};};_eaaa =_deaf ;_efe .Append (_eecf );if _fcce ==(_gfdbd -1){_agec =append (_agec ,_efe );
};};return _agec ;};type localSpanMarks struct{_bfc *_ad .TextMarkArray ;_gdf int ;_bbbb string ;};func _bed (_dab []localSpanMarks )(map[string ][]localSpanMarks ,[]string ){_edb :=make (map[string ][]localSpanMarks );_baa :=[]string {};for _ ,_ceg :=range _dab {_gad :=_ceg ._bbbb ;
if _edbc ,_ebg :=_edb [_gad ];_ebg {_edb [_gad ]=append (_edbc ,_ceg );}else {_edb [_gad ]=[]localSpanMarks {_ceg };_baa =append (_baa ,_gad );};};return _edb ,_baa ;};func _bfg (_bedd *_ef .ContentStreamOperations ,PdfObj _ge .PdfObject )(*_ef .ContentStreamOperation ,int ,bool ){for _bbb ,_gea :=range *_bedd {_fecc :=_gea .Operand ;
if _fecc =="\u0054\u006a"{_fgdg :=_ge .TraceToDirectObject (_gea .Params [0]);if _fgdg ==PdfObj {return _gea ,_bbb ,true ;};}else if _fecc =="\u0054\u004a"{_fd ,_ebd :=_ge .GetArray (_gea .Params [0]);if !_ebd {return nil ,_bbb ,_ebd ;};for _ ,_facf :=range _fd .Elements (){if _facf ==PdfObj {return _gea ,_bbb ,true ;
};};}else if _fecc =="\u0022"{_aebe :=_ge .TraceToDirectObject (_gea .Params [2]);if _aebe ==PdfObj {return _gea ,_bbb ,true ;};}else if _fecc =="\u0027"{_dcg :=_ge .TraceToDirectObject (_gea .Params [0]);if _dcg ==PdfObj {return _gea ,_bbb ,true ;};};
};return nil ,-1,false ;};

// RedactRectanglePropsNew return a new pointer to a default RectangleProps object.
func RedactRectanglePropsNew ()*RectangleProps {return &RectangleProps {FillColor :_db .ColorBlack ,BorderWidth :0.0,FillOpacity :1.0};};

// RedactionOptions is a collection of RedactionTerm objects.
type RedactionOptions struct{Terms []RedactionTerm ;UseStandardPatterns bool ;};