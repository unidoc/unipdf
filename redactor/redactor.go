//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package redactor ;import (_g "errors";_f "fmt";_b "github.com/unidoc/unipdf/v3/common";_fd "github.com/unidoc/unipdf/v3/contentstream";_d "github.com/unidoc/unipdf/v3/core";_a "github.com/unidoc/unipdf/v3/creator";_gd "github.com/unidoc/unipdf/v3/extractor";
_ff "github.com/unidoc/unipdf/v3/model";_gf "io";_fc "regexp";_fcd "sort";_ee "strings";);func _bgd (_bd *_fd .ContentStreamOperations ,_fa string ,_de int )error {_add :=_fd .ContentStreamOperations {};var _ea _fd .ContentStreamOperation ;for _af ,_beg :=range *_bd {if _af ==_de {if _fa =="\u0027"{_fg :=_fd .ContentStreamOperation {Operand :"\u0054\u002a"};
_add =append (_add ,&_fg );_ea .Params =_beg .Params ;_ea .Operand ="\u0054\u006a";_add =append (_add ,&_ea );}else if _fa =="\u0022"{_eag :=_beg .Params [:2];Tc ,Tw :=_eag [0],_eag [1];_begc :=_fd .ContentStreamOperation {Params :[]_d .PdfObject {Tc },Operand :"\u0054\u0063"};
_add =append (_add ,&_begc );_begc =_fd .ContentStreamOperation {Params :[]_d .PdfObject {Tw },Operand :"\u0054\u0077"};_add =append (_add ,&_begc );_ea .Params =[]_d .PdfObject {_beg .Params [2]};_ea .Operand ="\u0054\u006a";_add =append (_add ,&_ea );
};};_add =append (_add ,_beg );};*_bd =_add ;return nil ;};func _dd (_bc *_fd .ContentStreamOperations ,_db map[_d .PdfObject ][]localSpanMarks )error {for _bcg ,_ga :=range _db {if _bcg ==nil {continue ;};_ffd ,_be ,_ad :=_dec (_bc ,_bcg );if !_ad {_b .Log .Debug ("Pd\u0066\u004fb\u006a\u0065\u0063\u0074\u0020\u0025\u0073\u006e\u006ft\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0069\u006e\u0020\u0073\u0069\u0064\u0065\u0020\u0074\u0068\u0065\u0020\u0063\u006f\u006e\u0074\u0065\u006e\u0074\u0073\u0074r\u0065a\u006d\u0020\u006f\u0070\u0065\u0072\u0061\u0074i\u006fn\u0020\u0025s",_bcg ,_bc );
return nil ;};if _ffd .Operand =="\u0054\u006a"{_aa :=_gfe (_ffd ,_bcg ,_ga );if _aa !=nil {return _aa ;};}else if _ffd .Operand =="\u0054\u004a"{_ab :=_eb (_ffd ,_bcg ,_ga );if _ab !=nil {return _ab ;};}else if _ffd .Operand =="\u0027"||_ffd .Operand =="\u0022"{_gb :=_bgd (_bc ,_ffd .Operand ,_be );
if _gb !=nil {return _gb ;};_gb =_gfe (_ffd ,_bcg ,_ga );if _gb !=nil {return _gb ;};};};return nil ;};func _cab (_beb ,_fba ,_bdfd float64 )float64 {_bdfd =_bdfd /100;_gdeg :=(-1000*_beb )/(_fba *_bdfd );return _gdeg ;};

// WriteToFile writes the redacted document to file specified by `outputPath`.
func (_ccbb *Redactor )WriteToFile (outputPath string )error {if _gefg :=_ccbb ._fdcb .WriteToFile (outputPath );_gefg !=nil {return _f .Errorf ("\u0066\u0061\u0069l\u0065\u0064\u0020\u0074o\u0020\u0077\u0072\u0069\u0074\u0065\u0020t\u0068\u0065\u0020\u006f\u0075\u0074\u0070\u0075\u0074\u0020\u0066\u0069\u006c\u0065");
};return nil ;};func _cfa (_ed *_gd .TextMarkArray )(_d .PdfObject ,int ){var _da _d .PdfObject ;_bb :=-1;for _bf ,_fad :=range _ed .Elements (){_da =_fad .DirectObject ;_bb =_bf ;if _da !=nil {break ;};};return _da ,_bb ;};func _ca (_fec []placeHolders )[]replacement {_dgf :=[]replacement {};
for _ ,_fdg :=range _fec {_deb :=_fdg ._ef ;_caf :=_fdg ._bg ;_gba :=_fdg ._ge ;for _ ,_bbfd :=range _deb {_acb :=replacement {_fce :_caf ,_ag :_gba ,_c :_bbfd };_dgf =append (_dgf ,_acb );};};_fcd .Slice (_dgf ,func (_dga ,_bbg int )bool {return _dgf [_dga ]._c < _dgf [_bbg ]._c });
return _dgf ;};func _bag (_beaa ,_cebf string )[]int {if len (_cebf )==0{return nil ;};var _degc []int ;for _cfe :=0;_cfe < len (_beaa );{_dee :=_ee .Index (_beaa [_cfe :],_cebf );if _dee < 0{return _degc ;};_degc =append (_degc ,_cfe +_dee );_cfe +=_dee +len (_cebf );
};return _degc ;};

// RedactionOptions is a collection of RedactionTerm objects.
type RedactionOptions struct{Terms []RedactionTerm ;};

// RectangleProps defines properties of the redaction rectangle to be drawn.
type RectangleProps struct{FillColor _a .Color ;BorderWidth float64 ;FillOpacity float64 ;};func _cce (_aef *_gd .TextMarkArray )*_ff .PdfFont {_ ,_cea :=_cfa (_aef );_ceb :=_aef .Elements ()[_cea ];_adfa :=_ceb .Font ;return _adfa ;};func _dcg (_ba string ,_efc *_ff .PdfFont )[]byte {_ged ,_acf :=_efc .StringToCharcodeBytes (_ba );
if _acf !=0{_b .Log .Debug ("\u0057\u0041\u0052\u004e\u003a\u0020\u0073\u006fm\u0065\u0020\u0072un\u0065\u0073\u0020\u0063\u006f\u0075l\u0064\u0020\u006e\u006f\u0074\u0020\u0062\u0065\u0020\u0065\u006e\u0063\u006f\u0064\u0065d\u002e\u000a\u0009\u0025\u0073\u0020\u002d\u003e \u0025\u0076",_ba ,_ged );
};return _ged ;};func _dca (_deeg *_gd .TextMarkArray ,_eaa int ,_ggfe int )int {_bdcf :=_deeg .Elements ();_eaad :=_eaa -1;_eab :=_eaa +1;_cafa :=-1;if _eaad >=0{_faeb :=_bdcf [_eaad ];_edb :=_faeb .ObjString ;_bec :=len (_edb );_bfc :=_faeb .Index ;if _bfc +1< _bec {_cafa =_eaad ;
return _cafa ;};};if _eab < len (_bdcf ){_caga :=_bdcf [_eab ];_bbe :=_caga .ObjString ;if _bbe [0]!=_caga .Text {_cafa =_eab ;return _cafa ;};};return _cafa ;};func _ead (_bbbc string ,_abf []localSpanMarks )([]placeHolders ,error ){_gac :="";_fgf :=[]placeHolders {};
for _cffg ,_dea :=range _abf {_faf :=_dea ._fedf ;_ebf :=_dea ._bca ;_abae :=_gfc (_faf );_gcc ,_eefc :=_ebbb (_faf );if _eefc !=nil {return nil ,_eefc ;};if _abae !=_gac {var _gda []int ;if _cffg ==0&&_ebf !=_abae {_dda :=_ee .Index (_bbbc ,_abae );_gda =[]int {_dda };
}else if _cffg ==len (_abf )-1{_gacb :=_ee .LastIndex (_bbbc ,_abae );_gda =[]int {_gacb };}else {_gda =_bag (_bbbc ,_abae );};_dba :=placeHolders {_ef :_gda ,_bg :_abae ,_ge :_gcc };_fgf =append (_fgf ,_dba );};_gac =_abae ;};return _fgf ,nil ;};

// Redact executes the redact operation on a pdf file and updates the content streams of all pages of the file.
func (_agdg *Redactor )Redact ()error {_ggc ,_ddfa :=_agdg ._ccd .GetNumPages ();if _ddfa !=nil {return _f .Errorf ("\u0066\u0061\u0069\u006c\u0065\u0064 \u0074\u006f\u0020\u0067\u0065\u0074\u0020\u0074\u0068\u0065\u0020\u006e\u0075m\u0062\u0065\u0072\u0020\u006f\u0066\u0020P\u0061\u0067\u0065\u0073");
};_cggd :=_agdg ._acg .FillColor ;_bcd :=_agdg ._acg .BorderWidth ;_cfg :=_agdg ._acg .FillOpacity ;for _aeba :=1;_aeba <=_ggc ;_aeba ++{_fff ,_abb :=_agdg ._ccd .GetPage (_aeba );if _abb !=nil {return _abb ;};_aec ,_abb :=_gd .New (_fff );if _abb !=nil {return _abb ;
};_caeb ,_ ,_ ,_abb :=_aec .ExtractPageText ();if _abb !=nil {return _abb ;};_fea :=_caeb .GetContentStreamOps ();_eee ,_eac ,_abb :=_agdg .redactPage (_fea ,_fff .Resources );if _eac ==nil {_b .Log .Info ("N\u006f\u0020\u006d\u0061\u0074\u0063\u0068\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0066\u006f\u0072\u0020t\u0068\u0065\u0020\u0070\u0072\u006f\u0076\u0069\u0064\u0065d \u0070\u0061\u0074t\u0061r\u006e\u002e");
_eac =_fea ;};_cdg :=_fd .ContentStreamOperation {Operand :"\u006e"};*_eac =append (*_eac ,&_cdg );_fff .SetContentStreams ([]string {_eac .String ()},_d .NewFlateEncoder ());if _abb !=nil {return _abb ;};_dgab ,_abb :=_fff .GetMediaBox ();if _abb !=nil {return _abb ;
};if _fff .MediaBox ==nil {_fff .MediaBox =_dgab ;};if _cbeg :=_agdg ._fdcb .AddPage (_fff );_cbeg !=nil {return _cbeg ;};_fcd .Slice (_eee ,func (_gcd ,_gccd int )bool {return _eee [_gcd ]._fddc < _eee [_gccd ]._fddc });_dgac :=_dgab .Ury ;for _ ,_fced :=range _eee {_fadf :=_fced ._dgb ;
_bdee :=_agdg ._fdcb .NewRectangle (_fadf .Llx ,_dgac -_fadf .Lly ,_fadf .Urx -_fadf .Llx ,-(_fadf .Ury -_fadf .Lly ));_bdee .SetFillColor (_cggd );_bdee .SetBorderWidth (_bcd );_bdee .SetFillOpacity (_cfg );if _aae :=_agdg ._fdcb .Draw (_bdee );_aae !=nil {return nil ;
};};};_agdg ._fdcb .SetOutlineTree (_agdg ._ccd .GetOutlineTree ());return nil ;};func (_baaf *regexMatcher )match (_fbe string )([]*matchedIndex ,error ){_gcga :=_baaf ._cfbd .Pattern ;if _gcga ==nil {return nil ,_g .New ("\u006e\u006f\u0020\u0070at\u0074\u0065\u0072\u006e\u0020\u0063\u006f\u006d\u0070\u0069\u006c\u0065\u0064");
};var (_efff =_gcga .FindAllStringIndex (_fbe ,-1);_ccc []*matchedIndex ;);for _ ,_acgd :=range _efff {_ccc =append (_ccc ,&matchedIndex {_acfd :_acgd [0],_gfcb :_acgd [1],_aeb :_fbe [_acgd [0]:_acgd [1]]});};return _ccc ,nil ;};func _adag (_gcg string )(string ,[][]int ){_bege :=_fc .MustCompile ("\u005c\u006e");
_gfbb :=_bege .FindAllStringIndex (_gcg ,-1);_bfe :=_bege .ReplaceAllString (_gcg ,"\u0020");return _bfe ,_gfbb ;};

// Write writes the content of `re.creator` to writer of type io.Writer interface.
func (_gbebc *Redactor )Write (writer _gf .Writer )error {return _gbebc ._fdcb .Write (writer )};type matchedIndex struct{_acfd int ;_gfcb int ;_aeb string ;};

// RedactRectanglePropsNew return a new pointer to a default RectangleProps object.
func RedactRectanglePropsNew ()*RectangleProps {return &RectangleProps {FillColor :_a .ColorBlack ,BorderWidth :0.0,FillOpacity :1.0};};func _dbcf (_ebb string ,_adc []replacement ,_bbc *_ff .PdfFont )[]_d .PdfObject {_eba :=[]_d .PdfObject {};_affc :=0;
_bgba :=_ebb ;for _fcb ,_bcc :=range _adc {_acd :=_bcc ._c ;_cgcf :=_bcc ._ag ;_cae :=_bcc ._fce ;_eff :=_d .MakeFloat (_cgcf );if _affc > _acd ||_acd ==-1{continue ;};_cecb :=_ebb [_affc :_acd ];_bdf :=_dcg (_cecb ,_bbc );_edfb :=_d .MakeStringFromBytes (_bdf );
_eba =append (_eba ,_edfb );_eba =append (_eba ,_eff );_agcd :=_acd +len (_cae );_bgba =_ebb [_agcd :];_affc =_agcd ;if _fcb ==len (_adc )-1{_bdf =_dcg (_bgba ,_bbc );_edfb =_d .MakeStringFromBytes (_bdf );_eba =append (_eba ,_edfb );};};return _eba ;};
func _gfe (_fcea *_fd .ContentStreamOperation ,_acae _d .PdfObject ,_bbb []localSpanMarks )error {var _gbe *_d .PdfObjectArray ;_edg ,_eg :=_gbg (_bbb );if len (_eg )==1{_cde :=_eg [0];_feg :=_edg [_cde ];if len (_feg )==1{_gdee :=_feg [0];_cbe :=_gdee ._fedf ;
_cec :=_cce (_cbe );_gfaa ,_egb :=_gdf (_acae ,_cec );if _egb !=nil {return _egb ;};_cdd ,_egb :=_afb (_gdee ,_cbe ,_cec ,_gfaa ,_cde );if _egb !=nil {return _egb ;};_gbe =_d .MakeArray (_cdd ...);}else {_fgb :=_feg [0]._fedf ;_eef :=_cce (_fgb );_fbg ,_agc :=_gdf (_acae ,_eef );
if _agc !=nil {return _agc ;};_egba ,_agc :=_ead (_fbg ,_feg );if _agc !=nil {return _agc ;};_gdef :=_ca (_egba );_cbd :=_dbcf (_fbg ,_gdef ,_eef );_gbe =_d .MakeArray (_cbd ...);};}else if len (_eg )> 1{_edgc :=_bbb [0];_fdd :=_edgc ._fedf ;_ ,_eegb :=_cfa (_fdd );
_eaf :=_fdd .Elements ()[_eegb ];_ddf :=_eaf .Font ;_gbd ,_deg :=_gdf (_acae ,_ddf );if _deg !=nil {return _deg ;};_gcf ,_deg :=_ead (_gbd ,_bbb );if _deg !=nil {return _deg ;};_ccb :=_ca (_gcf );_dg :=_dbcf (_gbd ,_ccb ,_ddf );_gbe =_d .MakeArray (_dg ...);
};_fcea .Params [0]=_gbe ;_fcea .Operand ="\u0054\u004a";return nil ;};func _egd (_bcaf []*matchedIndex )[]*targetMap {_fbgg :=make (map[string ][][]int );_ebc :=[]*targetMap {};for _ ,_febb :=range _bcaf {_geee :=_febb ._aeb ;_efcc :=[]int {_febb ._acfd ,_febb ._gfcb };
if _bcce ,_edag :=_fbgg [_geee ];_edag {_fbgg [_geee ]=append (_bcce ,_efcc );}else {_fbgg [_geee ]=[][]int {_efcc };};};for _aecd ,_dfbb :=range _fbgg {_gbb :=&targetMap {_bbfc :_aecd ,_ebba :_dfbb };_ebc =append (_ebc ,_gbb );};return _ebc ;};func _eb (_ce *_fd .ContentStreamOperation ,_ac _d .PdfObject ,_cd []localSpanMarks )error {_cdf ,_bce :=_d .GetArray (_ce .Params [0]);
_agb :=[]_d .PdfObject {};if !_bce {_b .Log .Debug ("\u0045\u0052\u0052OR\u003a\u0020\u0054\u004a\u0020\u006f\u0070\u003d\u0025s\u0020G\u0065t\u0041r\u0072\u0061\u0079\u0056\u0061\u006c\u0020\u0066\u0061\u0069\u006c\u0065\u0064",_ce );return _f .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_ce );
};_gfa ,_gg :=_gbg (_cd );if len (_gg )==1{_fdc :=_gg [0];_aga :=_gfa [_fdc ];if len (_aga )==1{_fe :=_aga [0];_fb :=_fe ._fedf ;_eeb :=_cce (_fb );_aba ,_df :=_gdf (_ac ,_eeb );if _df !=nil {return _df ;};_ggg ,_df :=_afb (_fe ,_fb ,_eeb ,_aba ,_fdc );
if _df !=nil {return _df ;};for _ ,_aab :=range _cdf .Elements (){if _aab ==_ac {_agb =append (_agb ,_ggg ...);}else {_agb =append (_agb ,_aab );};};}else {_cda :=_aga [0]._fedf ;_fdb :=_cce (_cda );_gde ,_fbb :=_gdf (_ac ,_fdb );if _fbb !=nil {return _fbb ;
};_fbf ,_fbb :=_ead (_gde ,_aga );if _fbb !=nil {return _fbb ;};_ae :=_ca (_fbf );_ggf :=_dbcf (_gde ,_ae ,_fdb );for _ ,_gc :=range _cdf .Elements (){if _gc ==_ac {_agb =append (_agb ,_ggf ...);}else {_agb =append (_agb ,_gc );};};};_ce .Params [0]=_d .MakeArray (_agb ...);
}else if len (_gg )> 1{_aabc :=_cd [0];_cg :=_aabc ._fedf ;_ ,_ec :=_cfa (_cg );_cgc :=_cg .Elements ()[_ec ];_cfc :=_cgc .Font ;_gff ,_cgg :=_gdf (_ac ,_cfc );if _cgg !=nil {return _cgg ;};_ecg ,_cgg :=_ead (_gff ,_cd );if _cgg !=nil {return _cgg ;};_edf :=_ca (_ecg );
_fbbg :=_dbcf (_gff ,_edf ,_cfc );for _ ,_aacf :=range _cdf .Elements (){if _aacf ==_ac {_agb =append (_agb ,_fbbg ...);}else {_agb =append (_agb ,_aacf );};};_ce .Params [0]=_d .MakeArray (_agb ...);};return nil ;};

// RedactionTerm holds the regexp pattern and the replacement string for the redaction process.
type RedactionTerm struct{Pattern *_fc .Regexp ;};

// Redactor represents a Redactor object.
type Redactor struct{_ccd *_ff .PdfReader ;_dge *RedactionOptions ;_fdcb *_a .Creator ;_acg *RectangleProps ;};func _dgce (_feead []*targetMap ){for _agfb ,_aced :=range _feead {for _gceb ,_fece :=range _feead {if _agfb !=_gceb {_bgg ,_gag :=_ebg (*_aced ,*_fece );
if _bgg {_bdcd (_fece ,_gag );};};};};};func (_bff *Redactor )redactPage (_aacd *_fd .ContentStreamOperations ,_dgc *_ff .PdfPageResources )([]matchedBBox ,*_fd .ContentStreamOperations ,error ){_ccf ,_dfcaa :=_gd .NewFromContents (_aacd .String (),_dgc );
if _dfcaa !=nil {return nil ,nil ,_dfcaa ;};_gcfg ,_ ,_ ,_dfcaa :=_ccf .ExtractPageText ();if _dfcaa !=nil {return nil ,nil ,_dfcaa ;};_aacd =_gcfg .GetContentStreamOps ();_cdaa :=_gcfg .Marks ();_gbgg :=_gcfg .Text ();_gbgg ,_aceb :=_adag (_gbgg );_ggb :=[]matchedBBox {};
_gef :=make (map[_d .PdfObject ][]localSpanMarks );_fcee :=[]*targetMap {};for _ ,_fcbd :=range _bff ._dge .Terms {_fgfb ,_debc :=_cfef (_fcbd );if _debc !=nil {return nil ,nil ,_debc ;};_abaed ,_debc :=_fgfb .match (_gbgg );if _debc !=nil {return nil ,nil ,_debc ;
};_abaed =_ebcd (_abaed ,_aceb );_fac :=_egd (_abaed );_fcee =append (_fcee ,_fac ...);};_dgce (_fcee );for _ ,_bed :=range _fcee {_gbaa :=_bed ._bbfc ;_baa :=_bed ._ebba ;_geea :=[]matchedBBox {};for _ ,_fafg :=range _baa {_efb ,_adbf ,_cbec :=_ffa (_fafg ,_cdaa ,_gbaa );
if _cbec !=nil {return nil ,nil ,_cbec ;};_bbgc :=_cbde (_efb );for _ada ,_bee :=range _bbgc {_ebff :=localSpanMarks {_fedf :_bee ,_eefce :_ada ,_bca :_gbaa };_afg ,_ :=_cfa (_bee );if _agg ,_fgaf :=_gef [_afg ];_fgaf {_gef [_afg ]=append (_agg ,_ebff );
}else {_gef [_afg ]=[]localSpanMarks {_ebff };};};_geea =append (_geea ,_adbf );};_ggb =append (_ggb ,_geea ...);};_dfcaa =_dd (_aacd ,_gef );if _dfcaa !=nil {return nil ,nil ,_dfcaa ;};return _ggb ,_aacd ,nil ;};func _ebbb (_feb *_gd .TextMarkArray )(float64 ,error ){_gad ,_fafe :=_feb .BBox ();
if !_fafe {return 0.0,_f .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_feb );
};_fed :=_cf (_feb );_bea :=0.0;_ ,_cfbe :=_cfa (_feb );_bbca :=_feb .Elements ()[_cfbe ];_agbd :=_bbca .Font ;if _fed > 0{_bea =_fgc (_agbd ,_bbca );};_bbd :=(_gad .Urx -_gad .Llx );_bbd =_bbd +_bea *float64 (_fed );Tj :=_cab (_bbd ,_bbca .FontSize ,_bbca .Th );
return Tj ,nil ;};type replacement struct{_fce string ;_ag float64 ;_c int ;};func _bdcd (_gdg *targetMap ,_edga []int ){var _ebaa [][]int ;for _aefg ,_dbaf :=range _gdg ._ebba {if _ggge (_aefg ,_edga ){continue ;};_ebaa =append (_ebaa ,_dbaf );};_gdg ._ebba =_ebaa ;
};func _gdf (_dfca _d .PdfObject ,_fda *_ff .PdfFont )(string ,error ){_gce ,_bbgd :=_d .GetStringBytes (_dfca );if !_bbgd {return "",_d .ErrTypeError ;};_eec :=_fda .BytesToCharcodes (_gce );_feea ,_ecf ,_cced :=_fda .CharcodesToStrings (_eec );if _cced > 0{_b .Log .Debug ("\u0072\u0065nd\u0065\u0072\u0054e\u0078\u0074\u003a\u0020num\u0043ha\u0072\u0073\u003d\u0025\u0064\u0020\u006eum\u004d\u0069\u0073\u0073\u0065\u0073\u003d%\u0064",_ecf ,_cced );
};_afa :=_ee .Join (_feea ,"");return _afa ,nil ;};type localSpanMarks struct{_fedf *_gd .TextMarkArray ;_eefce int ;_bca string ;};func _dec (_fdbe *_fd .ContentStreamOperations ,PdfObj _d .PdfObject )(*_fd .ContentStreamOperation ,int ,bool ){for _cecd ,_fcdc :=range *_fdbe {_adfd :=_fcdc .Operand ;
if _adfd =="\u0054\u006a"{_acdb :=_d .TraceToDirectObject (_fcdc .Params [0]);if _acdb ==PdfObj {return _fcdc ,_cecd ,true ;};}else if _adfd =="\u0054\u004a"{_abd ,_bdc :=_d .GetArray (_fcdc .Params [0]);if !_bdc {return nil ,_cecd ,_bdc ;};for _ ,_ecd :=range _abd .Elements (){if _ecd ==PdfObj {return _fcdc ,_cecd ,true ;
};};}else if _adfd =="\u0022"{_ddg :=_d .TraceToDirectObject (_fcdc .Params [2]);if _ddg ==PdfObj {return _fcdc ,_cecd ,true ;};}else if _adfd =="\u0027"{_gbeb :=_d .TraceToDirectObject (_fcdc .Params [0]);if _gbeb ==PdfObj {return _fcdc ,_cecd ,true ;
};};};return nil ,-1,false ;};func _cffb (_dcd *matchedIndex ,_gbeg [][]int )(bool ,[][]int ){_eefg :=[][]int {};for _ ,_agag :=range _gbeg {if _dcd ._acfd < _agag [0]&&_dcd ._gfcb > _agag [1]{_eefg =append (_eefg ,_agag );};};return len (_eefg )> 0,_eefg ;
};func _cbde (_bdfc *_gd .TextMarkArray )[]*_gd .TextMarkArray {_cbdf :=_bdfc .Elements ();_dcbb :=len (_cbdf );var _cac _d .PdfObject ;_aefe :=[]*_gd .TextMarkArray {};_cabb :=&_gd .TextMarkArray {};_gefd :=-1;for _aeg ,_ffbb :=range _cbdf {_aad :=_ffbb .DirectObject ;
_gefd =_ffbb .Index ;if _aad ==nil {_dbcb :=_dca (_bdfc ,_aeg ,_gefd );if _cac !=nil {if _dbcb ==-1||_dbcb > _aeg {_aefe =append (_aefe ,_cabb );_cabb =&_gd .TextMarkArray {};};};}else if _aad !=nil &&_cac ==nil {if _gefd ==0&&_aeg > 0{_aefe =append (_aefe ,_cabb );
_cabb =&_gd .TextMarkArray {};};}else if _aad !=nil &&_cac !=nil {if _aad !=_cac {_aefe =append (_aefe ,_cabb );_cabb =&_gd .TextMarkArray {};};};_cac =_aad ;_cabb .Append (_ffbb );if _aeg ==(_dcbb -1){_aefe =append (_aefe ,_cabb );};};return _aefe ;};
func _ggge (_beea int ,_ffb []int )bool {for _ ,_ecc :=range _ffb {if _ecc ==_beea {return true ;};};return false ;};func _eagf (_fdda *matchedIndex ,_feeg [][]int )[]*matchedIndex {_eebc :=[]*matchedIndex {};_cafe :=_fdda ._acfd ;_fgdf :=_cafe ;_gge :=_fdda ._aeb ;
_fafb :=0;for _ ,_aea :=range _feeg {_cacf :=_aea [0]-_cafe ;if _fafb >=_cacf {continue ;};_age :=_gge [_fafb :_cacf ];_fada :=&matchedIndex {_aeb :_age ,_acfd :_fgdf ,_gfcb :_aea [0]};if len (_ee .TrimSpace (_age ))!=0{_eebc =append (_eebc ,_fada );};
_fafb =_aea [1]-_cafe ;_fgdf =_cafe +_fafb ;};_aece :=_gge [_fafb :];_ffg :=&matchedIndex {_aeb :_aece ,_acfd :_fgdf ,_gfcb :_fdda ._gfcb };if len (_ee .TrimSpace (_aece ))!=0{_eebc =append (_eebc ,_ffg );};return _eebc ;};func _cfef (_def RedactionTerm )(*regexMatcher ,error ){return &regexMatcher {_cfbd :_def },nil };
type regexMatcher struct{_cfbd RedactionTerm };func _cf (_cb *_gd .TextMarkArray )int {_ddd :=0;_adf :=_cb .Elements ();if _adf [0].Text =="\u0020"{_ddd ++;};if _adf [_cb .Len ()-1].Text =="\u0020"{_ddd ++;};return _ddd ;};func _ffa (_aee []int ,_dfa *_gd .TextMarkArray ,_ege string )(*_gd .TextMarkArray ,matchedBBox ,error ){_cgf :=matchedBBox {};
_adfda :=_aee [0];_caed :=_aee [1];_dbcg :=len (_ege )-len (_ee .TrimLeft (_ege ,"\u0020"));_dedd :=len (_ege )-len (_ee .TrimRight (_ege ,"\u0020\u000a"));_adfda =_adfda +_dbcg ;_caed =_caed -_dedd ;_ege =_ee .Trim (_ege ,"\u0020\u000a");_ebbac ,_dfcc :=_dfa .RangeOffset (_adfda ,_caed );
if _dfcc !=nil {return nil ,_cgf ,_dfcc ;};_gae ,_fbfe :=_ebbac .BBox ();if !_fbfe {return nil ,_cgf ,_f .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_ebbac );
};_cgf =matchedBBox {_fddc :_ege ,_dgb :_gae };return _ebbac ,_cgf ,nil ;};func _gbg (_agd []localSpanMarks )(map[string ][]localSpanMarks ,[]string ){_adda :=make (map[string ][]localSpanMarks );_fee :=[]string {};for _ ,_fbd :=range _agd {_bgc :=_fbd ._bca ;
if _fbde ,_aca :=_adda [_bgc ];_aca {_adda [_bgc ]=append (_fbde ,_fbd );}else {_adda [_bgc ]=[]localSpanMarks {_fbd };_fee =append (_fee ,_bgc );};};return _adda ,_fee ;};func _gfc (_efeg *_gd .TextMarkArray )string {_cefd :="";for _ ,_cge :=range _efeg .Elements (){_cefd +=_cge .Text ;
};return _cefd ;};func _ebcd (_gade []*matchedIndex ,_gage [][]int )[]*matchedIndex {_efdg :=[]*matchedIndex {};for _ ,_eefe :=range _gade {_gedd ,_fcdf :=_cffb (_eefe ,_gage );if _gedd {_ddaa :=_eagf (_eefe ,_fcdf );_efdg =append (_efdg ,_ddaa ...);}else {_efdg =append (_efdg ,_eefe );
};};return _efdg ;};type targetMap struct{_bbfc string ;_ebba [][]int ;};type matchedBBox struct{_dgb _ff .PdfRectangle ;_fddc string ;};type placeHolders struct{_ef []int ;_bg string ;_ge float64 ;};func _fgc (_bbf *_ff .PdfFont ,_bde _gd .TextMark )float64 {_edd :=0.001;
_gfb :=_bde .Th /100;if _bbf .Subtype ()=="\u0054\u0079\u0070e\u0033"{_edd =1;};_gee ,_ebe :=_bbf .GetRuneMetrics (' ');if !_ebe {_gee ,_ebe =_bbf .GetCharMetrics (32);};if !_ebe {_gee ,_ =_ff .DefaultFont ().GetRuneMetrics (' ');};_cgge :=_edd *((_gee .Wx *_bde .FontSize +_bde .Tc +_bde .Tw )/_gfb );
return _cgge ;};func _ebg (_cffd ,_abff targetMap )(bool ,[]int ){_efg :=_ee .Contains (_cffd ._bbfc ,_abff ._bbfc );var _fecd []int ;for _ ,_ede :=range _cffd ._ebba {for _fgfa ,_gdc :=range _abff ._ebba {if _gdc [0]>=_ede [0]&&_gdc [1]<=_ede [1]{_fecd =append (_fecd ,_fgfa );
};};};return _efg ,_fecd ;};

// New instantiates a Redactor object with given PdfReader and `regex` pattern.
func New (reader *_ff .PdfReader ,opts *RedactionOptions ,rectProps *RectangleProps )*Redactor {if rectProps ==nil {rectProps =RedactRectanglePropsNew ();};return &Redactor {_ccd :reader ,_dge :opts ,_fdcb :_a .New (),_acg :rectProps };};func _afb (_fef localSpanMarks ,_cef *_gd .TextMarkArray ,_cbg *_ff .PdfFont ,_dbc ,_cff string )([]_d .PdfObject ,error ){_dfc :=_gfc (_cef );
Tj ,_cdee :=_ebbb (_cef );if _cdee !=nil {return nil ,_cdee ;};_ace :=len (_dbc );_cfb :=len (_dfc );_dfb :=-1;_bbfg :=_d .MakeFloat (Tj );if _dfc !=_cff {_ced :=_fef ._eefce ;if _ced ==0{_dfb =_ee .LastIndex (_dbc ,_dfc );}else {_dfb =_ee .Index (_dbc ,_dfc );
};}else {_dfb =_ee .Index (_dbc ,_dfc );};_ceab :=_dfb +_cfb ;_bfg :=[]_d .PdfObject {};if _dfb ==0&&_ceab ==_ace {_bfg =append (_bfg ,_bbfg );}else if _dfb ==0&&_ceab < _ace {_afe :=_dcg (_dbc [_ceab :],_cbg );_efd :=_d .MakeStringFromBytes (_afe );_bfg =append (_bfg ,_bbfg ,_efd );
}else if _dfb > 0&&_ceab >=_ace {_ded :=_dcg (_dbc [:_dfb ],_cbg );_eda :=_d .MakeStringFromBytes (_ded );_bfg =append (_bfg ,_eda ,_bbfg );}else if _dfb > 0&&_ceab < _ace {_aff :=_dcg (_dbc [:_dfb ],_cbg );_fae :=_dcg (_dbc [_ceab :],_cbg );_gaf :=_d .MakeStringFromBytes (_aff );
_efe :=_d .MakeString (string (_fae ));_bfg =append (_bfg ,_gaf ,_bbfg ,_efe );};return _bfg ,nil ;};