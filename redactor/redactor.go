//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package redactor ;import (_f "errors";_d "fmt";_ce "github.com/unidoc/unipdf/v4/common";_g "github.com/unidoc/unipdf/v4/contentstream";_da "github.com/unidoc/unipdf/v4/core";_df "github.com/unidoc/unipdf/v4/creator";_dc "github.com/unidoc/unipdf/v4/extractor";
_ea "github.com/unidoc/unipdf/v4/model";_fb "io";_ad "regexp";_e "slices";_fc "sort";_c "strings";);func _cef (_bd *_dc .TextMarkArray )(_da .PdfObject ,int ){var _cdc _da .PdfObject ;_gff :=-1;for _aac ,_ceb :=range _bd .Elements (){_cdc =_ceb .DirectObject ;
_gff =_aac ;if _cdc !=nil {break ;};};return _cdc ,_gff ;};type regexMatcher struct{_fdeae RedactionTerm };func _eaadd (_bfb string ,_gbd []replacement ,_ege *_ea .PdfFont )[]_da .PdfObject {_cfc :=[]_da .PdfObject {};_afg :=0;_ddb :=_bfb ;for _cae ,_eef :=range _gbd {_ddgd :=_eef ._gb ;
_agc :=_eef ._cd ;_ede :=_eef ._b ;_cab :=_da .MakeFloat (_agc );if _afg > _ddgd ||_ddgd ==-1{continue ;};_aabd :=_bfb [_afg :_ddgd ];_aba :=_aef (_aabd ,_ege );_dec :=_da .MakeStringFromBytes (_aba );_cfc =append (_cfc ,_dec );_cfc =append (_cfc ,_cab );
_gfa :=_ddgd +len (_ede );_ddb =_bfb [_gfa :];_afg =_gfa ;if _cae ==len (_gbd )-1{_aba =_aef (_ddb ,_ege );_dec =_da .MakeStringFromBytes (_aba );_cfc =append (_cfc ,_dec );};};return _cfc ;};func _gf (_acc *_dc .TextMarkArray )int {_ceg :=0;_eaa :=_acc .Elements ();
if _eaa [0].Text =="\u0020"{_ceg ++;};if _eaa [_acc .Len ()-1].Text =="\u0020"{_ceg ++;};return _ceg ;};

// Write writes the content of `re.creator` to writer of type io.Writer interface.
func (_bbe *Redactor )Write (writer _fb .Writer )error {return _bbe ._cgbd .Write (writer )};func _gef (_aaee ,_aaf ,_cdac float64 )float64 {_cdac =_cdac /100;_gfd :=(-1000*_aaee )/(_aaf *_cdac );return _gfd ;};func _bgf (_bbec *matchedIndex ,_aaac [][]int )(bool ,[][]int ){_fecgb :=[][]int {};
for _ ,_afee :=range _aaac {if _bbec ._dfb < _afee [0]&&_bbec ._bee > _afee [1]{_fecgb =append (_fecgb ,_afee );};};return len (_fecgb )> 0,_fecgb ;};type targetMap struct{_adc string ;_gge [][]int ;};

// New instantiates a Redactor object with given PdfReader and `regex` pattern.
func New (reader *_ea .PdfReader ,opts *RedactionOptions ,rectProps *RectangleProps )*Redactor {if rectProps ==nil {rectProps =RedactRectanglePropsNew ();};return &Redactor {_fbab :reader ,_cabg :opts ,_cgbd :_df .New (),_bge :rectProps };};func _edf (_gda []placeHolders )[]replacement {_ccb :=[]replacement {};
for _ ,_gceg :=range _gda {_eae :=_gceg ._aa ;_bab :=_gceg ._eg ;_gced :=_gceg ._dd ;for _ ,_abe :=range _eae {_bgd :=replacement {_b :_bab ,_cd :_gced ,_gb :_abe };_ccb =append (_ccb ,_bgd );};};_fc .Slice (_ccb ,func (_fdedd ,_dbfb int )bool {return _ccb [_fdedd ]._gb < _ccb [_dbfb ]._gb });
return _ccb ;};

// Redactor represents a Redactor object.
type Redactor struct{_fbab *_ea .PdfReader ;_cabg *RedactionOptions ;_cgbd *_df .Creator ;_bge *RectangleProps ;_cgf []RedactionTerm ;};

// WriteToFile writes the redacted document to file specified by `outputPath`.
func (_dfdb *Redactor )WriteToFile (outputPath string )error {if _bff :=_dfdb ._cgbd .WriteToFile (outputPath );_bff !=nil {return _d .Errorf ("\u0066\u0061\u0069l\u0065\u0064\u0020\u0074o\u0020\u0077\u0072\u0069\u0074\u0065\u0020t\u0068\u0065\u0020\u006f\u0075\u0074\u0070\u0075\u0074\u0020\u0066\u0069\u006c\u0065");
};return nil ;};type matchedBBox struct{_eaga _ea .PdfRectangle ;_fbge string ;};func _aeaea (_gdcb []*matchedIndex ,_ddf [][]int )[]*matchedIndex {_ceed :=[]*matchedIndex {};for _ ,_fedd :=range _gdcb {_febb ,_bcbf :=_bgf (_fedd ,_ddf );if _febb {_geadb :=_cgbc (_fedd ,_bcbf );
_ceed =append (_ceed ,_geadb ...);}else {_ceed =append (_ceed ,_fedd );};};return _ceed ;};func _gec (_ddc *_dc .TextMarkArray )(float64 ,error ){_ggg ,_ffc :=_ddc .BBox ();if !_ffc {return 0.0,_d .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_ddc );
};_edff :=_gf (_ddc );_bag :=0.0;_ ,_fcb :=_cef (_ddc );_fcbd :=_ddc .Elements ()[_fcb ];_egc :=_fcbd .Font ;if _edff > 0{_bag =_ef (_egc ,_fcbd );};_bebd :=(_ggg .Urx -_ggg .Llx );_bebd =_bebd +_bag *float64 (_edff );Tj :=_gef (_bebd ,_fcbd .FontSize ,_fcbd .Th );
return Tj ,nil ;};func _gbggf (_gbeg *_g .ContentStreamOperations ,PdfObj _da .PdfObject )(*_g .ContentStreamOperation ,int ,bool ){for _fbba ,_fab :=range *_gbeg {_ffca :=_fab .Operand ;if _ffca =="\u0054\u006a"{_eea :=_da .TraceToDirectObject (_fab .Params [0]);
if _eea ==PdfObj {return _fab ,_fbba ,true ;};}else if _ffca =="\u0054\u004a"{_edb ,_ggd :=_da .GetArray (_fab .Params [0]);if !_ggd {return nil ,_fbba ,_ggd ;};for _ ,_ged :=range _edb .Elements (){if _ged ==PdfObj {return _fab ,_fbba ,true ;};};}else if _ffca =="\u0022"{_eeac :=_da .TraceToDirectObject (_fab .Params [2]);
if _eeac ==PdfObj {return _fab ,_fbba ,true ;};}else if _ffca =="\u0027"{_eagf :=_da .TraceToDirectObject (_fab .Params [0]);if _eagf ==PdfObj {return _fab ,_fbba ,true ;};};};return nil ,-1,false ;};const (RegexSSN ="\u0028?\u0069\u0029\u005c\u0062\\\u0064\u007b\u0033\u007d\u002d\\\u0064{\u0032}\u002d\u005c\u0064\u007b\u0034\u007d\u005cb";
RegexCreditCard ="\u005c\u0062\u0028?:\u005c\u0064\u005b\u0020\u002d\u005d\u002a\u003f\u0029\u007b\u0031\u0033\u002c\u0031\u0036\u007d\u005c\u0062";RegexEmail ="\u005c\u0062\u005b\u0041\u002d\u005a\u0061\u002d\u007a\u0030\u002d\u0039\u002e\u005f\u0025\u002b\u002d\u005d+\u0040\u005b\u0041\u002d\u005a\u0061\u002dz\u0030\u002d\u0039\u002e\u002d\u005d\u002b\u005c\u002e\u005b\u0041-\u005a\u0061\u002d\u007a\u005d\u007b\u0032\u002c\u007d\u005c\u0062";
RegexPhone ="\u0028\u003f\u003a\u005c\u002b\u0031\u005b\u002d\u002e\u005c\u0073\u005d\u003f\u0029\u003f\u005c\u0028\u003f\\\u0064\u007b\u0033\u007d\u005c\u0029\u003f[\u002d\u002e\u005c\u0073\u005d\u003f\u005c\u0064\u007b\u0033\u007d[\u002d\u002e\u005c\u0073\u005d\u003f\u005c\u0064\u007b\u0034\u007d";
RegexIPv4 ="\u005c\u0062\u0028\u003f\u003a\u0028\u003f\u003a\u0032\u0035\u005b\u0030\u002d5\u005d\u007c\u0032\u005b\u0030\u002d\u0034\u005d\u005cd\u007c\u0031\u005c\u0064\u007b\u0032\u007d\u007c\u005b\u0031\u002d\u0039\u005d\u003f\\\u0064\u0029\u005c\u002e\u0029\u007b\u0033\u007d\u0028\u003f\u003a\u0032\u0035\u005b\u0030\u002d\u0035\u005d\u007c\u0032\u005b\u0030\u002d\u0034\u005d\u005c\u0064\u007c\u0031\u005cd\u007b\u0032\u007d\u007c\u005b\u0031\u002d\u0039\u005d?\u005c\u0064)\u005c\u0062";
RegexIPv6 ="\u005c\u0062\u0028[\u0030\u002d\u0039\u0061\u002d\u0066\u0041\u002d\u0046\u005d\u007b\u0031\u002c\u0034\u007d\u003a\u0029\u007b\u0037\u007d\u005b\u0030\u002d\u0039\u0061\u002d\u0066\u0041\u002dF\u005d\u007b\u0031\u002c\u0034\u007d\u005c\u0062";
RegexPassport ="\u005c\u0062\u005b\u0041\u002d\u005a\u0030\u002d\u0039\u005d\u007b\u0036,\u0039\u007d\u005c\u0062";RegexDriversLicense ="\u005cb\u005bA\u002d\u005a\u0030\u002d\u0039]\u007b\u0035,\u0031\u0035\u007d\u005c\u0062";RegexDate ="\u005cb\u0028\u003f\u003a\u005c\u0064\u007b\u0031,2\u007d\u005b\u002f\u002e\u002d\u005d\u005c\u0064\u007b\u0031\u002c\u0032\u007d\u005b/\u002e\u002d]\u005c\u0064\u007b2\u002c\u0034\u007d\u007c\u005c\u0064\u007b\u0034\u007d\u005b\u002d\u002f\u005d\u005c\u0064\u007b2\u007d\u005b-/\u005d\u005c\u0064{\u0032\u007d\u0029\u005c\u0062";
RegexPostalCode ="\\\u0062\\\u0064\u007b\u0035\u007d\u0028\u003f\u003a\u002d\\\u0064\u007b\u0034\u007d)?\u005c\u0062";RegexMAC ="\u005c\u0062\u0028\u003f\u003a\u005b\u0030-\u0039\u0041\u002dF\u0061\u002d\u0066\u005d{\u0032\u007d\u005b\u003a\u002d\u005d\u0029\u007b\u0035\u007d\u005b\u0030\u002d\u0039\u0041\u002d\u0046\u0061\u002d\u0066\u005d\u007b\u0032\u007d\u005c\u0062";
RegexBankRouting ="\u005cb\u005c\u0064\u007b\u0039\u007d\u005cb";RegexIBAN ="\u005c\u0062\u005b\u0041\u002d\u005a\u005d\u007b\u0032\u007d\u005c\u0064\u007b\u0032\u007d[\u0041-\u005a\u0030\u002d\u0039\u005d\u007b\u0031\u0031\u002c\u0033\u0030\u007d\u005c\u0062";
RegexAWSAccessKeyID ="\\\u0062A\u004b\u0049\u0041\u005b\u0030\u002d\u0039\u0041-\u005a\u005d\u007b\u00316}\u005c\u0062";RegexAWSSecretAccessKey ="\\\u0062\u005b\u0030\u002d9a\u002dz\u0041\u002d\u005a\u002f\u002b]\u007b\u0034\u0030\u007d\u005c\u0062";RegexGoogleAPIKey ="\u005c\u0062\u0041\u0049\u007a\u0061\u005b\u0030\u002d\u0039\u0041-\u005a\u0061\u002d\u007a\u005c\u002d\u005f\u005d\u007b\u00335\u007d\u005c\u0062";
RegexJWT ="\\b\u0065\u0079J\u005b\u0041\u002d\u005a\u0061\u002d\u007a\u0030\u002d9\u005f\u005c\u002d\u005d\u002b\u005c\u002e\u0065\u0079\u004a\u005b\u0041\u002d\u005a\u0061\u002d\u007a\u0030\u002d\u0039\u005f\u005c\u002d\u005d\u002b\u005c\u002e\u003f[\u0041-\u005a\u0061\u002d\u007a\u0030\u002d\u0039\u005f\\\u002d]\u002a\u005cb";
RegexCardExpirationDate ="\\\u0062\u0028\u0030\u005b\u0031\u002d9\u005d\u007c\u0031\u005b\u0030\u002d2\u005d\u0029\u002f\u0028\u003f\u003a\u005cd\u007b\u0032\u007d\u007c\u005c\u0064\u007b\u0034\u007d\u0029\\\u0062";RegexSWIFTCode ="\u005cb\u005b\u0041-\u005a\u005d\u007b4\u007d\u005b\u0041\u002d\u005a\u005d\u007b2\u007d\u005b\u0041\u002d\u005a\u0030-\u0039\u005d\u007b\u0032\u007d\u0028\u005b\u0041\u002d\u005a\u0030-\u0039\u005d\u007b\u0033\u007d\u0029\u003f\u005c\u0062";
RegexStripeAPIKey ="\u0073\u006b\u005fli\u0076\u0065\u005f\u005b\u0030\u002d\u0039\u0061\u002d\u007a\u0041\u002d\u005a\u005d\u007b\u0032\u0034\u007d";);type localSpanMarks struct{_gbb *_dc .TextMarkArray ;_fgd int ;_feg string ;};

// RedactionTerm holds the regexp pattern and the replacement string for the redaction process.
type RedactionTerm struct{Pattern *_ad .Regexp ;};func _cgbc (_gbff *matchedIndex ,_aefbb [][]int )[]*matchedIndex {_ffa :=[]*matchedIndex {};_bddef :=_gbff ._dfb ;_bfec :=_bddef ;_fccb :=_gbff ._dcea ;_eagg :=0;for _ ,_eacg :=range _aefbb {_debd :=_eacg [0]-_bddef ;
if _eagg >=_debd {continue ;};_bce :=_fccb [_eagg :_debd ];_abge :=&matchedIndex {_dcea :_bce ,_dfb :_bfec ,_bee :_eacg [0]};if len (_c .TrimSpace (_bce ))!=0{_ffa =append (_ffa ,_abge );};_eagg =_eacg [1]-_bddef ;_bfec =_bddef +_eagg ;};_gfba :=_fccb [_eagg :];
_fafg :=&matchedIndex {_dcea :_gfba ,_dfb :_bfec ,_bee :_gbff ._bee };if len (_c .TrimSpace (_gfba ))!=0{_ffa =append (_ffa ,_fafg );};return _ffa ;};func _gba (_fdfg string )(string ,[][]int ){_geg :=_ad .MustCompile ("\u005c\u006e");_badb :=_geg .FindAllStringIndex (_fdfg ,-1);
_fbgb :=_geg .ReplaceAllString (_fdfg ,"\u0020");return _fbgb ,_badb ;};func _aceb (_fecg *_dc .TextMarkArray ,_bead int )int {_cbad :=_fecg .Elements ();_eebba :=_bead -1;_dfce :=_bead +1;_bedf :=-1;if _eebba >=0{_fcdcf :=_cbad [_eebba ];_fbbe :=_fcdcf .ObjString ;
_efe :=len (_fbbe );_fccg :=_fcdcf .Index ;if _fccg +1< _efe {_bedf =_eebba ;return _bedf ;};};if _dfce < len (_cbad ){_ggc :=_cbad [_dfce ];_eed :=_ggc .ObjString ;if _eed [0]!=_ggc .Text {_bedf =_dfce ;return _bedf ;};};return _bedf ;};func _aef (_bfd string ,_fded *_ea .PdfFont )[]byte {_def ,_fga :=_fded .StringToCharcodeBytes (_bfd );
if _fga !=0{_ce .Log .Debug ("\u0057\u0041\u0052\u004e\u003a\u0020\u0073\u006fm\u0065\u0020\u0072un\u0065\u0073\u0020\u0063\u006f\u0075l\u0064\u0020\u006e\u006f\u0074\u0020\u0062\u0065\u0020\u0065\u006e\u0063\u006f\u0064\u0065d\u002e\u000a\u0009\u0025\u0073\u0020\u002d\u003e \u0025\u0076",_bfd ,_def );
};return _def ;};func _fd (_be *_g .ContentStreamOperations ,_dfg map[_da .PdfObject ][]localSpanMarks )error {for _aab ,_bb :=range _dfg {if _aab ==nil {continue ;};_ec ,_gc ,_gd :=_gbggf (_be ,_aab );if !_gd {_ce .Log .Debug ("Pd\u0066\u004fb\u006a\u0065\u0063\u0074\u0020\u0025\u0073\u006e\u006ft\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0069\u006e\u0020\u0073\u0069\u0064\u0065\u0020\u0074\u0068\u0065\u0020\u0063\u006f\u006e\u0074\u0065\u006e\u0074\u0073\u0074r\u0065a\u006d\u0020\u006f\u0070\u0065\u0072\u0061\u0074i\u006fn\u0020\u0025s",_aab ,_be );
return nil ;};if _ec .Operand =="\u0054\u006a"{_cb :=_bdg (_ec ,_aab ,_bb );if _cb !=nil {return _cb ;};}else if _ec .Operand =="\u0054\u004a"{_ed :=_fgg (_ec ,_aab ,_bb );if _ed !=nil {return _ed ;};}else if _ec .Operand =="\u0027"||_ec .Operand =="\u0022"{_ac :=_fg (_be ,_ec .Operand ,_gc );
if _ac !=nil {return _ac ;};_ac =_bdg (_ec ,_aab ,_bb );if _ac !=nil {return _ac ;};};};return nil ;};func _gcc (_eff localSpanMarks ,_cfg *_dc .TextMarkArray ,_ffg *_ea .PdfFont ,_cfd ,_dbg string )([]_da .PdfObject ,error ){_dbf :=_abde (_cfg );Tj ,_ggf :=_gec (_cfg );
if _ggf !=nil {return nil ,_ggf ;};_eaab :=len (_cfd );_feb :=len (_dbf );_beb :=-1;_ggaf :=_da .MakeFloat (Tj );if _dbf !=_dbg {_fac :=_eff ._fgd ;if _fac ==0{_beb =_c .LastIndex (_cfd ,_dbf );}else {_beb =_c .Index (_cfd ,_dbf );};}else {_beb =_c .Index (_cfd ,_dbf );
};_bddf :=_beb +_feb ;_baf :=[]_da .PdfObject {};if _beb ==0&&_bddf ==_eaab {_baf =append (_baf ,_ggaf );}else if _beb ==0&&_bddf < _eaab {_dge :=_aef (_cfd [_bddf :],_ffg );_dcd :=_da .MakeStringFromBytes (_dge );_baf =append (_baf ,_ggaf ,_dcd );}else if _beb > 0&&_bddf >=_eaab {_dfcb :=_aef (_cfd [:_beb ],_ffg );
_ecb :=_da .MakeStringFromBytes (_dfcb );_baf =append (_baf ,_ecb ,_ggaf );}else if _beb > 0&&_bddf < _eaab {_cca :=_aef (_cfd [:_beb ],_ffg );_eebc :=_aef (_cfd [_bddf :],_ffg );_gffg :=_da .MakeStringFromBytes (_cca );_bba :=_da .MakeString (string (_eebc ));
_baf =append (_baf ,_gffg ,_ggaf ,_bba );};return _baf ,nil ;};func _fffd (_fge *_dc .TextMarkArray )[]*_dc .TextMarkArray {_fcff :=_fge .Elements ();_ebfc :=len (_fcff );var _ggad _da .PdfObject ;_fed :=[]*_dc .TextMarkArray {};_dfe :=&_dc .TextMarkArray {};
_agb :=-1;for _dcg ,_adf :=range _fcff {_aace :=_adf .DirectObject ;_agb =_adf .Index ;if _aace ==nil {_abf :=_aceb (_fge ,_dcg );if _ggad !=nil {if _abf ==-1||_abf > _dcg {_fed =append (_fed ,_dfe );_dfe =&_dc .TextMarkArray {};};};}else if _ggad ==nil {if _agb ==0&&_dcg > 0{_fed =append (_fed ,_dfe );
_dfe =&_dc .TextMarkArray {};};}else {if _aace !=_ggad {_fed =append (_fed ,_dfe );_dfe =&_dc .TextMarkArray {};};};_ggad =_aace ;_dfe .Append (_adf );if _dcg ==(_ebfc -1){_fed =append (_fed ,_dfe );};};return _fed ;};func _ef (_bcc *_ea .PdfFont ,_aae _dc .TextMark )float64 {_gcf :=0.001;
_gbg :=_aae .Th /100;if _bcc .Subtype ()=="\u0054\u0079\u0070e\u0033"{_gcf =1;};_accc ,_ag :=_bcc .GetRuneMetrics (' ');if !_ag {_accc ,_ag =_bcc .GetCharMetrics (32);};if !_ag {_accc ,_ =_ea .DefaultFont ().GetRuneMetrics (' ');};_adb :=_gcf *((_accc .Wx *_aae .FontSize +_aae .Tc +_aae .Tw )/_gbg );
return _adb ;};type matchedIndex struct{_dfb int ;_bee int ;_dcea string ;};func _abde (_dgb *_dc .TextMarkArray )string {_ffgg :="";for _ ,_bdgf :=range _dgb .Elements (){_ffgg +=_bdgf .Text ;};return _ffgg ;};

// RedactRectanglePropsNew return a new pointer to a default RectangleProps object.
func RedactRectanglePropsNew ()*RectangleProps {return &RectangleProps {FillColor :_df .ColorBlack ,BorderWidth :0.0,FillOpacity :1.0};};func _fgg (_bf *_g .ContentStreamOperation ,_eaad _da .PdfObject ,_bfa []localSpanMarks )error {_cdf ,_fbe :=_da .GetArray (_bf .Params [0]);
_eag :=[]_da .PdfObject {};if !_fbe {_ce .Log .Debug ("\u0045\u0052\u0052OR\u003a\u0020\u0054\u004a\u0020\u006f\u0070\u003d\u0025s\u0020G\u0065t\u0041r\u0072\u0061\u0079\u0056\u0061\u006c\u0020\u0066\u0061\u0069\u006c\u0065\u0064",_bf );return _d .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_bf );
};_dfge ,_bc :=_efc (_bfa );if len (_bc )==1{_cc :=_bc [0];_fe :=_dfge [_cc ];if len (_fe )==1{_gdf :=_fe [0];_ga :=_gdf ._gbb ;_bdd :=_gga (_ga );_cg ,_ee :=_aeaf (_eaad ,_bdd );if _ee !=nil {return _ee ;};_eca ,_ee :=_gcc (_gdf ,_ga ,_bdd ,_cg ,_cc );
if _ee !=nil {return _ee ;};for _ ,_ade :=range _cdf .Elements (){if _ade ==_eaad {_eag =append (_eag ,_eca ...);}else {_eag =append (_eag ,_ade );};};}else {_daf :=_fe [0]._gbb ;_fee :=_gga (_daf );_ab ,_fde :=_aeaf (_eaad ,_fee );if _fde !=nil {return _fde ;
};_afa ,_fde :=_efd (_ab ,_fe );if _fde !=nil {return _fde ;};_ge :=_edf (_afa );_dg :=_eaadd (_ab ,_ge ,_fee );for _ ,_edc :=range _cdf .Elements (){if _edc ==_eaad {_eag =append (_eag ,_dg ...);}else {_eag =append (_eag ,_edc );};};};_bf .Params [0]=_da .MakeArray (_eag ...);
}else if len (_bc )> 1{_ega :=_bfa [0];_ae :=_ega ._gbb ;_ ,_cda :=_cef (_ae );_eadg :=_ae .Elements ()[_cda ];_gg :=_eadg .Font ;_eeb ,_ebe :=_aeaf (_eaad ,_gg );if _ebe !=nil {return _ebe ;};_cf ,_ebe :=_efd (_eeb ,_bfa );if _ebe !=nil {return _ebe ;
};_de :=_edf (_cf );_gdba :=_eaadd (_eeb ,_de ,_gg );for _ ,_cegc :=range _cdf .Elements (){if _cegc ==_eaad {_eag =append (_eag ,_gdba ...);}else {_eag =append (_eag ,_cegc );};};_bf .Params [0]=_da .MakeArray (_eag ...);};return nil ;};type replacement struct{_b string ;
_cd float64 ;_gb int ;};func _gga (_ece *_dc .TextMarkArray )*_ea .PdfFont {_ ,_gbe :=_cef (_ece );_cgd :=_ece .Elements ()[_gbe ];_cfa :=_cgd .Font ;return _cfa ;};func (_bfeg *regexMatcher )match (_febg string )([]*matchedIndex ,error ){_gdcg :=_bfeg ._fdeae .Pattern ;
if _gdcg ==nil {return nil ,_f .New ("\u006e\u006f\u0020\u0070at\u0074\u0065\u0072\u006e\u0020\u0063\u006f\u006d\u0070\u0069\u006c\u0065\u0064");};var (_afb =_gdcg .FindAllStringIndex (_febg ,-1);_cbcc []*matchedIndex ;);for _ ,_dbe :=range _afb {_cbcc =append (_cbcc ,&matchedIndex {_dfb :_dbe [0],_bee :_dbe [1],_dcea :_febg [_dbe [0]:_dbe [1]]});
};return _cbcc ,nil ;};func (_dada *Redactor )redactPage (_ddbe *_g .ContentStreamOperations ,_abc *_ea .PdfPageResources )([]matchedBBox ,*_g .ContentStreamOperations ,error ){_eebe ,_gefb :=_dc .NewFromContents (_ddbe .String (),_abc );if _gefb !=nil {return nil ,nil ,_gefb ;
};_afe ,_ ,_ ,_gefb :=_eebe .ExtractPageText ();if _gefb !=nil {return nil ,nil ,_gefb ;};_ddbe =_afe .GetContentStreamOps ();_bdb :=_afe .Marks ();_dafb :=_afe .Text ();_dafb ,_fcdc :=_gba (_dafb );_bcg :=[]matchedBBox {};_feeg :=make (map[_da .PdfObject ][]localSpanMarks );
_aee :=[]*targetMap {};_bagg :=_dada ._cabg .Terms ;if _dada ._cabg .UseStandardPatterns {_bagg =append (_bagg ,_dada ._cgf ...);};for _ ,_cba :=range _bagg {_baae ,_aafb :=_fegb (_cba );if _aafb !=nil {return nil ,nil ,_aafb ;};_afd ,_aafb :=_baae .match (_dafb );
if _aafb !=nil {return nil ,nil ,_aafb ;};_afd =_aeaea (_afd ,_fcdc );_acaf :=_bfaf (_afd );_aee =append (_aee ,_acaf ...);};_egb (_aee );for _ ,_gfb :=range _aee {_bdf :=_gfb ._adc ;_egd :=_gfb ._gge ;_fdd :=[]matchedBBox {};for _ ,_cea :=range _egd {_beda ,_dadd ,_deg :=_aefe (_cea ,_bdb ,_bdf );
if _deg !=nil {return nil ,nil ,_deg ;};_bbad :=_fffd (_beda );for _ebb ,_ace :=range _bbad {_cdfc :=localSpanMarks {_gbb :_ace ,_fgd :_ebb ,_feg :_bdf };_bedc ,_ :=_cef (_ace );if _eece ,_dgeg :=_feeg [_bedc ];_dgeg {_feeg [_bedc ]=append (_eece ,_cdfc );
}else {_feeg [_bedc ]=[]localSpanMarks {_cdfc };};};_fdd =append (_fdd ,_dadd );};_bcg =append (_bcg ,_fdd ...);};_gefb =_fd (_ddbe ,_feeg );if _gefb !=nil {return nil ,nil ,_gefb ;};return _bcg ,_ddbe ,nil ;};func _baa (_gbfc ,_fbea string )[]int {if len (_fbea )==0{return nil ;
};var _dbb []int ;for _cabc :=0;_cabc < len (_gbfc );{_bddd :=_c .Index (_gbfc [_cabc :],_fbea );if _bddd < 0{return _dbb ;};_dbb =append (_dbb ,_cabc +_bddd );_cabc +=_bddd +len (_fbea );};return _dbb ;};

// RedactionOptions is a collection of RedactionTerm objects.
type RedactionOptions struct{Terms []RedactionTerm ;UseStandardPatterns bool ;};func _aeaf (_egf _da .PdfObject ,_ggga *_ea .PdfFont )(string ,error ){_febe ,_bbaf :=_da .GetStringBytes (_egf );if !_bbaf {return "",_da .ErrTypeError ;};_bagc :=_ggga .BytesToCharcodes (_febe );
_ggfc ,_ffgb ,_gdc :=_ggga .CharcodesToStrings (_bagc ,"");if _gdc > 0{_ce .Log .Debug ("\u0072\u0065nd\u0065\u0072\u0054e\u0078\u0074\u003a\u0020num\u0043ha\u0072\u0073\u003d\u0025\u0064\u0020\u006eum\u004d\u0069\u0073\u0073\u0065\u0073\u003d%\u0064",_ffgb ,_gdc );
};_cdg :=_c .Join (_ggfc ,"");return _cdg ,nil ;};func _bdg (_ca *_g .ContentStreamOperation ,_db _da .PdfObject ,_aaa []localSpanMarks )error {var _bbd *_da .PdfObjectArray ;_fdb ,_aea :=_efc (_aaa );if len (_aea )==1{_gea :=_aea [0];_dad :=_fdb [_gea ];
if len (_dad )==1{_gcfbg :=_dad [0];_aabf :=_gcfbg ._gbb ;_cde :=_gga (_aabf );_fec ,_gbf :=_aeaf (_db ,_cde );if _gbf !=nil {return _gbf ;};_geag ,_gbf :=_gcc (_gcfbg ,_aabf ,_cde ,_fec ,_gea );if _gbf !=nil {return _gbf ;};_bbd =_da .MakeArray (_geag ...);
}else {_cbb :=_dad [0]._gbb ;_geb :=_gga (_cbb );_gaa ,_eebb :=_aeaf (_db ,_geb );if _eebb !=nil {return _eebb ;};_adg ,_eebb :=_efd (_gaa ,_dad );if _eebb !=nil {return _eebb ;};_aefb :=_edf (_adg );_dga :=_eaadd (_gaa ,_aefb ,_geb );_bbd =_da .MakeArray (_dga ...);
};}else if len (_aea )> 1{_aagc :=_aaa [0];_abd :=_aagc ._gbb ;_ ,_gde :=_cef (_abd );_cee :=_abd .Elements ()[_gde ];_gab :=_cee .Font ;_cbc ,_gfe :=_aeaf (_db ,_gab );if _gfe !=nil {return _gfe ;};_acd ,_gfe :=_efd (_cbc ,_aaa );if _gfe !=nil {return _gfe ;
};_eec :=_edf (_acd );_ff :=_eaadd (_cbc ,_eec ,_gab );_bbd =_da .MakeArray (_ff ...);};_ca .Params [0]=_bbd ;_ca .Operand ="\u0054\u004a";return nil ;};func _efd (_fdf string ,_dcf []localSpanMarks )([]placeHolders ,error ){_cdee :="";_dee :=[]placeHolders {};
for _agd ,_gbgg :=range _dcf {_beg :=_gbgg ._gbb ;_faa :=_gbgg ._feg ;_aec :=_abde (_beg );_dfgb ,_gbea :=_gec (_beg );if _gbea !=nil {return nil ,_gbea ;};if _aec !=_cdee {var _bec []int ;if _agd ==0&&_faa !=_aec {_gdd :=_c .Index (_fdf ,_aec );_bec =[]int {_gdd };
}else if _agd ==len (_dcf )-1{_bg :=_c .LastIndex (_fdf ,_aec );_bec =[]int {_bg };}else {_bec =_baa (_fdf ,_aec );};_bea :=placeHolders {_aa :_bec ,_eg :_aec ,_dd :_dfgb };_dee =append (_dee ,_bea );};_cdee =_aec ;};return _dee ,nil ;};

// RectangleProps defines properties of the redaction rectangle to be drawn.
type RectangleProps struct{FillColor _df .Color ;BorderWidth float64 ;FillOpacity float64 ;};func _aefe (_aefeg []int ,_deb *_dc .TextMarkArray ,_fff string )(*_dc .TextMarkArray ,matchedBBox ,error ){_abg :=matchedBBox {};_ada :=_aefeg [0];_bca :=_aefeg [1];
_fdc :=len (_fff )-len (_c .TrimLeft (_fff ,"\u0020"));_eaaga :=len (_fff )-len (_c .TrimRight (_fff ,"\u0020\u000a"));_ada =_ada +_fdc ;_bca =_bca -_eaaga ;_fff =_c .Trim (_fff ,"\u0020\u000a");_ebbc ,_egdb :=_deb .RangeOffset (_ada ,_bca );if _egdb !=nil {return nil ,_abg ,_egdb ;
};_cbca ,_gcedd :=_ebbc .BBox ();if !_gcedd {return nil ,_abg ,_d .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_ebbc );
};_abg =matchedBBox {_fbge :_fff ,_eaga :_cbca };return _ebbc ,_abg ,nil ;};func _efc (_eagd []localSpanMarks )(map[string ][]localSpanMarks ,[]string ){_gcfb :=make (map[string ][]localSpanMarks );_cgb :=[]string {};for _ ,_bfe :=range _eagd {_aca :=_bfe ._feg ;
if _fcd ,_ba :=_gcfb [_aca ];_ba {_gcfb [_aca ]=append (_fcd ,_bfe );}else {_gcfb [_aca ]=[]localSpanMarks {_bfe };_cgb =append (_cgb ,_aca );};};return _gcfb ,_cgb ;};func _egb (_bcb []*targetMap ){for _bda ,_cdgg :=range _bcb {for _age ,_afgb :=range _bcb {if _bda !=_age {_cfb ,_bdc :=_fad (*_cdgg ,*_afgb );
if _cfb {_cegb (_afgb ,_bdc );};};};};};func _fg (_dde *_g .ContentStreamOperations ,_aag string ,_fba int )error {_ecc :=_g .ContentStreamOperations {};var _ead _g .ContentStreamOperation ;for _gdb ,_dfd :=range *_dde {if _gdb ==_fba {if _aag =="\u0027"{_eb :=_g .ContentStreamOperation {Operand :"\u0054\u002a"};
_ecc =append (_ecc ,&_eb );_ead .Params =_dfd .Params ;_ead .Operand ="\u0054\u006a";_ecc =append (_ecc ,&_ead );}else if _aag =="\u0022"{_dce :=_dfd .Params [:2];Tc ,Tw :=_dce [0],_dce [1];_eac :=_g .ContentStreamOperation {Params :[]_da .PdfObject {Tc },Operand :"\u0054\u0063"};
_ecc =append (_ecc ,&_eac );_eac =_g .ContentStreamOperation {Params :[]_da .PdfObject {Tw },Operand :"\u0054\u0077"};_ecc =append (_ecc ,&_eac );_ead .Params =[]_da .PdfObject {_dfd .Params [2]};_ead .Operand ="\u0054\u006a";_ecc =append (_ecc ,&_ead );
};};_ecc =append (_ecc ,_dfd );};*_dde =_ecc ;return nil ;};func _bfaf (_faf []*matchedIndex )[]*targetMap {_ccbb :=make (map[string ][][]int );_cdd :=[]*targetMap {};for _ ,_cbd :=range _faf {_eab :=_cbd ._dcea ;_fdba :=[]int {_cbd ._dfb ,_cbd ._bee };
if _bae ,_accfd :=_ccbb [_eab ];_accfd {_ccbb [_eab ]=append (_bae ,_fdba );}else {_ccbb [_eab ]=[][]int {_fdba };};};for _eecef ,_aefg :=range _ccbb {_fbf :=&targetMap {_adc :_eecef ,_gge :_aefg };_cdd =append (_cdd ,_fbf );};return _cdd ;};func _fegb (_ggfg RedactionTerm )(*regexMatcher ,error ){return &regexMatcher {_fdeae :_ggfg },nil };


// Redact executes the redact operation on a pdf file and updates the content streams of all pages of the file.
func (_bed *Redactor )Redact ()error {_fbd ,_fcc :=_bed ._fbab .GetNumPages ();if _fcc !=nil {return _d .Errorf ("\u0066\u0061\u0069\u006c\u0065\u0064 \u0074\u006f\u0020\u0067\u0065\u0074\u0020\u0074\u0068\u0065\u0020\u006e\u0075m\u0062\u0065\u0072\u0020\u006f\u0066\u0020P\u0061\u0067\u0065\u0073");
};if _bed ._cabg .UseStandardPatterns {for _ ,_aed :=range StandardRegexPatterns {_aad ,_ffgc :=_ad .Compile (_aed );if _ffgc !=nil {return _ffgc ;};_bed ._cgf =append (_bed ._cgf ,RedactionTerm {Pattern :_aad });};};_fdea :=_bed ._bge .FillColor ;_abee :=_bed ._bge .BorderWidth ;
_dgc :=_bed ._bge .FillOpacity ;for _bbf :=1;_bbf <=_fbd ;_bbf ++{_gaba ,_bfag :=_bed ._fbab .GetPage (_bbf );if _bfag !=nil {return _bfag ;};_bef ,_bfag :=_dc .New (_gaba );if _bfag !=nil {return _bfag ;};_dbca ,_ ,_ ,_bfag :=_bef .ExtractPageText ();
if _bfag !=nil {return _bfag ;};_bagf :=_dbca .GetContentStreamOps ();_ggaa ,_bcf ,_bfag :=_bed .redactPage (_bagf ,_gaba .Resources );if _bcf ==nil {_ce .Log .Info ("N\u006f\u0020\u006d\u0061\u0074\u0063\u0068\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0066\u006f\u0072\u0020t\u0068\u0065\u0020\u0070\u0072\u006f\u0076\u0069\u0064\u0065d \u0070\u0061\u0074t\u0061r\u006e\u002e");
_bcf =_bagf ;};_agcd :=_g .ContentStreamOperation {Operand :"\u006e"};*_bcf =append (*_bcf ,&_agcd );_gaba .SetContentStreams ([]string {_bcf .String ()},_da .NewFlateEncoder ());if _bfag !=nil {return _bfag ;};_dbfc ,_bfag :=_gaba .GetMediaBox ();if _bfag !=nil {return _bfag ;
};if _gaba .MediaBox ==nil {_gaba .MediaBox =_dbfc ;};if _bad :=_bed ._cgbd .AddPage (_gaba );_bad !=nil {return _bad ;};_fc .Slice (_ggaa ,func (_fggd ,_gbegb int )bool {return _ggaa [_fggd ]._fbge < _ggaa [_gbegb ]._fbge });_aeae :=_dbfc .Ury ;for _ ,_cfdd :=range _ggaa {_dda :=_cfdd ._eaga ;
_fcf :=_bed ._cgbd .NewRectangle (_dda .Llx ,_aeae -_dda .Lly ,_dda .Urx -_dda .Llx ,-(_dda .Ury -_dda .Lly ));_fcf .SetFillColor (_fdea );_fcf .SetBorderWidth (_abee );_fcf .SetFillOpacity (_dgc );if _eaag :=_bed ._cgbd .Draw (_fcf );_eaag !=nil {return nil ;
};};};_bed ._cgbd .SetOutlineTree (_bed ._fbab .GetOutlineTree ());return nil ;};func _cegb (_bfg *targetMap ,_gedc []int ){var _cgg [][]int ;for _fgb ,_efda :=range _bfg ._gge {if _e .Contains (_gedc ,_fgb ){continue ;};_cgg =append (_cgg ,_efda );};_bfg ._gge =_cgg ;
};type placeHolders struct{_aa []int ;_eg string ;_dd float64 ;};var StandardRegexPatterns =[]string {RegexSSN ,RegexCreditCard ,RegexEmail ,RegexPhone ,RegexIPv4 ,RegexIPv6 ,RegexPassport ,RegexDriversLicense ,RegexDate ,RegexPostalCode ,RegexMAC ,RegexBankRouting ,RegexIBAN ,RegexAWSAccessKeyID ,RegexAWSSecretAccessKey ,RegexGoogleAPIKey ,RegexJWT ,RegexCardExpirationDate ,RegexSWIFTCode ,RegexStripeAPIKey };
func _fad (_dac ,_acad targetMap )(bool ,[]int ){_adcc :=_c .Contains (_dac ._adc ,_acad ._adc );var _ebf []int ;for _ ,_bbfd :=range _dac ._gge {for _fcdb ,_ccc :=range _acad ._gge {if _ccc [0]>=_bbfd [0]&&_ccc [1]<=_bbfd [1]{_ebf =append (_ebf ,_fcdb );
};};};return _adcc ,_ebf ;};