//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package pdfutil ;import (_c "errors";_f "fmt";_bd "github.com/unidoc/unipdf/v4/common";_g "github.com/unidoc/unipdf/v4/contentstream";_b "github.com/unidoc/unipdf/v4/contentstream/draw";_bf "github.com/unidoc/unipdf/v4/core";_aa "github.com/unidoc/unipdf/v4/model";
_ed "github.com/unidoc/unipdf/v4/ps";_e "os";);

// ConvertPageToGrayscale() replaces color objects on the page with grayscale ones.  Also references XObject Images and Forms
// to convert those to grayscale.
func ConvertPageToGrayscale (page *_aa .PdfPage )error {_bg ,_cg :=page .GetAllContentStreams ();if _cg !=nil {return _cg ;};_gf ,_cg :=_gfa (_bg ,page .Resources );if _cg !=nil {return _cg ;};_cg =page .SetContentStreams ([]string {string (_gf )},_bf .NewFlateEncoder ());
if _cg !=nil {return _cg ;};return nil ;};func _gfa (_d string ,_df *_aa .PdfPageResources )([]byte ,error ){_dfd :=_g .NewContentStreamParser (_d );_ea ,_bge :=_dfd .Parse ();if _bge !=nil {return nil ,_bge ;};_de :=&_g .ContentStreamOperations {};_da :=map[_bf .PdfObjectName ]bool {};
_dd :=map[_bf .PdfObjectName ]bool {};_cbb :=_g .NewContentStreamProcessor (*_ea );_cbb .AddHandler (_g .HandlerConditionEnumAllOperands ,"",func (_db *_g .ContentStreamOperation ,_ga _g .GraphicsState ,_dg *_aa .PdfPageResources )error {_edaa :=_db .Operand ;
switch _edaa {case "\u0043\u0053":if _gc (_ga .ColorspaceStroking ){_fc :=_db .Params [0].(*_bf .PdfObjectName );if *_fc !="\u0050a\u0074\u0074\u0065\u0072\u006e"{_gd ,_ab :=_dg .GetColorspaceByName (*_fc );if !_ab {return _c .New ("\u0063\u006f\u006c\u006frs\u0070\u0061\u0063\u0065\u0020\u006e\u006f\u0074\u0020\u0064\u0065\u0066\u0069\u006ee\u0064");
};_aaf ,_ab :=_gd .(*_aa .PdfColorspaceSpecialPattern );if !_ab {return _c .New ("\u0074\u0079\u0070\u0065\u0020\u0065\u0072\u0072\u006f\u0072");};if _aaf .UnderlyingCS !=nil {_aaf .UnderlyingCS =_aa .NewPdfColorspaceDeviceGray ();};_bge =_dg .SetColorspaceByName (*_fc ,_aaf );
if _bge !=nil {return _bge ;};};*_de =append (*_de ,_db );return nil ;};_bb :=_g .ContentStreamOperation {};_bb .Operand =_edaa ;_bb .Params =[]_bf .PdfObject {_bf .MakeName ("\u0044\u0065\u0076\u0069\u0063\u0065\u0047\u0072\u0061\u0079")};*_de =append (*_de ,&_bb );
return nil ;case "\u0063\u0073":if _gc (_ga .ColorspaceNonStroking ){_fa :=_db .Params [0].(*_bf .PdfObjectName );if *_fa !="\u0050a\u0074\u0074\u0065\u0072\u006e"{_bfd ,_geg :=_dg .GetColorspaceByName (*_fa );if !_geg {return _c .New ("\u0063\u006f\u006c\u006frs\u0070\u0061\u0063\u0065\u0020\u006e\u006f\u0074\u0020\u0064\u0065\u0066\u0069\u006ee\u0064");
};_dgb ,_geg :=_bfd .(*_aa .PdfColorspaceSpecialPattern );if !_geg {return _c .New ("\u0074\u0079\u0070\u0065\u0020\u0065\u0072\u0072\u006f\u0072");};if _dgb .UnderlyingCS !=nil {_dgb .UnderlyingCS =_aa .NewPdfColorspaceDeviceGray ();};if _bgc :=_dg .SetColorspaceByName (*_fa ,_dgb );
_bgc !=nil {return _bgc ;};};*_de =append (*_de ,_db );return nil ;};_gcg :=_g .ContentStreamOperation {};_gcg .Operand =_edaa ;_gcg .Params =[]_bf .PdfObject {_bf .MakeName ("\u0044\u0065\u0076\u0069\u0063\u0065\u0047\u0072\u0061\u0079")};*_de =append (*_de ,&_gcg );
return nil ;case "\u0053\u0043","\u0053\u0043\u004e":if _gc (_ga .ColorspaceStroking ){_ag :=_g .ContentStreamOperation {};_ag .Operand =_edaa ;_ag .Params =[]_bf .PdfObject {};_bbe ,_bfdc :=_ga .ColorStroking .(*_aa .PdfColorPattern );if !_bfdc {return _c .New ("i\u006e\u0076\u0061\u006c\u0069\u0064 \u0073\u0074\u0072\u006f\u006b\u0069\u006e\u0067\u0020c\u006f\u006c\u006fr\u0020t\u0079\u0070\u0065");
};if _bbe .Color !=nil {_gbf ,_aafa :=_ga .ColorspaceStroking .ColorToRGB (_bbe .Color );if _aafa !=nil {return _aafa ;};_be :=_gbf .(*_aa .PdfColorDeviceRGB );_fcb :=_be .ToGray ();_ag .Params =append (_ag .Params ,_bf .MakeFloat (_fcb .Val ()));};if _ ,_fab :=_da [_bbe .PatternName ];
_fab {_ag .Params =append (_ag .Params ,_bf .MakeName (string (_bbe .PatternName )));*_de =append (*_de ,&_ag );return nil ;};_da [_bbe .PatternName ]=true ;_fcg ,_fb :=_dg .GetPatternByName (_bbe .PatternName );if !_fb {return _c .New ("\u0075\u006e\u0064\u0065fi\u006e\u0065\u0064\u0020\u0070\u0061\u0074\u0074\u0065\u0072\u006e\u0020\u006e\u0061m\u0065");
};_cfg ,_gege :=_aae (_fcg );if _gege !=nil {return _gege ;};_gege =_dg .SetPatternByName (_bbe .PatternName ,_cfg .ToPdfObject ());if _gege !=nil {return _gege ;};_ag .Params =append (_ag .Params ,_bf .MakeName (string (_bbe .PatternName )));*_de =append (*_de ,&_ag );
}else {_bdd ,_cdb :=_ga .ColorspaceStroking .ColorToRGB (_ga .ColorStroking );if _cdb !=nil {return _cdb ;};_cde :=_bdd .(*_aa .PdfColorDeviceRGB );_ac :=_cde .ToGray ();_ef :=_g .ContentStreamOperation {};_ef .Operand =_edaa ;_ef .Params =[]_bf .PdfObject {_bf .MakeFloat (_ac .Val ())};
*_de =append (*_de ,&_ef );};return nil ;case "\u0073\u0063","\u0073\u0063\u006e":if _gc (_ga .ColorspaceNonStroking ){_agg :=_g .ContentStreamOperation {};_agg .Operand =_edaa ;_agg .Params =[]_bf .PdfObject {};_cda ,_ddf :=_ga .ColorNonStroking .(*_aa .PdfColorPattern );
if !_ddf {return _c .New ("i\u006e\u0076\u0061\u006c\u0069\u0064 \u0073\u0074\u0072\u006f\u006b\u0069\u006e\u0067\u0020c\u006f\u006c\u006fr\u0020t\u0079\u0070\u0065");};if _cda .Color !=nil {_abd ,_eg :=_ga .ColorspaceNonStroking .ColorToRGB (_cda .Color );
if _eg !=nil {return _eg ;};_gfg :=_abd .(*_aa .PdfColorDeviceRGB );_bc :=_gfg .ToGray ();_agg .Params =append (_agg .Params ,_bf .MakeFloat (_bc .Val ()));};if _ ,_ec :=_da [_cda .PatternName ];_ec {_agg .Params =append (_agg .Params ,_bf .MakeName (string (_cda .PatternName )));
*_de =append (*_de ,&_agg );return nil ;};_da [_cda .PatternName ]=true ;_ffd ,_dc :=_dg .GetPatternByName (_cda .PatternName );if !_dc {return _c .New ("\u0075\u006e\u0064\u0065fi\u006e\u0065\u0064\u0020\u0070\u0061\u0074\u0074\u0065\u0072\u006e\u0020\u006e\u0061m\u0065");
};_dce ,_bbg :=_aae (_ffd );if _bbg !=nil {return _bbg ;};_bbg =_dg .SetPatternByName (_cda .PatternName ,_dce .ToPdfObject ());if _bbg !=nil {return _bbg ;};_agg .Params =append (_agg .Params ,_bf .MakeName (string (_cda .PatternName )));*_de =append (*_de ,&_agg );
}else {_gda ,_fg :=_ga .ColorspaceNonStroking .ColorToRGB (_ga .ColorNonStroking );if _fg !=nil {return _fg ;};_faf :=_gda .(*_aa .PdfColorDeviceRGB );_ffc :=_faf .ToGray ();_gg :=_g .ContentStreamOperation {};_gg .Operand =_edaa ;_gg .Params =[]_bf .PdfObject {_bf .MakeFloat (_ffc .Val ())};
*_de =append (*_de ,&_gg );};return nil ;case "\u0052\u0047","\u004b":_dec ,_dag :=_ga .ColorspaceStroking .ColorToRGB (_ga .ColorStroking );if _dag !=nil {return _dag ;};_cfc :=_dec .(*_aa .PdfColorDeviceRGB );_baf :=_cfc .ToGray ();_ffg :=_g .ContentStreamOperation {};
_ffg .Operand ="\u0047";_ffg .Params =[]_bf .PdfObject {_bf .MakeFloat (_baf .Val ())};*_de =append (*_de ,&_ffg );return nil ;case "\u0072\u0067","\u006b":_eca ,_ae :=_ga .ColorspaceNonStroking .ColorToRGB (_ga .ColorNonStroking );if _ae !=nil {return _ae ;
};_cgc :=_eca .(*_aa .PdfColorDeviceRGB );_dee :=_cgc .ToGray ();_bda :=_g .ContentStreamOperation {};_bda .Operand ="\u0067";_bda .Params =[]_bf .PdfObject {_bf .MakeFloat (_dee .Val ())};*_de =append (*_de ,&_bda );return nil ;case "\u0073\u0068":if len (_db .Params )!=1{return _c .New ("\u0070\u0061\u0072\u0061\u006d\u0073 \u0074\u006f\u0020\u0073\u0068\u0020\u006f\u0070\u0065\u0072\u0061\u0074\u006fr\u0020\u0073\u0068\u006f\u0075\u006c\u0064 \u0062\u0065\u0020\u0031");
};_cdaf ,_bdf :=_db .Params [0].(*_bf .PdfObjectName );if !_bdf {return _c .New ("\u0073\u0068 \u0070\u0061\u0072\u0061\u006d\u0065\u0074\u0065\u0072\u0020\u0073\u0068\u006f\u0075\u006c\u0064\u0020\u0062\u0065\u0020\u0061\u0020na\u006d\u0065");};if _ ,_dgbf :=_dd [*_cdaf ];
_dgbf {*_de =append (*_de ,_db );return nil ;};_dd [*_cdaf ]=true ;_gec ,_dca :=_dg .GetShadingByName (*_cdaf );if !_dca {return _c .New ("\u0073\u0068\u0061\u0064\u0069\u006e\u0067\u0020\u006e\u006f\u0074\u0020\u0064\u0065\u0066i\u006ee\u0064\u0020\u0069\u006e\u0020\u0072\u0065\u0073\u006f\u0075\u0072\u0063\u0065\u0073");
};_bfa ,_efe :=_ecce (_gec );if _efe !=nil {return _efe ;};_efe =_dg .SetShadingByName (*_cdaf ,_bfa .GetContext ().ToPdfObject ());if _efe !=nil {return _efe ;};};*_de =append (*_de ,_db );return nil ;});_cbb .AddHandler (_g .HandlerConditionEnumOperand ,"\u0042\u0049",func (_adg *_g .ContentStreamOperation ,_afb _g .GraphicsState ,_ca *_aa .PdfPageResources )error {if len (_adg .Params )!=1{return _c .New ("\u0069\u006e\u0076\u0061l\u0069\u0064\u0020\u006e\u0075\u006d\u0062\u0065\u0072\u0020o\u0066 \u0070\u0061\u0072\u0061\u006d\u0065\u0074e\u0072\u0073");
};_ecc ,_fe :=_adg .Params [0].(*_g .ContentStreamInlineImage );if !_fe {return _c .New ("\u0069\u006e\u0076\u0061\u006c\u0069\u0064\u0020\u0069\u006el\u0069\u006e\u0065\u0020\u0069\u006d\u0061g\u0065\u0020\u0070\u0061\u0072\u0061\u006d\u0065\u0074\u0065\u0072");
};_ece ,_agc :=_ecc .ToImage (_ca );if _agc !=nil {return _agc ;};_dcd ,_agc :=_ecc .GetColorSpace (_ca );if _agc !=nil {return _agc ;};_bbgg ,_agc :=_dcd .ImageToRGB (*_ece );if _agc !=nil {return _agc ;};_add :=_aa .NewPdfColorspaceDeviceRGB ();_aea ,_agc :=_add .ImageToGray (_bbgg );
if _agc !=nil {return _agc ;};_cfd ,_agc :=_ecc .GetEncoder ();if _agc !=nil {return _agc ;};if _age ,_cdaa :=_cfd .(*_bf .DCTEncoder );_cdaa {_age .ColorComponents =1;};_aad ,_agc :=_g .NewInlineImageFromImage (_aea ,_cfd );if _agc !=nil {if _agc ==_bf .ErrUnsupportedEncodingParameters {_cfd =_bf .NewFlateEncoder ();
};_aad ,_agc =_g .NewInlineImageFromImage (_aea ,_cfd );if _agc !=nil {return _agc ;};};_cfa :=_g .ContentStreamOperation {};_cfa .Operand ="\u0042\u0049";_cfa .Params =[]_bf .PdfObject {_aad };*_de =append (*_de ,&_cfa );return nil ;});_cgb :=map[string ]bool {};
_cbb .AddHandler (_g .HandlerConditionEnumOperand ,"\u0044\u006f",func (_gbb *_g .ContentStreamOperation ,_aef _g .GraphicsState ,_ffe *_aa .PdfPageResources )error {if len (_gbb .Params )< 1{return _c .New ("\u0045\u0052\u0052\u004f\u0052\u003a\u0020\u0049\u006e\u0076\u0061\u006c\u0069\u0064\u0020\u006e\u0075\u006d\u0062\u0065r\u0020\u006f\u0066\u0020\u0070\u0061\u0072\u0061\u006ds\u0020\u0066\u006f\u0072\u0020\u0044\u006f\u0020\u006f\u0062\u006a\u0065\u0063t\u003a\u0020\u0052\u0061\u006e\u0067e\u0020\u0063\u0068e\u0063\u006b");
};_dcag :=_gbb .Params [0].(*_bf .PdfObjectName );_ ,_fca :=_cgb [string (*_dcag )];if _fca {return nil ;};_cgb [string (*_dcag )]=true ;_ ,_dbg :=_ffe .GetXObjectByName (*_dcag );if _dbg ==_aa .XObjectTypeImage {_fd ,_bfb :=_ffe .GetXObjectImageByName (*_dcag );
if _bfb !=nil {return _bfb ;};_dbb ,_bfb :=_fd .ToImage ();if _bfb !=nil {return _bfb ;};_gegf ,_bfb :=_fd .ColorSpace .ImageToRGB (*_dbb );if _bfb !=nil {return _bfb ;};_bgef :=_aa .NewPdfColorspaceDeviceRGB ();_bec ,_bfb :=_bgef .ImageToGray (_gegf );
if _bfb !=nil {return _bfb ;};_gfab :=_fd .Filter ;if _gca ,_adc :=_gfab .(*_bf .DCTEncoder );_adc {_gca .ColorComponents =1;};_acb ,_bfb :=_aa .NewXObjectImageFromImage (&_bec ,nil ,_gfab );if _bfb !=nil {if _bfb ==_bf .ErrUnsupportedEncodingParameters {_gfab =_bf .NewFlateEncoder ();
};_acb ,_bfb =_aa .NewXObjectImageFromImage (&_bec ,nil ,_gfab );if _bfb !=nil {return _bfb ;};};_bfb =_ffe .SetXObjectImageByName (*_dcag ,_acb );if _bfb !=nil {return _bfb ;};}else if _dbg ==_aa .XObjectTypeForm {_fbf ,_cdef :=_ffe .GetXObjectFormByName (*_dcag );
if _cdef !=nil {return _cdef ;};_feg ,_cdef :=_fbf .GetContentStream ();if _cdef !=nil {return _cdef ;};_bef :=_fbf .Resources ;if _bef ==nil {_bef =_ffe ;};_fad ,_cdef :=_gfa (string (_feg ),_bef );if _cdef !=nil {return _cdef ;};_cdef =_fbf .SetContentStream (_fad ,nil );
if _cdef !=nil {return _cdef ;};_cdef =_ffe .SetXObjectFormByName (*_dcag ,_fbf );if _cdef !=nil {return _cdef ;};};return nil ;});_bge =_cbb .Process (_df );if _bge !=nil {return nil ,_bge ;};return _de .Bytes (),nil ;};

// NormalizePage performs the following operations on the passed in page:
//   - Normalize the page rotation.
//     Rotates the contents of the page according to the Rotate entry, thus
//     flattening the rotation. The Rotate entry of the page is set to nil.
//   - Normalize the media box.
//     If the media box of the page is offsetted (Llx != 0 or Lly != 0),
//     the contents of the page are translated to (-Llx, -Lly). After
//     normalization, the media box is updated (Llx and Lly are set to 0 and
//     Urx and Ury are updated accordingly).
//   - Normalize the crop box.
//     The crop box of the page is updated based on the previous operations.
//
// After normalization, the page should look the same if openend using a
// PDF viewer.
// NOTE: This function does not normalize annotations, outlines other parts
// that are not part of the basic geometry and page content streams.
func NormalizePage (page *_aa .PdfPage )error {_aba ,_gdb :=page .GetMediaBox ();if _gdb !=nil {return _gdb ;};_dade ,_gdb :=page .GetRotate ();if _gdb !=nil {_bd .Log .Debug ("\u0045\u0052R\u004f\u0052\u003a\u0020\u0025\u0073\u0020\u002d\u0020\u0069\u0067\u006e\u006f\u0072\u0069\u006e\u0067\u0020\u0061\u006e\u0064\u0020\u0061\u0073\u0073\u0075\u006d\u0069\u006e\u0067\u0020\u006e\u006f\u0020\u0072\u006f\u0074\u0061\u0074\u0069\u006f\u006e\u000a",_gdb .Error ());
};_cfcb :=_dade %360!=0&&_dade %90==0;_aba .Normalize ();_fdf ,_fda ,_ebb ,_aage :=_aba .Llx ,_aba .Lly ,_aba .Width (),_aba .Height ();_acdg :=_fdf !=0||_fda !=0;if !_cfcb &&!_acdg {return nil ;};_geb :=func (_cdaac ,_efa ,_dfa float64 )_b .BoundingBox {return _b .Path {Points :[]_b .Point {_b .NewPoint (0,0).Rotate (_dfa ),_b .NewPoint (_cdaac ,0).Rotate (_dfa ),_b .NewPoint (0,_efa ).Rotate (_dfa ),_b .NewPoint (_cdaac ,_efa ).Rotate (_dfa )}}.GetBoundingBox ();
};_aggf :=_g .NewContentCreator ();var _cdea float64 ;if _cfcb {_cdea =-float64 (_dade );_ead :=_geb (_ebb ,_aage ,_cdea );_aggf .Translate ((_ead .Width -_ebb )/2+_ebb /2,(_ead .Height -_aage )/2+_aage /2);_aggf .RotateDeg (_cdea );_aggf .Translate (-_ebb /2,-_aage /2);
_ebb ,_aage =_ead .Width ,_ead .Height ;};if _acdg {_aggf .Translate (-_fdf ,-_fda );};_gede :=_aggf .Operations ();_ddb ,_gdb :=_bf .MakeStream (_gede .Bytes (),_bf .NewFlateEncoder ());if _gdb !=nil {return _gdb ;};_efce :=_bf .MakeArray (_ddb );_efce .Append (page .GetContentStreamObjs ()...);
*_aba =_aa .PdfRectangle {Urx :_ebb ,Ury :_aage };if _fdcg :=page .CropBox ;_fdcg !=nil {_fdcg .Normalize ();_fag ,_beed ,_dga ,_cdee :=_fdcg .Llx -_fdf ,_fdcg .Lly -_fda ,_fdcg .Width (),_fdcg .Height ();if _cfcb {_agdbf :=_geb (_dga ,_cdee ,_cdea );_dga ,_cdee =_agdbf .Width ,_agdbf .Height ;
};*_fdcg =_aa .PdfRectangle {Llx :_fag ,Lly :_beed ,Urx :_fag +_dga ,Ury :_beed +_cdee };};_bd .Log .Debug ("\u0052\u006f\u0074\u0061\u0074\u0065\u003d\u0025\u0066\u00b0\u0020\u004f\u0070\u0073\u003d%\u0071 \u004d\u0065\u0064\u0069\u0061\u0042\u006f\u0078\u003d\u0025\u002e\u0032\u0066",_cdea ,_gede ,_aba );
page .Contents =_efce ;page .Rotate =nil ;return nil ;};func _ecce (_aff *_aa .PdfShading )(*_aa .PdfShading ,error ){_cc :=_aff .ColorSpace ;if _cc .GetNumComponents ()==1{return _aff ,nil ;}else if _cc .GetNumComponents ()==3{_gfac :=&_aa .PdfFunctionType4 {};
_gfac .Domain =[]float64 {0,1,0,1,0,1};_gfac .Range =[]float64 {0,1};_cgf :=_ed .NewPSProgram ();_cgf .Append (_ed .MakeReal (0.11));_cgf .Append (_ed .MakeOperand ("\u006d\u0075\u006c"));_cgf .Append (_ed .MakeOperand ("\u0065\u0078\u0063\u0068"));_cgf .Append (_ed .MakeReal (0.59));
_cgf .Append (_ed .MakeOperand ("\u006d\u0075\u006c"));_cgf .Append (_ed .MakeOperand ("\u0061\u0064\u0064"));_cgf .Append (_ed .MakeOperand ("\u0065\u0078\u0063\u0068"));_cgf .Append (_ed .MakeReal (0.3));_cgf .Append (_ed .MakeOperand ("\u006d\u0075\u006c"));
_cgf .Append (_ed .MakeOperand ("\u0061\u0064\u0064"));_gfac .Program =_cgf ;_cdd :=_aa .NewPdfColorspaceDeviceN ();_cdd .AlternateSpace =_aa .NewPdfColorspaceDeviceGray ();_cdd .ColorantNames =_bf .MakeArray (_bf .MakeName ("\u0052"),_bf .MakeName ("\u0047"),_bf .MakeName ("\u0042"));
_cdd .TintTransform =_gfac ;_aff .ColorSpace =_cdd ;return _aff ,nil ;}else if _cc .GetNumComponents ()==4{_ce :=&_aa .PdfFunctionType4 {};_ce .Domain =[]float64 {0,1,0,1,0,1,0,1};_ce .Range =[]float64 {0,1};_ddg :=_ed .NewPSProgram ();_ddg .Append (_ed .MakeOperand ("\u0065\u0078\u0063\u0068"));
_ddg .Append (_ed .MakeReal (0.11));_ddg .Append (_ed .MakeOperand ("\u006d\u0075\u006c"));_ddg .Append (_ed .MakeOperand ("\u0061\u0064\u0064"));_ddg .Append (_ed .MakeOperand ("\u0065\u0078\u0063\u0068"));_ddg .Append (_ed .MakeReal (0.59));_ddg .Append (_ed .MakeOperand ("\u006d\u0075\u006c"));
_ddg .Append (_ed .MakeOperand ("\u0061\u0064\u0064"));_ddg .Append (_ed .MakeOperand ("\u0065\u0078\u0063\u0068"));_ddg .Append (_ed .MakeReal (0.30));_ddg .Append (_ed .MakeOperand ("\u006d\u0075\u006c"));_ddg .Append (_ed .MakeOperand ("\u0061\u0064\u0064"));
_ddg .Append (_ed .MakeOperand ("\u0064\u0075\u0070"));_ddg .Append (_ed .MakeReal (1.0));_ddg .Append (_ed .MakeOperand ("\u0067\u0065"));_cgg :=_ed .NewPSProgram ();_cgg .Append (_ed .MakeOperand ("\u0070\u006f\u0070"));_cgg .Append (_ed .MakeReal (1.0));
_ddg .Append (_cgg );_ddg .Append (_ed .MakeOperand ("\u0069\u0066"));_ce .Program =_ddg ;_cca :=_aa .NewPdfColorspaceDeviceN ();_cca .AlternateSpace =_aa .NewPdfColorspaceDeviceGray ();_cca .ColorantNames =_bf .MakeArray (_bf .MakeName ("\u0043"),_bf .MakeName ("\u004d"),_bf .MakeName ("\u0059"),_bf .MakeName ("\u004b"));
_cca .TintTransform =_ce ;_aff .ColorSpace =_cca ;return _aff ,nil ;}else {return nil ,_c .New ("\u0075\u006e\u0073\u0075\u0070\u0070\u006fr\u0074\u0065\u0064 \u0070\u0061\u0074t\u0065\u0072n\u0020\u0063\u006f\u006c\u006f\u0072s\u0070ac\u0065\u0020\u0066\u006f\u0072\u0020\u0067\u0072\u0061\u0079\u0073\u0063\u0061\u006c\u0065\u0020\u0063\u006f\u006e\u0076\u0065\u0072\u0073\u0069\u006f\u006e");
};};func _dfdg (_eeb ,_bbc *_aa .PdfPageResources )(*_aa .PdfPageResources ,error ){if _eeb .XObject ==nil {_eeb .XObject =_bbc .XObject ;}else {_efc ,_ :=_bf .GetDict (_eeb .XObject );if _bbc .XObject !=nil {_gbg ,_ :=_bf .GetDict (_bbc .XObject );for _ ,_ada :=range _gbg .Keys (){_ggef :=_gbg .Get (_ada );
_efc .Set (_ada ,_ggef );};};};_def ,_ged :=_eeb .GetColorspaces ();if _ged !=nil {return nil ,_ged ;};_gaa ,_ged :=_bbc .GetColorspaces ();if _ged !=nil {return nil ,_ged ;};if _def ==nil {_eeb .SetColorSpace (_gaa );}else {if _gaa !=nil {for _gaf ,_edcd :=range _gaa .Colorspaces {if _ ,_fdg :=_def .Colorspaces [_gaf ];
!_fdg {_def .Names =append (_def .Names ,_gaf );};_eeb .SetColorspaceByName (_bf .PdfObjectName (_gaf ),_edcd );};};};if _eeb .ExtGState ==nil {_eeb .ExtGState =_bbc .ExtGState ;}else {_gdf ,_ :=_bf .GetDict (_eeb .ExtGState );if _bbc .ExtGState !=nil {_dbe ,_ :=_bf .GetDict (_bbc .ExtGState );
for _ ,_aadd :=range _dbe .Keys (){_eag :=_dbe .Get (_aadd );_gdf .Set (_aadd ,_eag );};};};if _eeb .Shading ==nil {_eeb .Shading =_bbc .Shading ;}else {_beg ,_ :=_bf .GetDict (_eeb .Shading );if _bbc .Shading !=nil {_fdc ,_ :=_bf .GetDict (_bbc .Shading );
for _ ,_gce :=range _fdc .Keys (){_cbdb :=_fdc .Get (_gce );_beg .Set (_gce ,_cbdb );};};};if _eeb .Pattern ==nil {_eeb .Pattern =_bbc .Pattern ;}else {_dadd ,_ :=_bf .GetDict (_eeb .Pattern );if _bbc .Pattern !=nil {_edcg ,_ :=_bf .GetDict (_bbc .Pattern );
for _ ,_bcf :=range _edcg .Keys (){_eba :=_edcg .Get (_bcf );_dadd .Set (_bcf ,_eba );};};};if _eeb .Font ==nil {_eeb .Font =_bbc .Font ;}else {_eae ,_ :=_bf .GetDict (_eeb .Font );if _bbc .Font !=nil {_deb ,_ :=_bf .GetDict (_bbc .Font );for _ ,_affc :=range _deb .Keys (){_faff :=_deb .Get (_affc );
_eae .Set (_affc ,_faff );};};};if _eeb .ProcSet ==nil {_eeb .ProcSet =_bbc .ProcSet ;}else {_afg ,_ :=_bf .GetDict (_eeb .ProcSet );if _bbc .ProcSet !=nil {_gbfc ,_ :=_bf .GetDict (_bbc .ProcSet );for _ ,_bfae :=range _gbfc .Keys (){_cfga :=_gbfc .Get (_bfae );
_afg .Set (_bfae ,_cfga );};};};if _eeb .Properties ==nil {_eeb .Properties =_bbc .Properties ;}else {_cab ,_ :=_bf .GetDict (_eeb .Properties );if _bbc .Properties !=nil {_fdb ,_ :=_bf .GetDict (_bbc .Properties );for _ ,_daa :=range _fdb .Keys (){_afbg :=_fdb .Get (_daa );
_cab .Set (_daa ,_afbg );};};};return _eeb ,nil ;};func _aae (_fcd *_aa .PdfPattern )(*_aa .PdfPattern ,error ){if _fcd .IsTiling (){_gcb :=_fcd .GetAsTilingPattern ();if _gcb .IsColored (){_gff ,_aab :=_gcb .GetContentStream ();if _aab !=nil {return nil ,_aab ;
};_ggf ,_aab :=_gfa (string (_gff ),_gcb .Resources );if _aab !=nil {return nil ,_aab ;};_aab =_gcb .SetContentStream (_ggf ,nil );if _aab !=nil {return nil ,_aab ;};_ =_gcb .ToPdfObject ();};}else if _fcd .IsShading (){_egc :=_fcd .GetAsShadingPattern ();
_gab ,_dcaa :=_ecce (_egc .Shading );if _dcaa !=nil {return nil ,_dcaa ;};_egc .Shading =_gab ;_ =_egc .ToPdfObject ();};return _fcd ,nil ;};func _gc (_ba _aa .PdfColorspace )bool {_ ,_eda :=_ba .(*_aa .PdfColorspaceSpecialPattern );return _eda };

// MergePdf merges several PDF files passed as inputPaths to one PDF file, outputPath.
// isMergingForms controls if it is necessary to merge AcroForms from input files.
// If you are not sure, you can always set isMergingForms to true.
func MergePdf (inputPaths []string ,outputPath string ,isMergingForms bool )error {_fgd :=_aa .NewPdfWriter ();var _cad *_aa .PdfAcroForm ;for _gef ,_cdc :=range inputPaths {_edc ,_dad ,_bafb :=_aa .NewPdfReaderFromFile (_cdc ,nil );if _bafb !=nil {return _bafb ;
};defer _dad .Close ();_cbd ,_bafb :=_edc .GetNumPages ();if _bafb !=nil {return _bafb ;};for _cba :=range _cbd {_faa :=_cba +1;_fee ,_baa :=_edc .GetPage (_faa );if _baa !=nil {return _baa ;};_baa =_fgd .AddPage (_fee );if _baa !=nil {return _baa ;};};
if isMergingForms &&_edc .AcroForm !=nil {if _cad ==nil {_cad =_edc .AcroForm ;}else {_cad ,_bafb =_efcb (_cad ,_edc .AcroForm ,_gef +1);if _bafb !=nil {return _bafb ;};};};};_gga ,_fea :=_e .Create (outputPath );if _fea !=nil {return _fea ;};defer _gga .Close ();
if _cad !=nil {_fgd .SetForms (_cad );};_fea =_fgd .Write (_gga );if _fea !=nil {return _fea ;};return nil ;};func _efcb (_dgc ,_adcg *_aa .PdfAcroForm ,_bee int )(*_aa .PdfAcroForm ,error ){if _dgc .NeedAppearances ==nil {_dgc .NeedAppearances =_adcg .NeedAppearances ;
};if _dgc .SigFlags ==nil {_dgc .SigFlags =_adcg .SigFlags ;};if _dgc .CO ==nil {_dgc .CO =_adcg .CO ;};if _dgc .DR ==nil {_dgc .DR =_adcg .DR ;}else if _adcg .DR !=nil {_bcg ,_cadf :=_dfdg (_dgc .DR ,_adcg .DR );if _cadf !=nil {return nil ,_cadf ;};_dgc .DR =_bcg ;
};if _dgc .DA ==nil {_dgc .DA =_adcg .DA ;};if _dgc .Q ==nil {_dgc .Q =_adcg .Q ;};if _dgc .XFA ==nil {_dgc .XFA =_adcg .XFA ;}else {if _adcg .XFA !=nil {_bd .Log .Debug ("TO\u0044\u004f\u003a\u0020\u0048\u0061\u006edl\u0065\u0020\u0058\u0046\u0041\u0020\u006d\u0065\u0072\u0067\u0069\u006e\u0067\u0020\u002d \u0043\u0075\u0072\u0072\u0065\u006e\u0074\u006c\u0079\u0020\u006a\u0075\u0073\u0074\u0020\u0075\u0073\u0069\u006e\u0067 \u0066\u0069\u0072\u0073\u0074\u0020o\u006e\u0065\u0020\u0074\u0068\u0061\u0074\u0020\u0069s\u0020e\u006e\u0063\u006f\u0075\u006e\u0074\u0065\u0072\u0065\u0064");
};};if _dgc .Fields ==nil {_dgc .Fields =_adcg .Fields ;}else {_ecb :=_aa .NewPdfField ();_ecb .T =_bf .MakeString (_f .Sprintf ("\u0064\u006f\u0063%\u0064",_bee ));_ecb .Kids =[]*_aa .PdfField {};if _adcg .Fields !=nil {for _ ,_gbc :=range *_adcg .Fields {_gbc .Parent =_ecb ;
_ecb .Kids =append (_ecb .Kids ,_gbc );};};*_dgc .Fields =append (*_dgc .Fields ,_ecb );};return _dgc ,nil ;};

// ExtractPageRange extracts a range of pages from inputPath PDF file and saves it as outputPath PDF file.
// keepOptionalContent controls if we need to process OC properties (rarely needed).
func ExtractPageRange (inputPath string ,outputPath string ,pageFrom int ,pageTo int ,keepOptionalContent bool )error {_ff :=_aa .NewPdfWriter ();_af ,_ad ,_ade :=_aa .NewPdfReaderFromFile (inputPath ,nil );if _ade !=nil {return _ade ;};defer _ad .Close ();
_aag ,_ade :=_af .GetNumPages ();if _ade !=nil {return _ade ;};if _aag < pageTo {return _f .Errorf ("n\u0075\u006d\u0050\u0061\u0067\u0065s\u0020\u0028\u0025\u0064\u0029\u0020\u003c\u0020\u0070a\u0067\u0065\u0054o\u0020(\u0025\u0064\u0029",_aag ,pageTo );
};if keepOptionalContent {_cb ,_cf :=_af .GetOCProperties ();if _cf !=nil {return _cf ;};_ff .SetOCProperties (_cb );};for _ge :=pageFrom ;_ge <=pageTo ;_ge ++{_cd :=_ge ;_ee ,_cbg :=_af .GetPage (_cd );if _cbg !=nil {return _cbg ;};_cbg =_ff .AddPage (_ee );
if _cbg !=nil {return _cbg ;};};_eb ,_ade :=_e .Create (outputPath );if _ade !=nil {return _ade ;};defer _eb .Close ();_ade =_ff .Write (_eb );if _ade !=nil {return _ade ;};return nil ;};