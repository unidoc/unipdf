//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package pdfutil ;import (_g "errors";_f "fmt";_ed "github.com/unidoc/unipdf/v4/common";_bb "github.com/unidoc/unipdf/v4/contentstream";_e "github.com/unidoc/unipdf/v4/contentstream/draw";_be "github.com/unidoc/unipdf/v4/core";_b "github.com/unidoc/unipdf/v4/model";
_bf "github.com/unidoc/unipdf/v4/ps";_dg "os";);

// ConvertPageToGrayscale() replaces color objects on the page with grayscale ones.  Also references XObject Images and Forms
// to convert those to grayscale.
func ConvertPageToGrayscale (page *_b .PdfPage )error {_ba ,_dga :=page .GetAllContentStreams ();if _dga !=nil {return _dga ;};_bac ,_dga :=_gg (_ba ,page .Resources );if _dga !=nil {return _dga ;};_dga =page .SetContentStreams ([]string {string (_bac )},_be .NewFlateEncoder ());
if _dga !=nil {return _dga ;};return nil ;};func _cgbb (_ccb *_b .PdfPattern )(*_b .PdfPattern ,error ){if _ccb .IsTiling (){_ddcf :=_ccb .GetAsTilingPattern ();if _ddcf .IsColored (){_fec ,_ddb :=_ddcf .GetContentStream ();if _ddb !=nil {return nil ,_ddb ;
};_agd ,_ddb :=_gg (string (_fec ),_ddcf .Resources );if _ddb !=nil {return nil ,_ddb ;};_ddb =_ddcf .SetContentStream (_agd ,nil );if _ddb !=nil {return nil ,_ddb ;};_ =_ddcf .ToPdfObject ();};}else if _ccb .IsShading (){_efe :=_ccb .GetAsShadingPattern ();
_cbaa ,_adg :=_aa (_efe .Shading );if _adg !=nil {return nil ,_adg ;};_efe .Shading =_cbaa ;_ =_efe .ToPdfObject ();};return _ccb ,nil ;};

// ExtractPageRange extracts a range of pages from inputPath PDF file and saves it as outputPath PDF file.
// keepOptionalContent controls if we need to process OC properties (rarely needed).
func ExtractPageRange (inputPath string ,outputPath string ,pageFrom int ,pageTo int ,keepOptionalContent bool )error {_a :=_b .NewPdfWriter ();_ee ,_c ,_bc :=_b .NewPdfReaderFromFile (inputPath ,nil );if _bc !=nil {return _bc ;};defer _c .Close ();_ef ,_bc :=_ee .GetNumPages ();
if _bc !=nil {return _bc ;};if _ef < pageTo {return _f .Errorf ("n\u0075\u006d\u0050\u0061\u0067\u0065s\u0020\u0028\u0025\u0064\u0029\u0020\u003c\u0020\u0070a\u0067\u0065\u0054o\u0020(\u0025\u0064\u0029",_ef ,pageTo );};if keepOptionalContent {_fg ,_fd :=_ee .GetOCProperties ();
if _fd !=nil {return _fd ;};_a .SetOCProperties (_fg );};for _ag :=pageFrom ;_ag <=pageTo ;_ag ++{_ge :=_ag ;_bd ,_eeb :=_ee .GetPage (_ge );if _eeb !=nil {return _eeb ;};_eeb =_a .AddPage (_bd );if _eeb !=nil {return _eeb ;};};_beg ,_bc :=_dg .Create (outputPath );
if _bc !=nil {return _bc ;};defer _beg .Close ();_bc =_a .Write (_beg );if _bc !=nil {return _bc ;};return nil ;};

// MergePdf merges several PDF files passed as inputPaths to one PDF file, outputPath.
// isMergingForms controls if it is necessary to merge AcroForms from input files.
// If you are not sure, you can always set isMergingForms to true.
func MergePdf (inputPaths []string ,outputPath string ,isMergingForms bool )error {_fae :=_b .NewPdfWriter ();var _gffb *_b .PdfAcroForm ;for _dcf ,_cdc :=range inputPaths {_dggg ,_dgaa ,_fcbg :=_b .NewPdfReaderFromFile (_cdc ,nil );if _fcbg !=nil {return _fcbg ;
};defer _dgaa .Close ();_cgd ,_fcbg :=_dggg .GetNumPages ();if _fcbg !=nil {return _fcbg ;};for _cab :=range _cgd {_dge :=_cab +1;_cad ,_dcb :=_dggg .GetPage (_dge );if _dcb !=nil {return _dcb ;};_dcb =_fae .AddPage (_cad );if _dcb !=nil {return _dcb ;
};};if isMergingForms &&_dggg .AcroForm !=nil {if _gffb ==nil {_gffb =_dggg .AcroForm ;}else {_gffb ,_fcbg =_dde (_gffb ,_dggg .AcroForm ,_dcf +1);if _fcbg !=nil {return _fcbg ;};};};};_fdgb ,_bdfa :=_dg .Create (outputPath );if _bdfa !=nil {return _bdfa ;
};defer _fdgb .Close ();if _gffb !=nil {_fae .SetForms (_gffb );};_bdfa =_fae .Write (_fdgb );if _bdfa !=nil {return _bdfa ;};return nil ;};func _eba (_fca ,_eag *_b .PdfPageResources )(*_b .PdfPageResources ,error ){if _fca .XObject ==nil {_fca .XObject =_eag .XObject ;
}else {_dfge ,_ :=_be .GetDict (_fca .XObject );if _eag .XObject !=nil {_gdc ,_ :=_be .GetDict (_eag .XObject );for _ ,_cgda :=range _gdc .Keys (){_dda :=_gdc .Get (_cgda );_dfge .Set (_cgda ,_dda );};};};_ccc ,_ggagb :=_fca .GetColorspaces ();if _ggagb !=nil {return nil ,_ggagb ;
};_ggg ,_ggagb :=_eag .GetColorspaces ();if _ggagb !=nil {return nil ,_ggagb ;};if _ccc ==nil {_fca .SetColorSpace (_ggg );}else {if _ggg !=nil {for _fce ,_bceg :=range _ggg .Colorspaces {if _ ,_fgg :=_ccc .Colorspaces [_fce ];!_fgg {_ccc .Names =append (_ccc .Names ,_fce );
};_fca .SetColorspaceByName (_be .PdfObjectName (_fce ),_bceg );};};};if _fca .ExtGState ==nil {_fca .ExtGState =_eag .ExtGState ;}else {_bdg ,_ :=_be .GetDict (_fca .ExtGState );if _eag .ExtGState !=nil {_gcf ,_ :=_be .GetDict (_eag .ExtGState );for _ ,_ede :=range _gcf .Keys (){_cfa :=_gcf .Get (_ede );
_bdg .Set (_ede ,_cfa );};};};if _fca .Shading ==nil {_fca .Shading =_eag .Shading ;}else {_dgd ,_ :=_be .GetDict (_fca .Shading );if _eag .Shading !=nil {_ffd ,_ :=_be .GetDict (_eag .Shading );for _ ,_aae :=range _ffd .Keys (){_agc :=_ffd .Get (_aae );
_dgd .Set (_aae ,_agc );};};};if _fca .Pattern ==nil {_fca .Pattern =_eag .Pattern ;}else {_fad ,_ :=_be .GetDict (_fca .Pattern );if _eag .Pattern !=nil {_eca ,_ :=_be .GetDict (_eag .Pattern );for _ ,_abgd :=range _eca .Keys (){_ecfd :=_eca .Get (_abgd );
_fad .Set (_abgd ,_ecfd );};};};if _fca .Font ==nil {_fca .Font =_eag .Font ;}else {_agf ,_ :=_be .GetDict (_fca .Font );if _eag .Font !=nil {_fbg ,_ :=_be .GetDict (_eag .Font );for _ ,_fbb :=range _fbg .Keys (){_fgf :=_fbg .Get (_fbb );_agf .Set (_fbb ,_fgf );
};};};if _fca .ProcSet ==nil {_fca .ProcSet =_eag .ProcSet ;}else {_fge ,_ :=_be .GetDict (_fca .ProcSet );if _eag .ProcSet !=nil {_agdc ,_ :=_be .GetDict (_eag .ProcSet );for _ ,_bgd :=range _agdc .Keys (){_fadb :=_agdc .Get (_bgd );_fge .Set (_bgd ,_fadb );
};};};if _fca .Properties ==nil {_fca .Properties =_eag .Properties ;}else {_def ,_ :=_be .GetDict (_fca .Properties );if _eag .Properties !=nil {_gee ,_ :=_be .GetDict (_eag .Properties );for _ ,_dafd :=range _gee .Keys (){_bge :=_gee .Get (_dafd );_def .Set (_dafd ,_bge );
};};};return _fca ,nil ;};func _aa (_dceg *_b .PdfShading )(*_b .PdfShading ,error ){_feg :=_dceg .ColorSpace ;if _feg .GetNumComponents ()==1{return _dceg ,nil ;}else if _feg .GetNumComponents ()==3{_cbf :=&_b .PdfFunctionType4 {};_cbf .Domain =[]float64 {0,1,0,1,0,1};
_cbf .Range =[]float64 {0,1};_efc :=_bf .NewPSProgram ();_efc .Append (_bf .MakeReal (0.11));_efc .Append (_bf .MakeOperand ("\u006d\u0075\u006c"));_efc .Append (_bf .MakeOperand ("\u0065\u0078\u0063\u0068"));_efc .Append (_bf .MakeReal (0.59));_efc .Append (_bf .MakeOperand ("\u006d\u0075\u006c"));
_efc .Append (_bf .MakeOperand ("\u0061\u0064\u0064"));_efc .Append (_bf .MakeOperand ("\u0065\u0078\u0063\u0068"));_efc .Append (_bf .MakeReal (0.3));_efc .Append (_bf .MakeOperand ("\u006d\u0075\u006c"));_efc .Append (_bf .MakeOperand ("\u0061\u0064\u0064"));
_cbf .Program =_efc ;_ece :=_b .NewPdfColorspaceDeviceN ();_ece .AlternateSpace =_b .NewPdfColorspaceDeviceGray ();_ece .ColorantNames =_be .MakeArray (_be .MakeName ("\u0052"),_be .MakeName ("\u0047"),_be .MakeName ("\u0042"));_ece .TintTransform =_cbf ;
_dceg .ColorSpace =_ece ;return _dceg ,nil ;}else if _feg .GetNumComponents ()==4{_baa :=&_b .PdfFunctionType4 {};_baa .Domain =[]float64 {0,1,0,1,0,1,0,1};_baa .Range =[]float64 {0,1};_bda :=_bf .NewPSProgram ();_bda .Append (_bf .MakeOperand ("\u0065\u0078\u0063\u0068"));
_bda .Append (_bf .MakeReal (0.11));_bda .Append (_bf .MakeOperand ("\u006d\u0075\u006c"));_bda .Append (_bf .MakeOperand ("\u0061\u0064\u0064"));_bda .Append (_bf .MakeOperand ("\u0065\u0078\u0063\u0068"));_bda .Append (_bf .MakeReal (0.59));_bda .Append (_bf .MakeOperand ("\u006d\u0075\u006c"));
_bda .Append (_bf .MakeOperand ("\u0061\u0064\u0064"));_bda .Append (_bf .MakeOperand ("\u0065\u0078\u0063\u0068"));_bda .Append (_bf .MakeReal (0.30));_bda .Append (_bf .MakeOperand ("\u006d\u0075\u006c"));_bda .Append (_bf .MakeOperand ("\u0061\u0064\u0064"));
_bda .Append (_bf .MakeOperand ("\u0064\u0075\u0070"));_bda .Append (_bf .MakeReal (1.0));_bda .Append (_bf .MakeOperand ("\u0067\u0065"));_dab :=_bf .NewPSProgram ();_dab .Append (_bf .MakeOperand ("\u0070\u006f\u0070"));_dab .Append (_bf .MakeReal (1.0));
_bda .Append (_dab );_bda .Append (_bf .MakeOperand ("\u0069\u0066"));_baa .Program =_bda ;_bdf :=_b .NewPdfColorspaceDeviceN ();_bdf .AlternateSpace =_b .NewPdfColorspaceDeviceGray ();_bdf .ColorantNames =_be .MakeArray (_be .MakeName ("\u0043"),_be .MakeName ("\u004d"),_be .MakeName ("\u0059"),_be .MakeName ("\u004b"));
_bdf .TintTransform =_baa ;_dceg .ColorSpace =_bdf ;return _dceg ,nil ;}else {return nil ,_g .New ("\u0075\u006e\u0073\u0075\u0070\u0070\u006fr\u0074\u0065\u0064 \u0070\u0061\u0074t\u0065\u0072n\u0020\u0063\u006f\u006c\u006f\u0072s\u0070ac\u0065\u0020\u0066\u006f\u0072\u0020\u0067\u0072\u0061\u0079\u0073\u0063\u0061\u006c\u0065\u0020\u0063\u006f\u006e\u0076\u0065\u0072\u0073\u0069\u006f\u006e");
};};func _eef (_gc _b .PdfColorspace )bool {_ ,_ga :=_gc .(*_b .PdfColorspaceSpecialPattern );return _ga };func _gg (_cf string ,_ff *_b .PdfPageResources )([]byte ,error ){_fdg :=_bb .NewContentStreamParser (_cf );_eb ,_fa :=_fdg .Parse ();if _fa !=nil {return nil ,_fa ;
};_gf :=&_bb .ContentStreamOperations {};_eee :=map[_be .PdfObjectName ]bool {};_bca :=map[_be .PdfObjectName ]bool {};_bec :=_bb .NewContentStreamProcessor (*_eb );_bec .AddHandler (_bb .HandlerConditionEnumAllOperands ,"",func (_cc *_bb .ContentStreamOperation ,_gga _bb .GraphicsState ,_eec *_b .PdfPageResources )error {_ffb :=_cc .Operand ;
switch _ffb {case "\u0043\u0053":if _eef (_gga .ColorspaceStroking ){_dgg :=_cc .Params [0].(*_be .PdfObjectName );if *_dgg !="\u0050a\u0074\u0074\u0065\u0072\u006e"{_fb ,_cfb :=_eec .GetColorspaceByName (*_dgg );if !_cfb {return _g .New ("\u0063\u006f\u006c\u006frs\u0070\u0061\u0063\u0065\u0020\u006e\u006f\u0074\u0020\u0064\u0065\u0066\u0069\u006ee\u0064");
};_gd ,_cfb :=_fb .(*_b .PdfColorspaceSpecialPattern );if !_cfb {return _g .New ("\u0074\u0079\u0070\u0065\u0020\u0065\u0072\u0072\u006f\u0072");};if _gd .UnderlyingCS !=nil {_gd .UnderlyingCS =_b .NewPdfColorspaceDeviceGray ();};_fa =_eec .SetColorspaceByName (*_dgg ,_gd );
if _fa !=nil {return _fa ;};};*_gf =append (*_gf ,_cc );return nil ;};_eea :=_bb .ContentStreamOperation {};_eea .Operand =_ffb ;_eea .Params =[]_be .PdfObject {_be .MakeName ("\u0044\u0065\u0076\u0069\u0063\u0065\u0047\u0072\u0061\u0079")};*_gf =append (*_gf ,&_eea );
return nil ;case "\u0063\u0073":if _eef (_gga .ColorspaceNonStroking ){_ea :=_cc .Params [0].(*_be .PdfObjectName );if *_ea !="\u0050a\u0074\u0074\u0065\u0072\u006e"{_df ,_ce :=_eec .GetColorspaceByName (*_ea );if !_ce {return _g .New ("\u0063\u006f\u006c\u006frs\u0070\u0061\u0063\u0065\u0020\u006e\u006f\u0074\u0020\u0064\u0065\u0066\u0069\u006ee\u0064");
};_bag ,_ce :=_df .(*_b .PdfColorspaceSpecialPattern );if !_ce {return _g .New ("\u0074\u0079\u0070\u0065\u0020\u0065\u0072\u0072\u006f\u0072");};if _bag .UnderlyingCS !=nil {_bag .UnderlyingCS =_b .NewPdfColorspaceDeviceGray ();};if _ad :=_eec .SetColorspaceByName (*_ea ,_bag );
_ad !=nil {return _ad ;};};*_gf =append (*_gf ,_cc );return nil ;};_bfe :=_bb .ContentStreamOperation {};_bfe .Operand =_ffb ;_bfe .Params =[]_be .PdfObject {_be .MakeName ("\u0044\u0065\u0076\u0069\u0063\u0065\u0047\u0072\u0061\u0079")};*_gf =append (*_gf ,&_bfe );
return nil ;case "\u0053\u0043","\u0053\u0043\u004e":if _eef (_gga .ColorspaceStroking ){_cg :=_bb .ContentStreamOperation {};_cg .Operand =_ffb ;_cg .Params =[]_be .PdfObject {};_fab ,_agg :=_gga .ColorStroking .(*_b .PdfColorPattern );if !_agg {return _g .New ("i\u006e\u0076\u0061\u006c\u0069\u0064 \u0073\u0074\u0072\u006f\u006b\u0069\u006e\u0067\u0020c\u006f\u006c\u006fr\u0020t\u0079\u0070\u0065");
};if _fab .Color !=nil {_ec ,_fe :=_gga .ColorspaceStroking .ColorToRGB (_fab .Color );if _fe !=nil {return _fe ;};_cd :=_ec .(*_b .PdfColorDeviceRGB );_ca :=_cd .ToGray ();_cg .Params =append (_cg .Params ,_be .MakeFloat (_ca .Val ()));};if _ ,_dfd :=_eee [_fab .PatternName ];
_dfd {_cg .Params =append (_cg .Params ,_be .MakeName (string (_fab .PatternName )));*_gf =append (*_gf ,&_cg );return nil ;};_eee [_fab .PatternName ]=true ;_gae ,_cce :=_eec .GetPatternByName (_fab .PatternName );if !_cce {return _g .New ("\u0075\u006e\u0064\u0065fi\u006e\u0065\u0064\u0020\u0070\u0061\u0074\u0074\u0065\u0072\u006e\u0020\u006e\u0061m\u0065");
};_bcb ,_eg :=_cgbb (_gae );if _eg !=nil {return _eg ;};_eg =_eec .SetPatternByName (_fab .PatternName ,_bcb .ToPdfObject ());if _eg !=nil {return _eg ;};_cg .Params =append (_cg .Params ,_be .MakeName (string (_fab .PatternName )));*_gf =append (*_gf ,&_cg );
}else {_bfg ,_ccf :=_gga .ColorspaceStroking .ColorToRGB (_gga .ColorStroking );if _ccf !=nil {return _ccf ;};_dfa :=_bfg .(*_b .PdfColorDeviceRGB );_ab :=_dfa .ToGray ();_bg :=_bb .ContentStreamOperation {};_bg .Operand =_ffb ;_bg .Params =[]_be .PdfObject {_be .MakeFloat (_ab .Val ())};
*_gf =append (*_gf ,&_bg );};return nil ;case "\u0073\u0063","\u0073\u0063\u006e":if _eef (_gga .ColorspaceNonStroking ){_de :=_bb .ContentStreamOperation {};_de .Operand =_ffb ;_de .Params =[]_be .PdfObject {};_abd ,_dc :=_gga .ColorNonStroking .(*_b .PdfColorPattern );
if !_dc {return _g .New ("i\u006e\u0076\u0061\u006c\u0069\u0064 \u0073\u0074\u0072\u006f\u006b\u0069\u006e\u0067\u0020c\u006f\u006c\u006fr\u0020t\u0079\u0070\u0065");};if _abd .Color !=nil {_da ,_dfg :=_gga .ColorspaceNonStroking .ColorToRGB (_abd .Color );
if _dfg !=nil {return _dfg ;};_fc :=_da .(*_b .PdfColorDeviceRGB );_cfbg :=_fc .ToGray ();_de .Params =append (_de .Params ,_be .MakeFloat (_cfbg .Val ()));};if _ ,_fcb :=_eee [_abd .PatternName ];_fcb {_de .Params =append (_de .Params ,_be .MakeName (string (_abd .PatternName )));
*_gf =append (*_gf ,&_de );return nil ;};_eee [_abd .PatternName ]=true ;_bea ,_dce :=_eec .GetPatternByName (_abd .PatternName );if !_dce {return _g .New ("\u0075\u006e\u0064\u0065fi\u006e\u0065\u0064\u0020\u0070\u0061\u0074\u0074\u0065\u0072\u006e\u0020\u006e\u0061m\u0065");
};_becg ,_gaf :=_cgbb (_bea );if _gaf !=nil {return _gaf ;};_gaf =_eec .SetPatternByName (_abd .PatternName ,_becg .ToPdfObject ());if _gaf !=nil {return _gaf ;};_de .Params =append (_de .Params ,_be .MakeName (string (_abd .PatternName )));*_gf =append (*_gf ,&_de );
}else {_bgg ,_cff :=_gga .ColorspaceNonStroking .ColorToRGB (_gga .ColorNonStroking );if _cff !=nil {return _cff ;};_eed :=_bgg .(*_b .PdfColorDeviceRGB );_bce :=_eed .ToGray ();_cb :=_bb .ContentStreamOperation {};_cb .Operand =_ffb ;_cb .Params =[]_be .PdfObject {_be .MakeFloat (_bce .Val ())};
*_gf =append (*_gf ,&_cb );};return nil ;case "\u0052\u0047","\u004b":_db ,_abg :=_gga .ColorspaceStroking .ColorToRGB (_gga .ColorStroking );if _abg !=nil {return _abg ;};_egg :=_db .(*_b .PdfColorDeviceRGB );_dba :=_egg .ToGray ();_bbg :=_bb .ContentStreamOperation {};
_bbg .Operand ="\u0047";_bbg .Params =[]_be .PdfObject {_be .MakeFloat (_dba .Val ())};*_gf =append (*_gf ,&_bbg );return nil ;case "\u0072\u0067","\u006b":_caf ,_ac :=_gga .ColorspaceNonStroking .ColorToRGB (_gga .ColorNonStroking );if _ac !=nil {return _ac ;
};_cba :=_caf .(*_b .PdfColorDeviceRGB );_acg :=_cba .ToGray ();_cae :=_bb .ContentStreamOperation {};_cae .Operand ="\u0067";_cae .Params =[]_be .PdfObject {_be .MakeFloat (_acg .Val ())};*_gf =append (*_gf ,&_cae );return nil ;case "\u0073\u0068":if len (_cc .Params )!=1{return _g .New ("\u0070\u0061\u0072\u0061\u006d\u0073 \u0074\u006f\u0020\u0073\u0068\u0020\u006f\u0070\u0065\u0072\u0061\u0074\u006fr\u0020\u0073\u0068\u006f\u0075\u006c\u0064 \u0062\u0065\u0020\u0031");
};_eac ,_ebe :=_cc .Params [0].(*_be .PdfObjectName );if !_ebe {return _g .New ("\u0073\u0068 \u0070\u0061\u0072\u0061\u006d\u0065\u0074\u0065\u0072\u0020\u0073\u0068\u006f\u0075\u006c\u0064\u0020\u0062\u0065\u0020\u0061\u0020na\u006d\u0065");};if _ ,_adc :=_bca [*_eac ];
_adc {*_gf =append (*_gf ,_cc );return nil ;};_bca [*_eac ]=true ;_cgb ,_ebd :=_eec .GetShadingByName (*_eac );if !_ebd {return _g .New ("\u0073\u0068\u0061\u0064\u0069\u006e\u0067\u0020\u006e\u006f\u0074\u0020\u0064\u0065\u0066i\u006ee\u0064\u0020\u0069\u006e\u0020\u0072\u0065\u0073\u006f\u0075\u0072\u0063\u0065\u0073");
};_aggc ,_gcg :=_aa (_cgb );if _gcg !=nil {return _gcg ;};_gcg =_eec .SetShadingByName (*_eac ,_aggc .GetContext ().ToPdfObject ());if _gcg !=nil {return _gcg ;};};*_gf =append (*_gf ,_cc );return nil ;});_bec .AddHandler (_bb .HandlerConditionEnumOperand ,"\u0042\u0049",func (_cee *_bb .ContentStreamOperation ,_gce _bb .GraphicsState ,_bba *_b .PdfPageResources )error {if len (_cee .Params )!=1{return _g .New ("\u0069\u006e\u0076\u0061l\u0069\u0064\u0020\u006e\u0075\u006d\u0062\u0065\u0072\u0020o\u0066 \u0070\u0061\u0072\u0061\u006d\u0065\u0074e\u0072\u0073");
};_gfd ,_dfdb :=_cee .Params [0].(*_bb .ContentStreamInlineImage );if !_dfdb {return _g .New ("\u0069\u006e\u0076\u0061\u006c\u0069\u0064\u0020\u0069\u006el\u0069\u006e\u0065\u0020\u0069\u006d\u0061g\u0065\u0020\u0070\u0061\u0072\u0061\u006d\u0065\u0074\u0065\u0072");
};_ead ,_bfc :=_gfd .ToImage (_bba );if _bfc !=nil {return _bfc ;};_ae ,_bfc :=_gfd .GetColorSpace (_bba );if _bfc !=nil {return _bfc ;};_cbb ,_bfc :=_ae .ImageToRGB (*_ead );if _bfc !=nil {return _bfc ;};_eedd :=_b .NewPdfColorspaceDeviceRGB ();_bcbc ,_bfc :=_eedd .ImageToGray (_cbb );
if _bfc !=nil {return _bfc ;};_eff ,_bfc :=_gfd .GetEncoder ();if _bfc !=nil {return _bfc ;};if _dgac ,_eedf :=_eff .(*_be .DCTEncoder );_eedf {_dgac .ColorComponents =1;};_gdb ,_bfc :=_bb .NewInlineImageFromImage (_bcbc ,_eff );if _bfc !=nil {if _bfc ==_be .ErrUnsupportedEncodingParameters {_eff =_be .NewFlateEncoder ();
};_gdb ,_bfc =_bb .NewInlineImageFromImage (_bcbc ,_eff );if _bfc !=nil {return _bfc ;};};_dbf :=_bb .ContentStreamOperation {};_dbf .Operand ="\u0042\u0049";_dbf .Params =[]_be .PdfObject {_gdb };*_gf =append (*_gf ,&_dbf );return nil ;});_cdd :=map[string ]bool {};
_bec .AddHandler (_bb .HandlerConditionEnumOperand ,"\u0044\u006f",func (_dd *_bb .ContentStreamOperation ,_daa _bb .GraphicsState ,_cafg *_b .PdfPageResources )error {if len (_dd .Params )< 1{return _g .New ("\u0045\u0052\u0052\u004f\u0052\u003a\u0020\u0049\u006e\u0076\u0061\u006c\u0069\u0064\u0020\u006e\u0075\u006d\u0062\u0065r\u0020\u006f\u0066\u0020\u0070\u0061\u0072\u0061\u006ds\u0020\u0066\u006f\u0072\u0020\u0044\u006f\u0020\u006f\u0062\u006a\u0065\u0063t\u003a\u0020\u0052\u0061\u006e\u0067e\u0020\u0063\u0068e\u0063\u006b");
};_ddc :=_dd .Params [0].(*_be .PdfObjectName );_ ,_deb :=_cdd [string (*_ddc )];if _deb {return nil ;};_cdd [string (*_ddc )]=true ;_ ,_gdg :=_cafg .GetXObjectByName (*_ddc );if _gdg ==_b .XObjectTypeImage {_ecf ,_bdd :=_cafg .GetXObjectImageByName (*_ddc );
if _bdd !=nil {return _bdd ;};_agb ,_bdd :=_ecf .ToImage ();if _bdd !=nil {return _bdd ;};_dcef ,_bdd :=_ecf .ColorSpace .ImageToRGB (*_agb );if _bdd !=nil {return _bdd ;};_dbc :=_b .NewPdfColorspaceDeviceRGB ();_dca ,_bdd :=_dbc .ImageToGray (_dcef );
if _bdd !=nil {return _bdd ;};_ggag :=_ecf .Filter ;if _cfbd ,_gff :=_ggag .(*_be .DCTEncoder );_gff {_cfbd .ColorComponents =1;};_ffbe ,_bdd :=_b .NewXObjectImageFromImage (&_dca ,nil ,_ggag );if _bdd !=nil {if _bdd ==_be .ErrUnsupportedEncodingParameters {_ggag =_be .NewFlateEncoder ();
};_ffbe ,_bdd =_b .NewXObjectImageFromImage (&_dca ,nil ,_ggag );if _bdd !=nil {return _bdd ;};};_bdd =_cafg .SetXObjectImageByName (*_ddc ,_ffbe );if _bdd !=nil {return _bdd ;};}else if _gdg ==_b .XObjectTypeForm {_bfcf ,_cag :=_cafg .GetXObjectFormByName (*_ddc );
if _cag !=nil {return _cag ;};_bece ,_cag :=_bfcf .GetContentStream ();if _cag !=nil {return _cag ;};_cge :=_bfcf .Resources ;if _cge ==nil {_cge =_cafg ;};_af ,_cag :=_gg (string (_bece ),_cge );if _cag !=nil {return _cag ;};_cag =_bfcf .SetContentStream (_af ,nil );
if _cag !=nil {return _cag ;};_cag =_cafg .SetXObjectFormByName (*_ddc ,_bfcf );if _cag !=nil {return _cag ;};};return nil ;});_fa =_bec .Process (_ff );if _fa !=nil {return nil ,_fa ;};return _gf .Bytes (),nil ;};

// NormalizePage performs the following operations on the passed in page:
//   - Normalize the page rotation.
//     Rotates the contents of the page according to the Rotate entry, thus
//     flattening the rotation. The Rotate entry of the page is set to nil.
//   - Normalize the media box.
//     If the media box of the page is offsetted (Llx != 0 or Lly != 0),
//     the contents of the page are translated to (-Llx, -Lly). After
//     normalization, the media box is updated (Llx and Lly are set to 0 and
//     Urx and Ury are updated accordingly).
//   - Normalize the crop box.
//     The crop box of the page is updated based on the previous operations.
//
// After normalization, the page should look the same if openend using a
// PDF viewer.
// NOTE: This function does not normalize annotations, outlines other parts
// that are not part of the basic geometry and page content streams.
func NormalizePage (page *_b .PdfPage )error {_afb ,_abf :=page .GetMediaBox ();if _abf !=nil {return _abf ;};_bead ,_abf :=page .GetRotate ();if _abf !=nil {_ed .Log .Debug ("\u0045\u0052R\u004f\u0052\u003a\u0020\u0025\u0073\u0020\u002d\u0020\u0069\u0067\u006e\u006f\u0072\u0069\u006e\u0067\u0020\u0061\u006e\u0064\u0020\u0061\u0073\u0073\u0075\u006d\u0069\u006e\u0067\u0020\u006e\u006f\u0020\u0072\u006f\u0074\u0061\u0074\u0069\u006f\u006e\u000a",_abf .Error ());
};_aga :=_bead %360!=0&&_bead %90==0;_afb .Normalize ();_bbf ,_gac ,_fdb ,_eagf :=_afb .Llx ,_afb .Lly ,_afb .Width (),_afb .Height ();_gaec :=_bbf !=0||_gac !=0;if !_aga &&!_gaec {return nil ;};_aaa :=func (_gdfc ,_gcb ,_ege float64 )_e .BoundingBox {return _e .Path {Points :[]_e .Point {_e .NewPoint (0,0).Rotate (_ege ),_e .NewPoint (_gdfc ,0).Rotate (_ege ),_e .NewPoint (0,_gcb ).Rotate (_ege ),_e .NewPoint (_gdfc ,_gcb ).Rotate (_ege )}}.GetBoundingBox ();
};_baad :=_bb .NewContentCreator ();var _gcbd float64 ;if _aga {_gcbd =-float64 (_bead );_fece :=_aaa (_fdb ,_eagf ,_gcbd );_baad .Translate ((_fece .Width -_fdb )/2+_fdb /2,(_fece .Height -_eagf )/2+_eagf /2);_baad .RotateDeg (_gcbd );_baad .Translate (-_fdb /2,-_eagf /2);
_fdb ,_eagf =_fece .Width ,_fece .Height ;};if _gaec {_baad .Translate (-_bbf ,-_gac );};_dgdg :=_baad .Operations ();_cdf ,_abf :=_be .MakeStream (_dgdg .Bytes (),_be .NewFlateEncoder ());if _abf !=nil {return _abf ;};_bcea :=_be .MakeArray (_cdf );_bcea .Append (page .GetContentStreamObjs ()...);
*_afb =_b .PdfRectangle {Urx :_fdb ,Ury :_eagf };if _gag :=page .CropBox ;_gag !=nil {_gag .Normalize ();_cfe ,_dfb ,_bdde ,_aca :=_gag .Llx -_bbf ,_gag .Lly -_gac ,_gag .Width (),_gag .Height ();if _aga {_gbc :=_aaa (_bdde ,_aca ,_gcbd );_bdde ,_aca =_gbc .Width ,_gbc .Height ;
};*_gag =_b .PdfRectangle {Llx :_cfe ,Lly :_dfb ,Urx :_cfe +_bdde ,Ury :_dfb +_aca };};_ed .Log .Debug ("\u0052\u006f\u0074\u0061\u0074\u0065\u003d\u0025\u0066\u00b0\u0020\u004f\u0070\u0073\u003d%\u0071 \u004d\u0065\u0064\u0069\u0061\u0042\u006f\u0078\u003d\u0025\u002e\u0032\u0066",_gcbd ,_dgdg ,_afb );
page .Contents =_bcea ;page .Rotate =nil ;return nil ;};func _dde (_debg ,_ebb *_b .PdfAcroForm ,_gb int )(*_b .PdfAcroForm ,error ){if _debg .NeedAppearances ==nil {_debg .NeedAppearances =_ebb .NeedAppearances ;};if _debg .SigFlags ==nil {_debg .SigFlags =_ebb .SigFlags ;
};if _debg .CO ==nil {_debg .CO =_ebb .CO ;};if _debg .DR ==nil {_debg .DR =_ebb .DR ;}else if _ebb .DR !=nil {_dgfe ,_ceb :=_eba (_debg .DR ,_ebb .DR );if _ceb !=nil {return nil ,_ceb ;};_debg .DR =_dgfe ;};if _debg .DA ==nil {_debg .DA =_ebb .DA ;};if _debg .Q ==nil {_debg .Q =_ebb .Q ;
};if _debg .XFA ==nil {_debg .XFA =_ebb .XFA ;}else {if _ebb .XFA !=nil {_ed .Log .Debug ("TO\u0044\u004f\u003a\u0020\u0048\u0061\u006edl\u0065\u0020\u0058\u0046\u0041\u0020\u006d\u0065\u0072\u0067\u0069\u006e\u0067\u0020\u002d \u0043\u0075\u0072\u0072\u0065\u006e\u0074\u006c\u0079\u0020\u006a\u0075\u0073\u0074\u0020\u0075\u0073\u0069\u006e\u0067 \u0066\u0069\u0072\u0073\u0074\u0020o\u006e\u0065\u0020\u0074\u0068\u0061\u0074\u0020\u0069s\u0020e\u006e\u0063\u006f\u0075\u006e\u0074\u0065\u0072\u0065\u0064");
};};if _debg .Fields ==nil {_debg .Fields =_ebb .Fields ;}else {_aeb :=_b .NewPdfField ();_aeb .T =_be .MakeString (_f .Sprintf ("\u0064\u006f\u0063%\u0064",_gb ));_aeb .Kids =[]*_b .PdfField {};if _ebb .Fields !=nil {for _ ,_adcb :=range *_ebb .Fields {_adcb .Parent =_aeb ;
_aeb .Kids =append (_aeb .Kids ,_adcb );};};*_debg .Fields =append (*_debg .Fields ,_aeb );};return _debg ,nil ;};